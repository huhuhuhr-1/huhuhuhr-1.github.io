<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>0005.sealos-问答记录</title>
      <link href="/2025/12/07/0005-sealos-wen-da-ji-lu/"/>
      <url>/2025/12/07/0005-sealos-wen-da-ji-lu/</url>
      
        <content type="html"><![CDATA[<h1 id="Sealos运维问答记录"><a href="#Sealos运维问答记录" class="headerlink" title="Sealos运维问答记录"></a>Sealos运维问答记录</h1><h2 id="1-概念理解"><a href="#1-概念理解" class="headerlink" title="1. 概念理解"></a>1. 概念理解</h2><h3 id="1-1-Kubernetes架构相关"><a href="#1-1-Kubernetes架构相关" class="headerlink" title="1.1 Kubernetes架构相关"></a>1.1 Kubernetes架构相关</h3><p><strong>问题：一个Pod可以包含一个或多个紧密相关的容器，什么意思？例如我一个docker compose说明了服务依赖postgresql等等服务，这一组服务一个pod？</strong></p><p><strong>回答：</strong> 不是的，您对Pod的理解有些偏差。Pod是Kubernetes中最小的部署单元，它包含一个或多个”紧密相关”的容器。这里的”紧密相关”是指这些容器需要共享存储和网络，共同完成一个任务。</p><p>在Docker Compose中的多个服务（如Java应用+PostgreSQL）在Kubernetes中应该对应多个Pod + Service，而不是一个Pod。Pod中多个容器的”紧密相关”是指它们协同完成一个单一任务，而不是运行不同的服务组件。</p><p><strong>问题：服务和实际的运行的服务我还是搞不清楚</strong></p><p><strong>回答：</strong> Kubernetes中的Service（服务）和实际运行的服务（应用程序）有以下区别：</p><ul><li><strong>Service</strong>：是Kubernetes的一个API对象，是一个网络抽象，为一组Pod提供稳定的网络端点（IP地址和DNS名称）</li><li><strong>实际运行的服务</strong>：是运行在Pod中的实际应用程序</li></ul><p>它们的关系是：用户请求 → Service IP/域名 → Service → 标签选择器 → 实际运行的Pod。Service就像一个门面，为实际运行在Pod中的应用程序提供稳定的访问入口。</p><h3 id="1-2-概念映射"><a href="#1-2-概念映射" class="headerlink" title="1.2 概念映射"></a>1.2 概念映射</h3><p><strong>问题：假如有一个为java服务，这个服务一个实例就是一个pod，多个pod指向同一个service，service负责做负载均衡，容器是就是一个pod实例，每一个pod都是不是再某一个命名空间下的，集群通过控制pod部署在哪个node去控制资源做容灾</strong></p><p><strong>回答：</strong> </p><ul><li>一个Pod通常运行一个服务实例，多个Pod通过Service提供负载均衡</li><li>Pod包含一个或多个紧密相关的容器</li><li>所有Pod都在命名空间下运行（默认为default）</li><li>控制器通过调度策略控制Pod部署在哪个Node上以实现容灾</li></ul><h2 id="2-集群操作"><a href="#2-集群操作" class="headerlink" title="2. 集群操作"></a>2. 集群操作</h2><h3 id="2-1-查看集群状态"><a href="#2-1-查看集群状态" class="headerlink" title="2.1 查看集群状态"></a>2.1 查看集群状态</h3><p><strong>问题：假如我们有一个三个主机构建的k8s集群，查看集群状态</strong></p><p><strong>回答：</strong></p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 查看所有节点状态</span></span><br><span class="line">kubectl get nodes</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看节点详细信息</span></span><br><span class="line">kubectl describe node &lt;node-name&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看集群整体信息</span></span><br><span class="line">kubectl cluster-info</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看所有命名空间中的资源</span></span><br><span class="line">kubectl get all --all-namespaces</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看系统命名空间中的资源</span></span><br><span class="line">kubectl get pods -n kube-system</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看集群资源使用情况</span></span><br><span class="line">kubectl top nodes</span><br><span class="line">kubectl top pods --all-namespaces</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看集群事件</span></span><br><span class="line">kubectl get events --all-namespaces</span><br></pre></td></tr></tbody></table></figure><p><strong>问题：这个nodes是主机的意思吗</strong></p><p><strong>回答：</strong> 是的，Node是指集群中的主机，可以是物理服务器或虚拟机。每个Node都安装了kubelet和容器运行时，是Kubernetes集群的工作机器。</p><p><strong>问题：查看某命名空间下有多少服务</strong></p><p><strong>回答：</strong></p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 查看指定命名空间下的服务数量</span></span><br><span class="line">kubectl get services -n &lt;命名空间名称&gt; --no-headers | <span class="built_in">wc</span> -l</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看指定命名空间下的所有服务</span></span><br><span class="line">kubectl get services -n &lt;命名空间名称&gt;</span><br></pre></td></tr></tbody></table></figure><h3 id="2-2-日志查看"><a href="#2-2-日志查看" class="headerlink" title="2.2 日志查看"></a>2.2 日志查看</h3><p><strong>问题：查看某服务的日志</strong></p><p><strong>回答：</strong> Service本身不产生日志。要查看与服务相关的日志，需要查看该服务后端Pod的日志：</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 查看服务后端Pod的日志</span></span><br><span class="line">kubectl logs -l &lt;标签选择器&gt; -n &lt;命名空间&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看特定Pod的日志</span></span><br><span class="line">kubectl logs &lt;Pod名称&gt; -n &lt;命名空间&gt;</span><br></pre></td></tr></tbody></table></figure><p><strong>问题：如果这个pod不是的是多个呢，例如一个java服务，部署了3个实例</strong></p><p><strong>回答：</strong> 如果一个服务有3个Pod实例，可以这样查看日志：</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 查看所有3个Pod的日志</span></span><br><span class="line">kubectl logs -l app=&lt;标签值&gt; -n &lt;命名空间&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 实时查看所有Pod的日志</span></span><br><span class="line"><span class="comment"># 需要使用第三方工具如stern</span></span><br><span class="line">stern -n &lt;命名空间&gt; -l app=&lt;标签值&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 或使用脚本查看所有Pod日志</span></span><br><span class="line">kubectl get pods -l app=&lt;标签值&gt; -n &lt;命名空间&gt; -o name | xargs -I {} kubectl logs {} -n &lt;命名空间&gt;</span><br></pre></td></tr></tbody></table></figure><h2 id="3-运维实践"><a href="#3-运维实践" class="headerlink" title="3. 运维实践"></a>3. 运维实践</h2><h3 id="3-1-故障排查"><a href="#3-1-故障排查" class="headerlink" title="3.1 故障排查"></a>3.1 故障排查</h3><p><strong>问题：当您在生产环境中遇到Pod频繁重启时，您会按照什么顺序排查问题？</strong></p><p><strong>回答：</strong> </p><ol><li><code>kubectl get pods -l app=xxx -n &lt;命名空间&gt;</code> # 查看Pod状态</li><li><code>kubectl describe pod &lt;pod名称&gt; -n &lt;命名空间&gt;</code> # 查看详细事件</li><li><code>kubectl logs &lt;pod名称&gt; -n &lt;命名空间&gt;</code> # 查看当前容器日志</li><li><code>kubectl logs &lt;pod名称&gt; -n &lt;命名空间&gt; --previous</code> # 查看上一个容器的日志</li></ol><h3 id="3-2-高可用配置"><a href="#3-2-高可用配置" class="headerlink" title="3.2 高可用配置"></a>3.2 高可用配置</h3><p><strong>问题：在一个三节点的K8s集群中，如果要实现高可用，您会如何分配Master和Worker节点的角色？</strong></p><p><strong>回答：</strong> 在三节点集群中：</p><ul><li>选项1：三台都同时承担Master和Worker角色（混合节点配置）</li><li>选项2：一台Master，两台Worker（分离角色配置）</li></ul><p>对于etcd高可用，需要在三个节点上都部署etcd实例。</p><p><strong>Clusterfile配置示例：</strong></p><figure class="highlight yaml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps.sealos.io/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Cluster</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">my-cluster</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">image:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">kubernetes:v1.25.0</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">calico:v3.24.1</span></span><br><span class="line">  <span class="attr">hosts:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">ips:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">"192.168.1.100"</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">"192.168.1.101"</span> </span><br><span class="line">        <span class="bullet">-</span> <span class="string">"192.168.1.102"</span></span><br><span class="line">      <span class="attr">roles:</span> [ <span class="string">"master"</span>, <span class="string">"node"</span>, <span class="string">"etcd"</span> ]</span><br></pre></td></tr></tbody></table></figure><h3 id="3-3-配置管理"><a href="#3-3-配置管理" class="headerlink" title="3.3 配置管理"></a>3.3 配置管理</h3><p><strong>问题：您如何处理应用配置在不同环境（开发、测试、生产）之间的差异？</strong></p><p><strong>回答：</strong> </p><ol><li>使用命名空间隔离不同环境</li><li>使用ConfigMap管理非敏感配置</li><li>使用Secret管理敏感配置</li><li>使用Helm或Kustomize进行模板化配置管理</li><li>通过CI/CD管道自动化部署到不同环境</li></ol><h2 id="4-概念解释"><a href="#4-概念解释" class="headerlink" title="4. 概念解释"></a>4. 概念解释</h2><h3 id="4-1-etcd"><a href="#4-1-etcd" class="headerlink" title="4.1 etcd"></a>4.1 etcd</h3><p><strong>问题：etcd是什么意思</strong></p><p><strong>回答：</strong> etcd是Kubernetes的核心组件，是一个高可用的分布式键值存储系统，是Kubernetes的”大脑”，负责存储集群的所有状态信息，包括节点信息、Pod配置、服务定义、配置数据等。为了实现高可用，etcd通常需要在多个节点上部署实例，形成etcd集群。</p>]]></content>
      
      
      
        <tags>
            
            <tag> 运维 </tag>
            
            <tag> k8s </tag>
            
            <tag> sealos </tag>
            
            <tag> 问答 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>0004.sealos实战</title>
      <link href="/2025/12/07/0004-sealos-shi-zhan/"/>
      <url>/2025/12/07/0004-sealos-shi-zhan/</url>
      
        <content type="html"><![CDATA[<h1 id="Sealos实战：从零开始部署和管理Kubernetes集群"><a href="#Sealos实战：从零开始部署和管理Kubernetes集群" class="headerlink" title="Sealos实战：从零开始部署和管理Kubernetes集群"></a>Sealos实战：从零开始部署和管理Kubernetes集群</h1><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>本文档详细介绍了如何使用Sealos在多台服务器上部署和管理Kubernetes集群，包括环境准备、集群部署、应用部署、配置管理、扩容、容灾、升级和回滚等完整运维流程。我们将以三台服务器为例，展示从零开始构建到运维整个Kubernetes集群的完整过程。</p><h2 id="1-环境准备"><a href="#1-环境准备" class="headerlink" title="1. 环境准备"></a>1. 环境准备</h2><h3 id="1-1-服务器规划"><a href="#1-1-服务器规划" class="headerlink" title="1.1 服务器规划"></a>1.1 服务器规划</h3><p>我们使用三台服务器作为示例：</p><ul><li>Master节点（控制平面）：192.168.1.100</li><li>Worker节点1：192.168.1.101</li><li>Worker节点2：192.168.1.102</li></ul><h3 id="1-2-前提条件"><a href="#1-2-前提条件" class="headerlink" title="1.2 前提条件"></a>1.2 前提条件</h3><p>在所有服务器上准备以下环境：</p><ol><li><strong>操作系统</strong>：Ubuntu 20.04 LTS 或 CentOS 8.x</li><li><strong>硬件配置</strong>：<ul><li>CPU：至少2核</li><li>内存：至少4GB</li><li>磁盘：至少40GB</li></ul></li><li><strong>网络配置</strong>：<ul><li>服务器之间网络互通</li><li>关闭防火墙或开放必要端口</li></ul></li><li><strong>SSH访问</strong>：确保可以从任一节点SSH到其他节点</li></ol><h3 id="1-3-系统准备命令"><a href="#1-3-系统准备命令" class="headerlink" title="1.3 系统准备命令"></a>1.3 系统准备命令</h3><p>在所有节点上执行以下命令：</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 关闭防火墙（生产环境建议配置具体规则）</span></span><br><span class="line"><span class="built_in">sudo</span> ufw <span class="built_in">disable</span>  <span class="comment"># Ubuntu</span></span><br><span class="line"><span class="built_in">sudo</span> systemctl stop firewalld  <span class="comment"># CentOS</span></span><br><span class="line"><span class="built_in">sudo</span> systemctl <span class="built_in">disable</span> firewalld</span><br><span class="line"></span><br><span class="line"><span class="comment"># 关闭Swap</span></span><br><span class="line"><span class="built_in">sudo</span> swapoff -a</span><br><span class="line"><span class="built_in">sudo</span> sed -i <span class="string">'/ swap / s/^\(.*\)$/#\1/g'</span> /etc/fstab</span><br><span class="line"></span><br><span class="line"><span class="comment"># 允许iptables转发</span></span><br><span class="line"><span class="built_in">sudo</span> modprobe overlay</span><br><span class="line"><span class="built_in">sudo</span> modprobe br_netfilter</span><br><span class="line"><span class="built_in">cat</span> &lt;&lt;<span class="string">EOF | sudo tee /etc/modules-load.d/k8s.conf</span></span><br><span class="line"><span class="string">overlay</span></span><br><span class="line"><span class="string">br_netfilter</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> &lt;&lt;<span class="string">EOF | sudo tee /etc/sysctl.d/k8s.conf</span></span><br><span class="line"><span class="string">net.bridge.bridge-nf-call-iptables  = 1</span></span><br><span class="line"><span class="string">net.bridge.bridge-nf-call-ip6tables = 1</span></span><br><span class="line"><span class="string">net.ipv4.ip_forward                 = 1</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">sudo</span> sysctl --system</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装Docker</span></span><br><span class="line">curl -fsSL https://get.docker.com | bash -s docker --mirror Aliyun</span><br><span class="line"><span class="built_in">sudo</span> systemctl <span class="built_in">enable</span> docker</span><br><span class="line"><span class="built_in">sudo</span> systemctl start docker</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置国内镜像源（可选，提高拉取速度）</span></span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">mkdir</span> -p /etc/docker</span><br><span class="line"><span class="built_in">cat</span> &lt;&lt;<span class="string">EOF | sudo tee /etc/docker/daemon.json</span></span><br><span class="line"><span class="string">{</span></span><br><span class="line"><span class="string">  "registry-mirrors": [</span></span><br><span class="line"><span class="string">    "https://docker.mirrors.ustc.edu.cn",</span></span><br><span class="line"><span class="string">    "https://hub-mirror.c.163.com"</span></span><br><span class="line"><span class="string">  ],</span></span><br><span class="line"><span class="string">  "exec-opts": ["native.cgroupdriver=systemd"]</span></span><br><span class="line"><span class="string">}</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"><span class="built_in">sudo</span> systemctl restart docker</span><br></pre></td></tr></tbody></table></figure><h2 id="2-安装Sealos"><a href="#2-安装Sealos" class="headerlink" title="2. 安装Sealos"></a>2. 安装Sealos</h2><p>在Master节点（192.168.1.100）上安装Sealos：</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 安装sealos</span></span><br><span class="line">wget -c https://ghproxy.com/github.com/labring/sealos/releases/download/v4.4.0/sealos_4.4.0_linux_amd64.tar.gz \</span><br><span class="line">     -O - | <span class="built_in">sudo</span> tar -zx -C /usr/local/bin</span><br><span class="line"></span><br><span class="line"><span class="comment"># 为sealos添加执行权限</span></span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">chmod</span> +x /usr/local/bin/sealos</span><br><span class="line"></span><br><span class="line"><span class="comment"># 验证安装</span></span><br><span class="line">sealos version</span><br></pre></td></tr></tbody></table></figure><h2 id="3-创建Clusterfile定义集群"><a href="#3-创建Clusterfile定义集群" class="headerlink" title="3. 创建Clusterfile定义集群"></a>3. 创建Clusterfile定义集群</h2><p>创建一个名为<code>Clusterfile</code>的文件来定义集群配置：</p><figure class="highlight yaml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps.sealos.io/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Cluster</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">my-cluster</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">image:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">kubernetes:v1.25.0</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">calico:v3.24.1</span></span><br><span class="line">  <span class="attr">hosts:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">ips:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">"192.168.1.100"</span>  <span class="comment"># Master节点IP</span></span><br><span class="line">      <span class="attr">roles:</span> [ <span class="string">"master"</span>, <span class="string">"control-plane"</span> ]</span><br><span class="line">    <span class="bullet">-</span> <span class="attr">ips:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">"192.168.1.101"</span>  <span class="comment"># Worker节点IP 1</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">"192.168.1.102"</span>  <span class="comment"># Worker节点IP 2</span></span><br><span class="line">      <span class="attr">roles:</span> [ <span class="string">"node"</span> ]</span><br></pre></td></tr></tbody></table></figure><p>这个配置文件定义了：</p><ul><li>使用Kubernetes v1.25.0版本</li><li>使用Calico作为CNI网络插件</li><li>一台Master节点和两台Worker节点</li></ul><h2 id="4-部署Kubernetes集群"><a href="#4-部署Kubernetes集群" class="headerlink" title="4. 部署Kubernetes集群"></a>4. 部署Kubernetes集群</h2><p>在Master节点上运行以下命令部署集群：</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 使用Clusterfile部署集群</span></span><br><span class="line">sealos run -f Clusterfile</span><br><span class="line"></span><br><span class="line"><span class="comment"># 或者直接使用命令行参数部署</span></span><br><span class="line">sealos run kubernetes:v1.25.0 calico:v3.24.1 \</span><br><span class="line">  --masters 192.168.1.100 \</span><br><span class="line">  --nodes 192.168.1.101,192.168.1.102</span><br></pre></td></tr></tbody></table></figure><p>部署完成后，Sealos会：</p><ul><li>安装Kubernetes组件</li><li>配置etcd集群</li><li>初始化Master节点</li><li>加入Worker节点</li><li>配置网络插件Calico</li></ul><p>验证集群状态：</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 如果sealos自动配置了kubectl</span></span><br><span class="line">kubectl get nodes</span><br><span class="line"></span><br><span class="line"><span class="comment"># 或者使用以下命令获取集群访问信息</span></span><br><span class="line">sealos kubeconfig -f Clusterfile --host 192.168.1.100</span><br></pre></td></tr></tbody></table></figure><p>预期输出：</p><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">NAME              STATUS   ROLES                  AGE   VERSION</span><br><span class="line">192.168.1.100     Ready    control-plane,master   5m    v1.25.0</span><br><span class="line">192.168.1.101     Ready    &lt;none&gt;                 4m    v1.25.0</span><br><span class="line">192.168.1.102     Ready    &lt;none&gt;                 4m    v1.25.0</span><br></pre></td></tr></tbody></table></figure><h2 id="5-理解Pod和Node的分配机制"><a href="#5-理解Pod和Node的分配机制" class="headerlink" title="5. 理解Pod和Node的分配机制"></a>5. 理解Pod和Node的分配机制</h2><h3 id="5-1-Node（节点）"><a href="#5-1-Node（节点）" class="headerlink" title="5.1 Node（节点）"></a>5.1 Node（节点）</h3><p>Node是集群中的工作机器（物理机或虚拟机），负责运行Pod。在我们的例子中：</p><ul><li>192.168.1.100：Master节点，具有控制平面角色</li><li>192.168.1.101和192.168.1.102：Worker节点，用于运行工作负载</li></ul><h3 id="5-2-Pod（容器组）"><a href="#5-2-Pod（容器组）" class="headerlink" title="5.2 Pod（容器组）"></a>5.2 Pod（容器组）</h3><p>Pod是Kubernetes中最小的部署单元，通常包含一个或多个紧密相关的容器。</p><h3 id="5-3-调度机制"><a href="#5-3-调度机制" class="headerlink" title="5.3 调度机制"></a>5.3 调度机制</h3><p>Kubernetes调度器（kube-scheduler）负责决定Pod在哪个Node上运行。它考虑以下因素：</p><ul><li>资源需求：CPU、内存等</li><li>节点标签（Labels）和节点选择器（Node Selector）</li><li>污点（Taints）和容忍度（Tolerations）</li><li>亲和性（Affinity）和反亲和性（Anti-Affinity）</li></ul><h2 id="6-部署应用到集群"><a href="#6-部署应用到集群" class="headerlink" title="6. 部署应用到集群"></a>6. 部署应用到集群</h2><h3 id="6-1-准备Docker镜像"><a href="#6-1-准备Docker镜像" class="headerlink" title="6.1 准备Docker镜像"></a>6.1 准备Docker镜像</h3><p>假设我们有一个名为<code>my-web-app:latest</code>的Docker镜像，包含一个简单的Web应用。</p><p>首先，确保镜像在所有节点上都可用：</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 在所有节点上拉取镜像</span></span><br><span class="line"><span class="built_in">sudo</span> docker pull my-registry/my-web-app:latest</span><br><span class="line"></span><br><span class="line"><span class="comment"># 或者在一台机器上保存镜像为tar文件，然后分发到其他节点</span></span><br><span class="line">docker save -o my-web-app.tar my-registry/my-web-app:latest</span><br><span class="line">scp my-web-app.tar user@192.168.1.101:~/</span><br><span class="line">scp my-web-app.tar user@192.168.1.102:~/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在其他节点上加载镜像</span></span><br><span class="line">docker load -i my-web-app.tar</span><br></pre></td></tr></tbody></table></figure><h3 id="6-2-创建应用部署配置"><a href="#6-2-创建应用部署配置" class="headerlink" title="6.2 创建应用部署配置"></a>6.2 创建应用部署配置</h3><p>创建一个名为<code>web-app-deployment.yaml</code>的文件：</p><figure class="highlight yaml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">my-web-app</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">2</span>  <span class="comment"># 初始副本数</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">my-web-app</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">my-web-app</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">web-container</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">my-registry/my-web-app:latest</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">80</span></span><br><span class="line">        <span class="attr">env:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">ENV</span></span><br><span class="line">          <span class="attr">value:</span> <span class="string">"production"</span></span><br><span class="line">        <span class="attr">resources:</span></span><br><span class="line">          <span class="attr">requests:</span></span><br><span class="line">            <span class="attr">memory:</span> <span class="string">"64Mi"</span></span><br><span class="line">            <span class="attr">cpu:</span> <span class="string">"250m"</span></span><br><span class="line">          <span class="attr">limits:</span></span><br><span class="line">            <span class="attr">memory:</span> <span class="string">"128Mi"</span></span><br><span class="line">            <span class="attr">cpu:</span> <span class="string">"500m"</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">my-web-app-service</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">my-web-app</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">      <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="number">80</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">LoadBalancer</span>  <span class="comment"># 或者使用NodePort或ClusterIP</span></span><br></pre></td></tr></tbody></table></figure><h3 id="6-3-通过Sealos部署应用"><a href="#6-3-通过Sealos部署应用" class="headerlink" title="6.3 通过Sealos部署应用"></a>6.3 通过Sealos部署应用</h3><p>使用Sealos可以创建应用包来部署应用，也可以使用kubectl直接应用YAML配置：</p><h4 id="方法1：使用kubectl"><a href="#方法1：使用kubectl" class="headerlink" title="方法1：使用kubectl"></a>方法1：使用kubectl</h4><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 应用YAML配置</span></span><br><span class="line">kubectl apply -f web-app-deployment.yaml</span><br><span class="line"></span><br><span class="line"><span class="comment"># 验证部署</span></span><br><span class="line">kubectl get deployments</span><br><span class="line">kubectl get pods</span><br><span class="line">kubectl get services</span><br></pre></td></tr></tbody></table></figure><h4 id="方法2：使用Sealos应用包"><a href="#方法2：使用Sealos应用包" class="headerlink" title="方法2：使用Sealos应用包"></a>方法2：使用Sealos应用包</h4><p>首先创建应用包（Application Package）：</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 创建应用包目录结构</span></span><br><span class="line"><span class="built_in">mkdir</span> my-web-app-pkg</span><br><span class="line"><span class="built_in">cd</span> my-web-app-pkg</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建Kubefile定义应用包</span></span><br><span class="line"><span class="built_in">cat</span> &gt; Kubefile &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">FROM scratch</span></span><br><span class="line"><span class="string">COPY web-app-deployment.yaml .</span></span><br><span class="line"><span class="string">CMD ["kubectl apply -f web-app-deployment.yaml"]</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 构建应用包镜像</span></span><br><span class="line">sealos build -t my-registry/my-web-app-pkg:latest .</span><br><span class="line"></span><br><span class="line"><span class="comment"># 推送镜像到仓库（如果需要）</span></span><br><span class="line">sealos push my-registry/my-web-app-pkg:latest</span><br><span class="line"></span><br><span class="line"><span class="comment"># 运行应用包</span></span><br><span class="line">sealos run my-registry/my-web-app-pkg:latest</span><br></pre></td></tr></tbody></table></figure><h2 id="7-配置参数注入"><a href="#7-配置参数注入" class="headerlink" title="7. 配置参数注入"></a>7. 配置参数注入</h2><h3 id="7-1-通过ConfigMap注入配置"><a href="#7-1-通过ConfigMap注入配置" class="headerlink" title="7.1 通过ConfigMap注入配置"></a>7.1 通过ConfigMap注入配置</h3><p>创建一个ConfigMap来存储配置参数：</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 创建ConfigMap</span></span><br><span class="line">kubectl create configmap app-config \</span><br><span class="line">  --from-literal=database.host=192.168.1.200 \</span><br><span class="line">  --from-literal=database.port=3306 \</span><br><span class="line">  --from-literal=app.mode=production</span><br></pre></td></tr></tbody></table></figure><p>更新Deployment以使用ConfigMap：</p><figure class="highlight yaml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">my-web-app</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">2</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">my-web-app</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">my-web-app</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">web-container</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">my-registry/my-web-app:latest</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">80</span></span><br><span class="line">        <span class="attr">env:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">DATABASE_HOST</span></span><br><span class="line">          <span class="attr">valueFrom:</span></span><br><span class="line">            <span class="attr">configMapKeyRef:</span></span><br><span class="line">              <span class="attr">name:</span> <span class="string">app-config</span></span><br><span class="line">              <span class="attr">key:</span> <span class="string">database.host</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">DATABASE_PORT</span></span><br><span class="line">          <span class="attr">valueFrom:</span></span><br><span class="line">            <span class="attr">configMapKeyRef:</span></span><br><span class="line">              <span class="attr">name:</span> <span class="string">app-config</span></span><br><span class="line">              <span class="attr">key:</span> <span class="string">database.port</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">APP_MODE</span></span><br><span class="line">          <span class="attr">valueFrom:</span></span><br><span class="line">            <span class="attr">configMapKeyRef:</span></span><br><span class="line">              <span class="attr">name:</span> <span class="string">app-config</span></span><br><span class="line">              <span class="attr">key:</span> <span class="string">app.mode</span></span><br><span class="line">        <span class="attr">volumeMounts:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">config-volume</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/etc/config</span></span><br><span class="line">      <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">config-volume</span></span><br><span class="line">        <span class="attr">configMap:</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">app-config</span></span><br></pre></td></tr></tbody></table></figure><h3 id="7-2-通过Secret注入敏感配置"><a href="#7-2-通过Secret注入敏感配置" class="headerlink" title="7.2 通过Secret注入敏感配置"></a>7.2 通过Secret注入敏感配置</h3><p>创建一个Secret来存储敏感信息（如密码、密钥）：</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 创建Secret</span></span><br><span class="line">kubectl create secret generic app-secret \</span><br><span class="line">  --from-literal=db-password=supersecretpassword \</span><br><span class="line">  --from-literal=api-key=your-api-key</span><br></pre></td></tr></tbody></table></figure><p>更新Deployment以使用Secret：</p><figure class="highlight yaml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">my-web-app</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">2</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">my-web-app</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">my-web-app</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">web-container</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">my-registry/my-web-app:latest</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">80</span></span><br><span class="line">        <span class="attr">env:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">DATABASE_HOST</span></span><br><span class="line">          <span class="attr">valueFrom:</span></span><br><span class="line">            <span class="attr">configMapKeyRef:</span></span><br><span class="line">              <span class="attr">name:</span> <span class="string">app-config</span></span><br><span class="line">              <span class="attr">key:</span> <span class="string">database.host</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">DB_PASSWORD</span></span><br><span class="line">          <span class="attr">valueFrom:</span></span><br><span class="line">            <span class="attr">secretKeyRef:</span></span><br><span class="line">              <span class="attr">name:</span> <span class="string">app-secret</span></span><br><span class="line">              <span class="attr">key:</span> <span class="string">db-password</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">API_KEY</span></span><br><span class="line">          <span class="attr">valueFrom:</span></span><br><span class="line">            <span class="attr">secretKeyRef:</span></span><br><span class="line">              <span class="attr">name:</span> <span class="string">app-secret</span></span><br><span class="line">              <span class="attr">key:</span> <span class="string">api-key</span></span><br></pre></td></tr></tbody></table></figure><h2 id="8-节点扩容"><a href="#8-节点扩容" class="headerlink" title="8. 节点扩容"></a>8. 节点扩容</h2><h3 id="8-1-扩容Worker节点"><a href="#8-1-扩容Worker节点" class="headerlink" title="8.1 扩容Worker节点"></a>8.1 扩容Worker节点</h3><p>当需要增加Worker节点来提供更多的计算资源时：</p><ol><li>在新的服务器上准备环境（按照1.3节的系统准备命令）</li><li>使用Sealos添加节点：</li></ol><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 添加新的Worker节点</span></span><br><span class="line">sealos add --nodes 192.168.1.103</span><br><span class="line"></span><br><span class="line"><span class="comment"># 验证节点是否加入集群</span></span><br><span class="line">kubectl get nodes</span><br></pre></td></tr></tbody></table></figure><h3 id="8-2-扩容应用Pod"><a href="#8-2-扩容应用Pod" class="headerlink" title="8.2 扩容应用Pod"></a>8.2 扩容应用Pod</h3><p>增加应用的副本数：</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 扩容到5个副本</span></span><br><span class="line">kubectl scale deployment my-web-app --replicas=5</span><br><span class="line"></span><br><span class="line"><span class="comment"># 或者直接编辑Deployment</span></span><br><span class="line">kubectl edit deployment my-web-app</span><br></pre></td></tr></tbody></table></figure><h2 id="9-容灾策略"><a href="#9-容灾策略" class="headerlink" title="9. 容灾策略"></a>9. 容灾策略</h2><h3 id="9-1-高可用Master节点"><a href="#9-1-高可用Master节点" class="headerlink" title="9.1 高可用Master节点"></a>9.1 高可用Master节点</h3><p>为避免Master节点单点故障，我们可以部署高可用集群：</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 使用三个Master节点部署高可用集群</span></span><br><span class="line">sealos run kubernetes:v1.25.0 calico:v3.24.1 \</span><br><span class="line">  --masters 192.168.1.100,192.168.1.103,192.168.1.104 \</span><br><span class="line">  --nodes 192.168.1.101,192.168.1.102</span><br></pre></td></tr></tbody></table></figure><h3 id="9-2-备份和恢复"><a href="#9-2-备份和恢复" class="headerlink" title="9.2 备份和恢复"></a>9.2 备份和恢复</h3><p>定期备份etcd数据和Kubernetes清单：</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 备份etcd</span></span><br><span class="line">ETCDCTL_API=3 etcdctl snapshot save /tmp/etcd-snapshot-$(<span class="built_in">date</span> +%Y%m%d).db \</span><br><span class="line">  --endpoints=https://127.0.0.1:2379 \</span><br><span class="line">  --cacert=/etc/kubernetes/pki/etcd/ca.crt \</span><br><span class="line">  --cert=/etc/kubernetes/pki/etcd/server.crt \</span><br><span class="line">  --key=/etc/kubernetes/pki/etcd/server.key</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用Velero备份和恢复</span></span><br><span class="line"><span class="comment"># 安装Velero</span></span><br><span class="line">kubectl apply -f https://github.com/vmware-tanzu/velero/releases/latest/download/velero-install.yaml</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建备份</span></span><br><span class="line">velero backup create my-backup --selector app=my-web-app</span><br></pre></td></tr></tbody></table></figure><h3 id="9-3-健康检查和监控"><a href="#9-3-健康检查和监控" class="headerlink" title="9.3 健康检查和监控"></a>9.3 健康检查和监控</h3><p>配置Liveness和Readiness探针：</p><figure class="highlight yaml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">my-web-app</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">2</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">my-web-app</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">my-web-app</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">web-container</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">my-registry/my-web-app:latest</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">80</span></span><br><span class="line">        <span class="attr">livenessProbe:</span></span><br><span class="line">          <span class="attr">httpGet:</span></span><br><span class="line">            <span class="attr">path:</span> <span class="string">/health</span></span><br><span class="line">            <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line">          <span class="attr">initialDelaySeconds:</span> <span class="number">30</span></span><br><span class="line">          <span class="attr">periodSeconds:</span> <span class="number">10</span></span><br><span class="line">        <span class="attr">readinessProbe:</span></span><br><span class="line">          <span class="attr">httpGet:</span></span><br><span class="line">            <span class="attr">path:</span> <span class="string">/ready</span></span><br><span class="line">            <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line">          <span class="attr">initialDelaySeconds:</span> <span class="number">5</span></span><br><span class="line">          <span class="attr">periodSeconds:</span> <span class="number">5</span></span><br></pre></td></tr></tbody></table></figure><h2 id="10-应用升级和回滚"><a href="#10-应用升级和回滚" class="headerlink" title="10. 应用升级和回滚"></a>10. 应用升级和回滚</h2><h3 id="10-1-应用升级"><a href="#10-1-应用升级" class="headerlink" title="10.1 应用升级"></a>10.1 应用升级</h3><h4 id="滚动更新"><a href="#滚动更新" class="headerlink" title="滚动更新"></a>滚动更新</h4><p>使用滚动更新策略进行应用升级：</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 更新部署的镜像</span></span><br><span class="line">kubectl <span class="built_in">set</span> image deployment/my-web-app web-container=my-registry/my-web-app:v2.0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看升级进度</span></span><br><span class="line">kubectl rollout status deployment/my-web-app</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看升级历史</span></span><br><span class="line">kubectl rollout <span class="built_in">history</span> deployment/my-web-app</span><br></pre></td></tr></tbody></table></figure><h4 id="使用Helm进行升级（可选）"><a href="#使用Helm进行升级（可选）" class="headerlink" title="使用Helm进行升级（可选）"></a>使用Helm进行升级（可选）</h4><p>如果使用Helm管理应用：</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 更新Helm Chart</span></span><br><span class="line">helm upgrade my-release my-chart --<span class="built_in">set</span> image.tag=v2.0</span><br></pre></td></tr></tbody></table></figure><h3 id="10-2-升级失败回滚"><a href="#10-2-升级失败回滚" class="headerlink" title="10.2 升级失败回滚"></a>10.2 升级失败回滚</h3><p>如果新版本出现问题，可以快速回滚：</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 查看升级历史</span></span><br><span class="line">kubectl rollout <span class="built_in">history</span> deployment/my-web-app</span><br><span class="line"></span><br><span class="line"><span class="comment"># 回滚到上一个版本</span></span><br><span class="line">kubectl rollout undo deployment/my-web-app</span><br><span class="line"></span><br><span class="line"><span class="comment"># 回滚到指定版本</span></span><br><span class="line">kubectl rollout undo deployment/my-web-app --to-revision=2</span><br></pre></td></tr></tbody></table></figure><h3 id="10-3-集群升级"><a href="#10-3-集群升级" class="headerlink" title="10.3 集群升级"></a>10.3 集群升级</h3><p>升级整个Kubernetes集群：</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 使用Sealos升级集群</span></span><br><span class="line">sealos run kubernetes:v1.26.0 calico:v3.25.0 \</span><br><span class="line">  --masters 192.168.1.100 \</span><br><span class="line">  --nodes 192.168.1.101,192.168.1.102</span><br></pre></td></tr></tbody></table></figure><h2 id="11-实战案例总结"><a href="#11-实战案例总结" class="headerlink" title="11. 实战案例总结"></a>11. 实战案例总结</h2><p>通过以上步骤，我们完成了一个完整的Sealos实战流程：</p><ol><li><strong>环境准备</strong>：在三台服务器上配置系统环境</li><li><strong>集群部署</strong>：使用Sealos快速部署Kubernetes集群</li><li><strong>应用部署</strong>：将Docker镜像部署到集群中</li><li><strong>配置管理</strong>：通过ConfigMap和Secret注入配置参数</li><li><strong>节点扩容</strong>：添加新的Worker节点和应用Pod</li><li><strong>容灾策略</strong>：配置高可用、备份和健康检查</li><li><strong>升级回滚</strong>：实现应用和集群的升级与回滚</li></ol><p>这种基于Sealos的部署方式大大简化了Kubernetes集群的部署和管理复杂度，使得运维团队可以更专注于应用本身，而不是基础设施的复杂性。</p><h2 id="12-Kubernetes核心概念和术语"><a href="#12-Kubernetes核心概念和术语" class="headerlink" title="12. Kubernetes核心概念和术语"></a>12. Kubernetes核心概念和术语</h2><p>在深入了解问题排查之前，让我们先梳理Kubernetes的层级结构和核心概念，从大到小排列：</p><h3 id="12-1-集群（Cluster）"><a href="#12-1-集群（Cluster）" class="headerlink" title="12.1 集群（Cluster）"></a>12.1 集群（Cluster）</h3><ul><li><strong>定义</strong>：由一个或多个节点组成的容器化应用平台</li><li><strong>实际例子</strong>：我们前面创建的名为<code>my-cluster</code>的Kubernetes集群</li><li><strong>映射</strong>：一个完整的Kubernetes环境，包含控制平面和工作节点</li><li><strong>对应命令</strong>：<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 查看集群信息</span></span><br><span class="line">kubectl cluster-info</span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查集群组件状态</span></span><br><span class="line">kubectl get componentstatuses</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看集群节点</span></span><br><span class="line">kubectl get nodes</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看集群版本信息</span></span><br><span class="line">kubectl version</span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查集群健康状况</span></span><br><span class="line">kubectl top nodes</span><br></pre></td></tr></tbody></table></figure></li></ul><h3 id="12-2-命名空间（Namespace）"><a href="#12-2-命名空间（Namespace）" class="headerlink" title="12.2 命名空间（Namespace）"></a>12.2 命名空间（Namespace）</h3><ul><li><strong>定义</strong>：集群中的虚拟子分区，用于隔离资源</li><li><strong>实际例子</strong>：default、kube-system、kube-public等</li><li><strong>映射</strong>：类似于操作系统的文件夹，用于组织和隔离不同环境的资源</li><li><strong>对应命令</strong>：<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 查看所有命名空间</span></span><br><span class="line">kubectl get namespaces</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建命名空间</span></span><br><span class="line">kubectl create namespace my-namespace</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在指定命名空间中操作资源</span></span><br><span class="line">kubectl get pods -n my-namespace</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看命名空间详细信息</span></span><br><span class="line">kubectl describe namespace my-namespace</span><br></pre></td></tr></tbody></table></figure></li></ul><h3 id="12-3-节点（Node）"><a href="#12-3-节点（Node）" class="headerlink" title="12.3 节点（Node）"></a>12.3 节点（Node）</h3><ul><li><strong>定义</strong>：集群中的工作机器，可以是物理机或虚拟机</li><li><strong>实际例子</strong>：我们使用的三台服务器（192.168.1.100、192.168.1.101、192.168.1.102）</li><li><strong>映射</strong>：192.168.1.100（Master节点）、192.168.1.101和192.168.1.102（Worker节点）</li><li><strong>对应命令</strong>：<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 查看所有节点</span></span><br><span class="line">kubectl get nodes</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看节点详细信息</span></span><br><span class="line">kubectl describe node &lt;node-name&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看节点资源使用情况</span></span><br><span class="line">kubectl top nodes</span><br><span class="line"></span><br><span class="line"><span class="comment"># 标记节点不可调度</span></span><br><span class="line">kubectl cordon &lt;node-name&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 标记节点可调度</span></span><br><span class="line">kubectl uncordon &lt;node-name&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安全驱逐节点上的Pod（用于维护）</span></span><br><span class="line">kubectl drain &lt;node-name&gt; --ignore-daemonsets</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看节点事件</span></span><br><span class="line">kubectl get events --field-selector involvedObject.kind=Node</span><br></pre></td></tr></tbody></table></figure></li></ul><h3 id="12-4-Pod"><a href="#12-4-Pod" class="headerlink" title="12.4 Pod"></a>12.4 Pod</h3><ul><li><strong>定义</strong>：Kubernetes中最小的部署单元，可包含一个或多个紧密相关的容器</li><li><strong>实际例子</strong>：my-web-app-7d5b9c8f4c-xyz12 这个Pod</li><li><strong>映射</strong>：一个逻辑主机，包含一个或多个共享存储、网络和规格定义的容器</li><li><strong>深入理解</strong>：<ul><li><strong>Pod不是Docker Compose服务组</strong>：一个Pod通常对应一个应用实例，而不是多个相关服务</li><li><strong>紧密相关容器</strong>：Pod中的多个容器需要共享存储和网络，协同完成一个任务<ul><li>例如：主应用容器 + 日志收集容器（如Filebeat）</li><li>例如：主应用容器 + 代理容器（如Envoy）</li><li>例如：主应用容器 + Sidecar容器（如Istio Proxy）</li></ul></li><li><strong>共享资源</strong>：<ul><li>网络：Pod内所有容器共享IP地址和端口空间</li><li>存储：Pod内所有容器可以共享存储卷</li></ul></li><li><strong>生命周期</strong>：Pod中的容器一起启动、停止和重启</li><li><strong>Docker Compose到Kubernetes的映射</strong>：<ul><li>Docker Compose中的一个服务 → Kubernetes中的一个Pod</li><li>Docker Compose中的多个服务 → Kubernetes中的多个Pod + Service</li></ul></li></ul></li><li><strong>对应命令</strong>：<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 查看Pod</span></span><br><span class="line">kubectl get pods -n &lt;namespace&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看Pod详细信息</span></span><br><span class="line">kubectl describe pod &lt;pod-name&gt; -n &lt;namespace&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看Pod日志</span></span><br><span class="line">kubectl logs &lt;pod-name&gt; -n &lt;namespace&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 实时查看Pod日志</span></span><br><span class="line">kubectl logs -f &lt;pod-name&gt; -n &lt;namespace&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 进入Pod容器</span></span><br><span class="line">kubectl <span class="built_in">exec</span> -it &lt;pod-name&gt; -n &lt;namespace&gt; -- bash</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看Pod YAML配置</span></span><br><span class="line">kubectl get pod &lt;pod-name&gt; -n &lt;namespace&gt; -o yaml</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除Pod（Deployment会自动重建）</span></span><br><span class="line">kubectl delete pod &lt;pod-name&gt; -n &lt;namespace&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看Pod资源使用情况</span></span><br><span class="line">kubectl top pods -n &lt;namespace&gt;</span><br></pre></td></tr></tbody></table></figure></li></ul><h3 id="12-5-容器（Container）"><a href="#12-5-容器（Container）" class="headerlink" title="12.5 容器（Container）"></a>12.5 容器（Container）</h3><ul><li><strong>定义</strong>：运行应用的轻量级虚拟化环境</li><li><strong>实际例子</strong>：my-web-app Pod中的web-container</li><li><strong>映射</strong>：Docker容器，运行具体的应用程序</li><li><strong>对应命令</strong>：<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 查看Pod中的容器</span></span><br><span class="line">kubectl get pods -n &lt;namespace&gt; -o jsonpath=<span class="string">'{.items[*].spec.containers[*].name}'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看特定容器的日志</span></span><br><span class="line">kubectl logs &lt;pod-name&gt; -c &lt;container-name&gt; -n &lt;namespace&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 进入特定容器</span></span><br><span class="line">kubectl <span class="built_in">exec</span> -it &lt;pod-name&gt; -c &lt;container-name&gt; -n &lt;namespace&gt; -- bash</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看容器镜像</span></span><br><span class="line">kubectl get pods -n &lt;namespace&gt; -o jsonpath=<span class="string">'{.items[*].spec.containers[*].image}'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看容器资源限制</span></span><br><span class="line">kubectl describe pod &lt;pod-name&gt; -n &lt;namespace&gt;</span><br></pre></td></tr></tbody></table></figure></li></ul><h3 id="12-6-服务（Service）"><a href="#12-6-服务（Service）" class="headerlink" title="12.6 服务（Service）"></a>12.6 服务（Service）</h3><ul><li><strong>定义</strong>：定义一组Pod的逻辑集合和访问策略，提供稳定的网络端点</li><li><strong>实际例子</strong>：my-web-app-service，为my-web-app的Pod提供稳定的访问地址</li><li><strong>映射</strong>：类似负载均衡器或代理，为一组Pod提供稳定的IP和DNS名称</li><li><strong>深入理解</strong>：<ul><li><strong>服务发现</strong>：通过标签选择器（label selector）发现后端Pod</li><li><strong>负载均衡</strong>：在后端Pod间分发流量，但不使用传统负载均衡算法</li><li><strong>稳定端点</strong>：即使Pod被重新调度，Service的IP和DNS名称保持不变</li><li><strong>服务类型</strong>：<ul><li>ClusterIP：仅在集群内部访问</li><li>NodePort：在集群节点上开放端口</li><li>LoadBalancer：创建外部负载均衡器</li><li>ExternalName：将服务映射到外部DNS名称</li></ul></li><li><strong>与Docker Compose的映射</strong>：<ul><li>Docker Compose服务间的连接 → Kubernetes中使用Service</li><li>Docker Compose的links功能 → Kubernetes中使用Service DNS名称</li></ul></li></ul></li><li><strong>对应命令</strong>：<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 查看服务</span></span><br><span class="line">kubectl get services -n &lt;namespace&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看服务详细信息</span></span><br><span class="line">kubectl describe service &lt;service-name&gt; -n &lt;namespace&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看服务端点（后端Pod IP）</span></span><br><span class="line">kubectl get endpoints &lt;service-name&gt; -n &lt;namespace&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看服务YAML配置</span></span><br><span class="line">kubectl get service &lt;service-name&gt; -n &lt;namespace&gt; -o yaml</span><br><span class="line"></span><br><span class="line"><span class="comment"># 测试服务连通性</span></span><br><span class="line">kubectl run test-pod --image=busybox --<span class="built_in">rm</span> -it --restart=Never -- nslookup &lt;service-name&gt;.&lt;namespace&gt;.svc.cluster.local</span><br><span class="line"></span><br><span class="line"><span class="comment"># 端口转发到服务</span></span><br><span class="line">kubectl port-forward service/&lt;service-name&gt; 8080:80 -n &lt;namespace&gt;</span><br></pre></td></tr></tbody></table></figure></li></ul><h3 id="12-7-控制器（Controller）"><a href="#12-7-控制器（Controller）" class="headerlink" title="12.7 控制器（Controller）"></a>12.7 控制器（Controller）</h3><ul><li><strong>定义</strong>：确保Pod按照预期状态运行的资源对象</li><li><strong>实际例子</strong>：Deployment、StatefulSet、DaemonSet等</li><li><strong>映射</strong>：Deployment控制器确保my-web-app始终有2个副本运行</li><li><strong>深入理解</strong>：<ul><li><strong>控制器类型</strong>：<ul><li>Deployment：管理无状态应用，支持滚动更新和回滚</li><li>StatefulSet：管理有状态应用，提供稳定的网络标识和持久存储</li><li>DaemonSet：确保所有节点运行一个Pod副本</li><li>Job/CronJob：管理一次性任务和定时任务</li></ul></li><li><strong>Pod调度与容灾</strong>：<ul><li>通过污点（Taints）和容忍度（Tolerations）控制Pod调度到特定节点</li><li>通过节点亲和性（Node Affinity）和反亲和性（Node Anti-Affinity）控制Pod部署位置</li><li>通过Pod反亲和性避免相同应用的Pod运行在同一节点上，实现容灾</li></ul></li><li><strong>与Docker Compose的映射</strong>：<ul><li>Docker Compose的replicas → Kubernetes中的Deployment replicas</li><li>Docker Compose的restart policy → Kubernetes的Pod重启策略</li></ul></li></ul></li><li><strong>对应命令</strong>：<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 查看Deployment</span></span><br><span class="line">kubectl get deployments -n &lt;namespace&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看Deployment详细信息</span></span><br><span class="line">kubectl describe deployment &lt;deployment-name&gt; -n &lt;namespace&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 扩容Deployment</span></span><br><span class="line">kubectl scale deployment &lt;deployment-name&gt; --replicas=5 -n &lt;namespace&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 更新Deployment镜像</span></span><br><span class="line">kubectl <span class="built_in">set</span> image deployment/&lt;deployment-name&gt; &lt;container-name&gt;=&lt;new-image&gt; -n &lt;namespace&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看Deployment升级历史</span></span><br><span class="line">kubectl rollout <span class="built_in">history</span> deployment &lt;deployment-name&gt; -n &lt;namespace&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 回滚Deployment</span></span><br><span class="line">kubectl rollout undo deployment &lt;deployment-name&gt; -n &lt;namespace&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 暂停/恢复Deployment rollout</span></span><br><span class="line">kubectl rollout pause deployment &lt;deployment-name&gt; -n &lt;namespace&gt;</span><br><span class="line">kubectl rollout resume deployment &lt;deployment-name&gt; -n &lt;namespace&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看控制器管理的Pod</span></span><br><span class="line">kubectl get pods -l &lt;label-key&gt;=&lt;label-value&gt; -n &lt;namespace&gt;</span><br></pre></td></tr></tbody></table></figure></li></ul><h3 id="12-8-配置和存储资源"><a href="#12-8-配置和存储资源" class="headerlink" title="12.8 配置和存储资源"></a>12.8 配置和存储资源</h3><ul><li><strong>ConfigMap</strong>：存储非敏感配置数据</li><li><strong>Secret</strong>：存储敏感数据如密码、密钥</li><li><strong>PersistentVolume/PersistentVolumeClaim</strong>：提供持久化存储</li><li><strong>对应命令</strong>：<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># ConfigMap命令</span></span><br><span class="line"><span class="comment"># 查看ConfigMap</span></span><br><span class="line">kubectl get configmaps -n &lt;namespace&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看ConfigMap详细信息</span></span><br><span class="line">kubectl describe configmap &lt;configmap-name&gt; -n &lt;namespace&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建ConfigMap</span></span><br><span class="line">kubectl create configmap &lt;configmap-name&gt; --from-literal=key1=value1 --from-literal=key2=value2 -n &lt;namespace&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 从文件创建ConfigMap</span></span><br><span class="line">kubectl create configmap &lt;configmap-name&gt; --from-file=config.properties -n &lt;namespace&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Secret命令</span></span><br><span class="line"><span class="comment"># 查看Secret</span></span><br><span class="line">kubectl get secrets -n &lt;namespace&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看Secret详细信息</span></span><br><span class="line">kubectl describe secret &lt;secret-name&gt; -n &lt;namespace&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建Secret</span></span><br><span class="line">kubectl create secret generic &lt;secret-name&gt; --from-literal=key1=value1 -n &lt;namespace&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 从文件创建Secret</span></span><br><span class="line">kubectl create secret generic &lt;secret-name&gt; --from-file=ssh-privatekey=/path/to/key -n &lt;namespace&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看Secret内容（编码后的）</span></span><br><span class="line">kubectl get secret &lt;secret-name&gt; -n &lt;namespace&gt; -o yaml</span><br><span class="line"></span><br><span class="line"><span class="comment"># PersistentVolume/PersistentVolumeClaim命令</span></span><br><span class="line"><span class="comment"># 查看PersistentVolume</span></span><br><span class="line">kubectl get pv</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看PersistentVolumeClaim</span></span><br><span class="line">kubectl get pvc -n &lt;namespace&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看PersistentVolume详细信息</span></span><br><span class="line">kubectl describe pv &lt;pv-name&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看PersistentVolumeClaim详细信息</span></span><br><span class="line">kubectl describe pvc &lt;pvc-name&gt; -n &lt;namespace&gt;</span><br></pre></td></tr></tbody></table></figure></li></ul><h2 id="13-常见问题排查"><a href="#13-常见问题排查" class="headerlink" title="13. 常见问题排查"></a>13. 常见问题排查</h2><p>在运维Kubernetes集群和应用时，掌握常见问题排查方法非常重要。以下是几个关键的排查入口和技巧：</p><h3 id="13-1-从集群状态开始排查"><a href="#13-1-从集群状态开始排查" class="headerlink" title="13.1 从集群状态开始排查"></a>13.1 从集群状态开始排查</h3><p>首先检查集群整体状态：</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 检查节点状态</span></span><br><span class="line">kubectl get nodes</span><br><span class="line"><span class="comment"># 确保所有节点处于Ready状态</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查核心组件状态</span></span><br><span class="line">kubectl get cs  <span class="comment"># (已弃用，使用下面的命令)</span></span><br><span class="line">kubectl get componentstatuses</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看所有命名空间</span></span><br><span class="line">kubectl get namespaces</span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查命名空间中的资源</span></span><br><span class="line">kubectl get all --all-namespaces</span><br></pre></td></tr></tbody></table></figure><h3 id="12-2-检查Pod状态和事件"><a href="#12-2-检查Pod状态和事件" class="headerlink" title="12.2 检查Pod状态和事件"></a>12.2 检查Pod状态和事件</h3><p>Pod是最基本的部署单元，是排查问题的起点：</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 查看Pod状态</span></span><br><span class="line">kubectl get pods -n &lt;namespace&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看Pod详细信息和事件</span></span><br><span class="line">kubectl describe pod &lt;pod-name&gt; -n &lt;namespace&gt;</span><br><span class="line"><span class="comment"># 关注Events部分，通常包含错误信息</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查Pod的YAML定义</span></span><br><span class="line">kubectl get pod &lt;pod-name&gt; -n &lt;namespace&gt; -o yaml</span><br></pre></td></tr></tbody></table></figure><h3 id="12-3-查看应用日志"><a href="#12-3-查看应用日志" class="headerlink" title="12.3 查看应用日志"></a>12.3 查看应用日志</h3><p>查看应用容器的日志是排查问题的重要手段：</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 查看Pod中主容器的日志</span></span><br><span class="line">kubectl logs &lt;pod-name&gt; -n &lt;namespace&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看Pod中指定容器的日志（多容器Pod）</span></span><br><span class="line">kubectl logs &lt;pod-name&gt; -c &lt;container-name&gt; -n &lt;namespace&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看最近的日志（例如最后100行）</span></span><br><span class="line">kubectl logs &lt;pod-name&gt; --<span class="built_in">tail</span>=100 -n &lt;namespace&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 实时查看日志流</span></span><br><span class="line">kubectl logs -f &lt;pod-name&gt; -n &lt;namespace&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看过去一小时的日志</span></span><br><span class="line">kubectl logs &lt;pod-name&gt; --since=1h -n &lt;namespace&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看重启前的容器日志</span></span><br><span class="line">kubectl logs &lt;pod-name&gt; --previous -n &lt;namespace&gt;</span><br></pre></td></tr></tbody></table></figure><h3 id="12-4-进入容器调试"><a href="#12-4-进入容器调试" class="headerlink" title="12.4 进入容器调试"></a>12.4 进入容器调试</h3><p>当需要直接进入容器内部进行调试时：</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 进入容器执行交互式命令</span></span><br><span class="line">kubectl <span class="built_in">exec</span> -it &lt;pod-name&gt; -n &lt;namespace&gt; -- bash</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在容器中执行单个命令</span></span><br><span class="line">kubectl <span class="built_in">exec</span> &lt;pod-name&gt; -n &lt;namespace&gt; -- <span class="built_in">ls</span> -la /</span><br><span class="line"></span><br><span class="line"><span class="comment"># 进入多容器Pod中的指定容器</span></span><br><span class="line">kubectl <span class="built_in">exec</span> -it &lt;pod-name&gt; -c &lt;container-name&gt; -n &lt;namespace&gt; -- sh</span><br></pre></td></tr></tbody></table></figure><h3 id="12-5-检查资源使用情况"><a href="#12-5-检查资源使用情况" class="headerlink" title="12.5 检查资源使用情况"></a>12.5 检查资源使用情况</h3><p>查看Pod和节点的资源使用情况：</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 查看Pod的资源使用情况</span></span><br><span class="line">kubectl top pods -n &lt;namespace&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看节点的资源使用情况</span></span><br><span class="line">kubectl top nodes</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取Pod的详细资源配额</span></span><br><span class="line">kubectl describe pod &lt;pod-name&gt; -n &lt;namespace&gt;</span><br><span class="line"><span class="comment"># 在"Conditions"和"QoS"部分查看资源相关信息</span></span><br></pre></td></tr></tbody></table></figure><h3 id="12-6-检查服务和网络"><a href="#12-6-检查服务和网络" class="headerlink" title="12.6 检查服务和网络"></a>12.6 检查服务和网络</h3><p>排查服务访问和网络连接问题：</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 查看服务状态</span></span><br><span class="line">kubectl get svc -n &lt;namespace&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看服务详细信息</span></span><br><span class="line">kubectl describe svc &lt;service-name&gt; -n &lt;namespace&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 测试服务连通性（在集群内部）</span></span><br><span class="line">kubectl run test-pod --image=busybox --<span class="built_in">rm</span> -it --restart=Never -- nslookup &lt;service-name&gt;.&lt;namespace&gt;.svc.cluster.local</span><br><span class="line"></span><br><span class="line"><span class="comment"># 端口转发进行本地测试</span></span><br><span class="line">kubectl port-forward &lt;pod-name&gt; 8080:80 -n &lt;namespace&gt;</span><br></pre></td></tr></tbody></table></figure><h3 id="12-7-检查配置和密钥"><a href="#12-7-检查配置和密钥" class="headerlink" title="12.7 检查配置和密钥"></a>12.7 检查配置和密钥</h3><p>验证配置和密钥是否正确挂载到Pod中：</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 查看ConfigMap内容</span></span><br><span class="line">kubectl get configmap &lt;configmap-name&gt; -n &lt;namespace&gt; -o yaml</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看Secret内容（注意敏感信息）</span></span><br><span class="line">kubectl get secret &lt;secret-name&gt; -n &lt;namespace&gt; -o yaml</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在Pod中检查挂载的配置</span></span><br><span class="line">kubectl <span class="built_in">exec</span> -it &lt;pod-name&gt; -n &lt;namespace&gt; -- <span class="built_in">ls</span> /etc/config</span><br></pre></td></tr></tbody></table></figure><h3 id="12-8-排查常见问题"><a href="#12-8-排查常见问题" class="headerlink" title="12.8 排查常见问题"></a>12.8 排查常见问题</h3><h4 id="Pod处于Pending状态"><a href="#Pod处于Pending状态" class="headerlink" title="Pod处于Pending状态"></a>Pod处于Pending状态</h4><ul><li>检查是否有足够的资源</li><li>检查节点选择器和污点容忍度配置</li></ul><h4 id="Pod处于CrashLoopBackOff状态"><a href="#Pod处于CrashLoopBackOff状态" class="headerlink" title="Pod处于CrashLoopBackOff状态"></a>Pod处于CrashLoopBackOff状态</h4><ul><li>查看容器日志</li><li>检查启动脚本和配置</li><li>检查资源限制是否过小</li></ul><h4 id="Pod处于ImagePullBackOff状态"><a href="#Pod处于ImagePullBackOff状态" class="headerlink" title="Pod处于ImagePullBackOff状态"></a>Pod处于ImagePullBackOff状态</h4><ul><li>检查镜像名称和标签是否正确</li><li>检查镜像仓库访问权限</li></ul><h4 id="服务无法访问"><a href="#服务无法访问" class="headerlink" title="服务无法访问"></a>服务无法访问</h4><ul><li>检查Service和Pod的标签选择器是否匹配</li><li>检查端口配置是否正确</li><li>验证网络策略是否有误</li></ul><h3 id="12-9-使用Sealos排查集群问题"><a href="#12-9-使用Sealos排查集群问题" class="headerlink" title="12.9 使用Sealos排查集群问题"></a>12.9 使用Sealos排查集群问题</h3><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 检查Sealos集群状态</span></span><br><span class="line">sealos status</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在节点上执行命令</span></span><br><span class="line">sealos <span class="built_in">exec</span> --hosts 192.168.1.100 <span class="string">"systemctl status kubelet"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看集群证书信息</span></span><br><span class="line">sealos cert</span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查节点是否正常</span></span><br><span class="line">kubectl get nodes -o wide</span><br></pre></td></tr></tbody></table></figure><h2 id="13-最佳实践"><a href="#13-最佳实践" class="headerlink" title="13. 最佳实践"></a>13. 最佳实践</h2><ol><li><strong>安全</strong>：始终使用RBAC控制访问权限，定期更新证书和密钥</li><li><strong>监控</strong>：部署Prometheus和Grafana等监控工具</li><li><strong>日志</strong>：使用EFK（Elasticsearch, Fluentd, Kibana）收集和分析日志</li><li><strong>备份</strong>：定期备份重要数据和配置</li><li><strong>网络策略</strong>：配置网络策略以限制Pod间通信</li><li><strong>资源管理</strong>：使用ResourceQuota和LimitRange控制资源使用</li></ol><p>通过遵循这些最佳实践，可以构建一个安全、可靠、高效且易于维护的Kubernetes集群。</p>]]></content>
      
      
      
        <tags>
            
            <tag> 容器化 </tag>
            
            <tag> 运维 </tag>
            
            <tag> k8s </tag>
            
            <tag> sealos </tag>
            
            <tag> 部署 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>k8s命令集合</title>
      <link href="/2025/12/07/0003.k8s-ming-ling-ji-he/"/>
      <url>/2025/12/07/0003.k8s-ming-ling-ji-he/</url>
      
        <content type="html"><![CDATA[<h1 id="Docker-命令集合"><a href="#Docker-命令集合" class="headerlink" title="Docker 命令集合"></a>Docker 命令集合</h1><h2 id="1-系统信息查看命令"><a href="#1-系统信息查看命令" class="headerlink" title="1. 系统信息查看命令"></a>1. 系统信息查看命令</h2><p><strong>命令格式：</strong></p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">docker version</span><br><span class="line">docker info</span><br></pre></td></tr></tbody></table></figure><p><strong>功能说明：</strong></p><ul><li><code>docker version</code>: 查看Docker客户端和服务器的版本信息</li><li><code>docker info</code>: 显示Docker系统详细信息，包括容器、镜像数量，存储驱动，网络配置等</li></ul><p><strong>使用场景：</strong></p><ul><li>检查Docker安装是否成功</li><li>查看Docker版本及系统配置</li><li>排查Docker相关问题时获取系统信息</li></ul><h2 id="2-镜像管理命令"><a href="#2-镜像管理命令" class="headerlink" title="2. 镜像管理命令"></a>2. 镜像管理命令</h2><p><strong>命令格式：</strong></p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">docker images           <span class="comment"># 列出本地镜像</span></span><br><span class="line">docker pull &lt;镜像名&gt;    <span class="comment"># 下载镜像</span></span><br><span class="line">docker search &lt;镜像名&gt;  <span class="comment"># 搜索镜像</span></span><br><span class="line">docker rmi &lt;镜像ID或名称&gt; <span class="comment"># 删除镜像</span></span><br><span class="line">docker commit &lt;容器ID&gt; &lt;新镜像名&gt; <span class="comment"># 从容器创建新镜像</span></span><br><span class="line">docker save -o &lt;文件名&gt; &lt;镜像名&gt; <span class="comment"># 保存镜像为tar文件</span></span><br><span class="line">docker load -i &lt;文件名&gt; <span class="comment"># 从tar文件加载镜像</span></span><br><span class="line">docker build -t &lt;镜像名&gt; . <span class="comment"># 从Dockerfile构建镜像</span></span><br></pre></td></tr></tbody></table></figure><p><strong>功能说明：</strong></p><ul><li><code>docker images</code>: 列出本地所有镜像</li><li><code>docker pull</code>: 从仓库下载镜像</li><li><code>docker search</code>: 在Docker Hub搜索镜像</li><li><code>docker rmi</code>: 删除本地镜像</li><li><code>docker commit</code>: 从容器创建新镜像</li><li><code>docker save/load</code>: 镜像的导入导出</li><li><code>docker build</code>: 从Dockerfile构建镜像</li></ul><p><strong>使用场景：</strong></p><ul><li>下载和管理Docker镜像</li><li>构建和分享自定义镜像</li><li>镜像的备份和迁移</li></ul><h2 id="3-容器管理命令"><a href="#3-容器管理命令" class="headerlink" title="3. 容器管理命令"></a>3. 容器管理命令</h2><p><strong>命令格式：</strong></p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">docker run [OPTIONS] &lt;镜像名&gt; [命令] <span class="comment"># 运行容器</span></span><br><span class="line">docker ps [-a] <span class="comment"># 列出容器</span></span><br><span class="line">docker start &lt;容器ID或名称&gt; <span class="comment"># 启动容器</span></span><br><span class="line">docker stop &lt;容器ID或名称&gt; <span class="comment"># 停止容器</span></span><br><span class="line">docker restart &lt;容器ID或名称&gt; <span class="comment"># 重启容器</span></span><br><span class="line">docker <span class="built_in">kill</span> &lt;容器ID或名称&gt; <span class="comment"># 强制停止容器</span></span><br><span class="line">docker <span class="built_in">rm</span> &lt;容器ID或名称&gt; <span class="comment"># 删除容器</span></span><br><span class="line">docker pause &lt;容器ID&gt; <span class="comment"># 暂停容器</span></span><br><span class="line">docker unpause &lt;容器ID&gt; <span class="comment"># 恢复容器</span></span><br></pre></td></tr></tbody></table></figure><p><strong>功能说明：</strong></p><ul><li><code>docker run</code>: 创建并运行容器</li><li><code>docker ps</code>: 列出正在运行的容器，-a显示所有容器</li><li><code>docker start/stop/restart</code>: 容器的基本操作</li><li><code>docker kill</code>: 立即终止容器</li><li><code>docker rm</code>: 删除已停止的容器</li><li><code>docker pause/unpause</code>: 暂停/恢复容器</li></ul><p><strong>使用场景：</strong></p><ul><li>启动、停止和管理容器</li><li>部署和运行应用程序</li><li>容器生命周期管理</li></ul><h2 id="4-容器交互命令"><a href="#4-容器交互命令" class="headerlink" title="4. 容器交互命令"></a>4. 容器交互命令</h2><p><strong>命令格式：</strong></p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> [OPTIONS] &lt;容器ID或名称&gt; &lt;命令&gt;</span><br><span class="line">docker attach &lt;容器ID或名称&gt;</span><br><span class="line">docker logs &lt;容器ID或名称&gt;</span><br><span class="line">docker top &lt;容器ID或名称&gt;</span><br><span class="line">docker stats &lt;容器ID或名称&gt; <span class="comment"># 查看容器资源使用情况</span></span><br></pre></td></tr></tbody></table></figure><p><strong>功能说明：</strong></p><ul><li><code>docker exec</code>: 在运行的容器中执行命令</li><li><code>docker attach</code>: 连接到正在运行的容器</li><li><code>docker logs</code>: 查看容器日志</li><li><code>docker top</code>: 显示容器内的进程</li><li><code>docker stats</code>: 实时监控容器资源使用</li></ul><p><strong>使用场景：</strong></p><ul><li>进入容器内部进行调试</li><li>查看容器运行状态和日志</li><li>监控容器内进程和资源使用</li></ul><h2 id="5-网络和存储命令"><a href="#5-网络和存储命令" class="headerlink" title="5. 网络和存储命令"></a>5. 网络和存储命令</h2><p><strong>命令格式：</strong></p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">docker network <span class="built_in">ls</span></span><br><span class="line">docker network create &lt;网络名&gt;</span><br><span class="line">docker network <span class="built_in">rm</span> &lt;网络名&gt;</span><br><span class="line">docker volume <span class="built_in">ls</span></span><br><span class="line">docker volume create &lt;卷名&gt;</span><br><span class="line">docker volume <span class="built_in">rm</span> &lt;卷名&gt;</span><br><span class="line">docker volume prune <span class="comment"># 清理未使用的卷</span></span><br></pre></td></tr></tbody></table></figure><p><strong>功能说明：</strong></p><ul><li><code>docker network</code>: 管理Docker网络</li><li><code>docker volume</code>: 管理Docker数据卷</li><li><code>docker volume prune</code>: 清理未使用的卷</li></ul><p><strong>使用场景：</strong></p><ul><li>创建和管理容器网络</li><li>数据持久化存储</li><li>容器间通信配置</li></ul><h2 id="6-其他重要运维命令"><a href="#6-其他重要运维命令" class="headerlink" title="6. 其他重要运维命令"></a>6. 其他重要运维命令</h2><p><strong>命令格式：</strong></p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">docker inspect &lt;容器ID或镜像ID&gt; <span class="comment"># 查看详细配置信息</span></span><br><span class="line">docker <span class="built_in">cp</span> &lt;源&gt; &lt;目标&gt; <span class="comment"># 在容器和主机间复制文件</span></span><br><span class="line">docker tag &lt;源镜像&gt; &lt;目标镜像&gt; <span class="comment"># 为镜像打标签</span></span><br><span class="line">docker system <span class="built_in">df</span> <span class="comment"># 查看Docker磁盘使用情况</span></span><br><span class="line">docker system prune <span class="comment"># 清理未使用的资源</span></span><br></pre></td></tr></tbody></table></figure><p><strong>功能说明：</strong></p><ul><li><code>docker inspect</code>: 查看对象（容器、镜像、网络等）的详细配置</li><li><code>docker cp</code>: 文件在容器和主机间复制</li><li><code>docker tag</code>: 为镜像添加标签</li><li><code>docker system df</code>: 查看Docker磁盘使用情况</li><li><code>docker system prune</code>: 清理未使用的资源</li></ul><p><strong>使用场景：</strong></p><ul><li>监控容器性能</li><li>查看和调试容器、镜像配置</li><li>数据备份和迁移</li><li>系统资源管理和清理</li></ul><h2 id="7-安全和登录命令"><a href="#7-安全和登录命令" class="headerlink" title="7. 安全和登录命令"></a>7. 安全和登录命令</h2><p><strong>命令格式：</strong></p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">docker login [SERVER]</span><br><span class="line">docker <span class="built_in">logout</span> [SERVER]</span><br><span class="line">docker events</span><br><span class="line">docker run --<span class="built_in">rm</span> -it alpine:latest <span class="comment"># 临时运行容器</span></span><br></pre></td></tr></tbody></table></figure><p><strong>功能说明：</strong></p><ul><li><code>docker login</code>: 登录Docker仓库</li><li><code>docker logout</code>: 退出Docker仓库</li><li><code>docker events</code>: 获取实时事件</li><li>在运行命令中使用<code>--rm</code>选项自动删除容器</li></ul><p><strong>使用场景：</strong></p><ul><li>推送镜像到私有仓库</li><li>安全认证</li><li>监控Docker活动</li><li>临时任务执行</li></ul><h1 id="Sealos-命令集合"><a href="#Sealos-命令集合" class="headerlink" title="Sealos 命令集合"></a>Sealos 命令集合</h1><h2 id="1-集群管理命令"><a href="#1-集群管理命令" class="headerlink" title="1. 集群管理命令"></a>1. 集群管理命令</h2><p><strong>命令格式：</strong></p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">sealos run &lt;镜像名&gt; [可选参数] <span class="comment"># 运行集群镜像，快速部署应用</span></span><br><span class="line">sealos apply -f Clusterfile <span class="comment"># 使用Clusterfile运行集群镜像</span></span><br><span class="line">sealos reset <span class="comment"># 重置集群中的所有内容</span></span><br><span class="line">sealos status <span class="comment"># 查看Sealos集群的状态</span></span><br><span class="line">sealos cert <span class="comment"># 更新Kubernetes API服务器的证书</span></span><br><span class="line">sealos gen <span class="comment"># 生成具有所有默认设置的Clusterfile</span></span><br></pre></td></tr></tbody></table></figure><p><strong>功能说明：</strong></p><ul><li><code>sealos run</code>: 轻松运行云原生应用，是部署集群的常用方式</li><li><code>sealos apply</code>: 使用Clusterfile在Kubernetes集群内运行集群镜像</li><li><code>sealos reset</code>: 完全清理集群，重置到初始状态</li><li><code>sealos status</code>: 检查当前集群的状态</li><li><code>sealos cert</code>: 更新集群API服务器的证书</li><li><code>sealos gen</code>: 生成集群配置文件模板</li></ul><p><strong>使用场景：</strong></p><ul><li>部署和初始化Kubernetes集群</li><li>集群状态检查和维护</li><li>证书更新和管理</li><li>集群配置文件创建</li></ul><h2 id="2-节点管理命令"><a href="#2-节点管理命令" class="headerlink" title="2. 节点管理命令"></a>2. 节点管理命令</h2><p><strong>命令格式：</strong></p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">sealos add --masters &lt;IP列表&gt; <span class="comment"># 添加master节点到集群</span></span><br><span class="line">sealos add --nodes &lt;IP列表&gt; <span class="comment"># 添加node节点到集群</span></span><br><span class="line">sealos delete --masters &lt;IP列表&gt; <span class="comment"># 从集群中删除master节点</span></span><br><span class="line">sealos delete --nodes &lt;IP列表&gt; <span class="comment"># 从集群中删除node节点</span></span><br><span class="line">sealos <span class="built_in">exec</span> -m <span class="string">"command"</span> <span class="comment"># 在所有master节点上执行命令</span></span><br><span class="line">sealos <span class="built_in">exec</span> -n <span class="string">"command"</span> <span class="comment"># 在所有node节点上执行命令</span></span><br></pre></td></tr></tbody></table></figure><p><strong>功能说明：</strong></p><ul><li><code>sealos add</code>: 向集群中添加master或node节点</li><li><code>sealos delete</code>: 从集群中删除master或node节点</li><li><code>sealos exec</code>: 在特定类型的节点上执行命令</li></ul><p><strong>使用场景：</strong></p><ul><li>集群水平扩展，增加节点</li><li>节点维护或故障后移除节点</li><li>在集群节点上执行维护任务</li></ul><h2 id="3-远程操作命令"><a href="#3-远程操作命令" class="headerlink" title="3. 远程操作命令"></a>3. 远程操作命令</h2><p><strong>命令格式：</strong></p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">sealos <span class="built_in">exec</span> --hosts &lt;IP地址&gt; <span class="string">"command"</span> <span class="comment"># 在指定节点上执行命令</span></span><br><span class="line">sealos scp &lt;本地文件&gt; &lt;节点IP:远程路径&gt; <span class="comment"># 将文件复制到指定节点</span></span><br><span class="line">sealos scp &lt;节点IP:远程文件&gt; &lt;本地路径&gt; <span class="comment"># 从指定节点复制文件</span></span><br></pre></td></tr></tbody></table></figure><p><strong>功能说明：</strong></p><ul><li><code>sealos exec</code>: 在远程节点上执行shell命令或脚本</li><li><code>sealos scp</code>: 在本地与节点之间复制文件</li></ul><p><strong>使用场景：</strong></p><ul><li>在远程节点上执行诊断或管理任务</li><li>向节点传输配置文件或脚本</li><li>远程收集日志或配置文件</li></ul><h2 id="4-容器和镜像命令"><a href="#4-容器和镜像命令" class="headerlink" title="4. 容器和镜像命令"></a>4. 容器和镜像命令</h2><p><strong>命令格式：</strong></p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">sealos images <span class="comment"># 列出本地存储中的镜像</span></span><br><span class="line">sealos pull &lt;镜像名&gt; <span class="comment"># 从指定位置拉取镜像</span></span><br><span class="line">sealos push &lt;镜像名&gt; &lt;目标地址&gt; <span class="comment"># 将镜像推送到指定的目标</span></span><br><span class="line">sealos rmi &lt;镜像名或ID&gt; <span class="comment"># 从本地存储中删除一个或多个镜像</span></span><br><span class="line">sealos save -o &lt;文件名&gt; &lt;镜像名&gt; <span class="comment"># 将镜像保存到存档文件中</span></span><br><span class="line">sealos load -i &lt;文件名&gt; <span class="comment"># 从文件中加载镜像</span></span><br><span class="line">sealos tag &lt;源镜像&gt; &lt;目标镜像&gt; <span class="comment"># 为本地镜像添加一个附加名称</span></span><br><span class="line">sealos build -t &lt;镜像名&gt; . <span class="comment"># 构建自定义集群镜像</span></span><br></pre></td></tr></tbody></table></figure><p><strong>功能说明：</strong></p><ul><li><code>sealos images/pull/push/rmi/save/load/tag</code>: 镜像的基本操作</li><li><code>sealos build</code>: 使用Sealfile或Kubefile构建集群镜像</li></ul><p><strong>使用场景：</strong></p><ul><li>集群镜像管理</li><li>构建和推送自定义集群镜像</li><li>镜像的备份和迁移</li></ul><h2 id="5-其他辅助命令"><a href="#5-其他辅助命令" class="headerlink" title="5. 其他辅助命令"></a>5. 其他辅助命令</h2><p><strong>命令格式：</strong></p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">sealos completion &lt;shell&gt; <span class="comment"># 为指定的shell生成自动补全脚本</span></span><br><span class="line">sealos version <span class="comment"># 打印版本信息</span></span><br><span class="line">sealos <span class="built_in">env</span> <span class="comment"># 打印Sealos使用的所有环境信息</span></span><br><span class="line">sealos login &lt;仓库地址&gt; <span class="comment"># 登录到容器仓库</span></span><br><span class="line">sealos <span class="built_in">logout</span> <span class="comment"># 登出容器仓库</span></span><br><span class="line">sealos inspect &lt;镜像名&gt; <span class="comment"># 检查容器或镜像的配置</span></span><br></pre></td></tr></tbody></table></figure><p><strong>功能说明：</strong></p><ul><li><code>sealos completion</code>: 配置命令行自动补全功能</li><li><code>sealos version/env</code>: 检查版本和环境信息</li><li><code>sealos login/logout</code>: 容器仓库认证</li><li><code>sealos inspect</code>: 查看镜像或容器的详细配置</li></ul><p><strong>使用场景：</strong></p><ul><li>提高命令行操作效率</li><li>检查Sealos安装和配置</li><li>仓库访问认证</li><li>镜像详细信息查看</li></ul><h1 id="Kubectl-命令集合"><a href="#Kubectl-命令集合" class="headerlink" title="Kubectl 命令集合"></a>Kubectl 命令集合</h1><h2 id="1-基础语法"><a href="#1-基础语法" class="headerlink" title="1. 基础语法"></a>1. 基础语法</h2><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">kubectl [command] [TYPE] [NAME] [flags]</span><br></pre></td></tr></tbody></table></figure><ul><li><strong>command</strong>：指定要对一个或多个资源执行的操作，如create、get、describe和delete</li><li><strong>TYPE</strong>：指定资源类型，不区分大小写，可以为单数、复数或缩写形式</li><li><strong>NAME</strong>：指定资源的名称，区分大小写，若省略则显示所有资源</li><li><strong>flags</strong>：指定可选参数，如-s或–server参数指定Kubernetes API服务器的地址和端口</li></ul><h2 id="2-资源查看与查询命令"><a href="#2-资源查看与查询命令" class="headerlink" title="2. 资源查看与查询命令"></a>2. 资源查看与查询命令</h2><p><strong>命令格式：</strong></p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">kubectl get pods -A                    <span class="comment"># 列出所有命名空间中的Pod</span></span><br><span class="line">kubectl get nodes                      <span class="comment"># 获取所有节点信息</span></span><br><span class="line">kubectl get deployments -n namespace   <span class="comment"># 获取指定命名空间下的部署信息</span></span><br><span class="line">kubectl get services                   <span class="comment"># 获取服务信息</span></span><br><span class="line">kubectl get pv,pvc                     <span class="comment"># 获取持久卷和持久卷申领信息</span></span><br><span class="line">kubectl get all -n namespace           <span class="comment"># 获取指定命名空间下所有资源</span></span><br><span class="line">kubectl get pods --watch               <span class="comment"># 实时监控Pod状态变化</span></span><br><span class="line">kubectl get events                     <span class="comment"># 查看集群事件</span></span><br></pre></td></tr></tbody></table></figure><p><strong>功能说明：</strong></p><ul><li><code>kubectl get</code>: 获取资源对象的基本信息</li><li>支持各种资源类型（pods, services, deployments等）</li></ul><p><strong>使用场景：</strong></p><ul><li>检查集群整体运行状况</li><li>查看节点健康状态</li><li>检查应用部署状态</li><li>查看服务暴露情况</li></ul><h2 id="3-资源创建与管理命令"><a href="#3-资源创建与管理命令" class="headerlink" title="3. 资源创建与管理命令"></a>3. 资源创建与管理命令</h2><p><strong>命令格式：</strong></p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">kubectl create -f resource.yaml                    <span class="comment"># 从配置文件创建资源</span></span><br><span class="line">kubectl apply -f resource.yaml                    <span class="comment"># 应用资源配置(创建或更新)</span></span><br><span class="line">kubectl apply -f &lt;directory&gt;                      <span class="comment"># 应用目录下所有配置文件</span></span><br><span class="line">kubectl delete pod pod_name                       <span class="comment"># 删除指定Pod</span></span><br><span class="line">kubectl delete -f resource.yaml                   <span class="comment"># 从配置文件删除资源</span></span><br><span class="line">kubectl scale deployment deployment_name --replicas=N  <span class="comment"># 扩缩容部署副本数</span></span><br><span class="line">kubectl expose deployment deployment_name --port=port   <span class="comment"># 暴露服务</span></span><br><span class="line">kubectl label pods pod_name key=value             <span class="comment"># 为Pod添加标签</span></span><br><span class="line">kubectl annotate pods pod_name key=value          <span class="comment"># 为Pod添加注解</span></span><br></pre></td></tr></tbody></table></figure><p><strong>功能说明：</strong></p><ul><li><code>kubectl create/apply</code>: 创建或更新资源对象</li><li><code>kubectl delete</code>: 删除资源对象</li><li><code>kubectl scale</code>: 调整应用副本数量</li><li><code>kubectl expose</code>: 创建Service关联Deployment</li></ul><p><strong>使用场景：</strong></p><ul><li>从配置文件创建资源</li><li>生产环境推荐使用apply进行更新</li><li>动态调整应用负载能力</li><li>删除异常或不需要的资源</li></ul><h2 id="4-资源描述与调试命令"><a href="#4-资源描述与调试命令" class="headerlink" title="4. 资源描述与调试命令"></a>4. 资源描述与调试命令</h2><p><strong>命令格式：</strong></p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">kubectl describe pod pod_name                       <span class="comment"># 显示Pod详细信息和事件</span></span><br><span class="line">kubectl describe node node_name                   <span class="comment"># 显示节点详细信息</span></span><br><span class="line">kubectl describe deployment deployment_name       <span class="comment"># 显示部署详细信息</span></span><br><span class="line">kubectl logs pod_name                             <span class="comment"># 查看Pod日志</span></span><br><span class="line">kubectl logs pod_name -f                          <span class="comment"># 实时查看Pod日志流</span></span><br><span class="line">kubectl logs pod_name --<span class="built_in">tail</span>=100                  <span class="comment"># 查看Pod最后100行日志</span></span><br><span class="line">kubectl <span class="built_in">exec</span> -it pod_name -- bash                 <span class="comment"># 进入Pod执行交互命令</span></span><br><span class="line">kubectl <span class="built_in">exec</span> -it pod_name -- sh                   <span class="comment"># 进入Pod执行sh命令</span></span><br><span class="line">kubectl port-forward pod_name local_port:pod_port <span class="comment"># 端口转发到本地</span></span><br><span class="line">kubectl <span class="built_in">cp</span> /path/to/file &lt;pod&gt;:/path/to/file      <span class="comment"># 在Pod和本地间复制文件</span></span><br><span class="line">kubectl top nodes                                 <span class="comment"># 显示节点资源使用情况</span></span><br><span class="line">kubectl top pods -n namespace                     <span class="comment"># 显示Pod资源使用情况</span></span><br></pre></td></tr></tbody></table></figure><p><strong>功能说明：</strong></p><ul><li><code>kubectl describe</code>: 显示资源的详细配置和状态信息</li><li><code>kubectl logs</code>: 查看容器日志</li><li><code>kubectl exec</code>: 在Pod中执行命令</li><li><code>kubectl port-forward</code>: 端口转发用于调试</li><li><code>kubectl top</code>: 显示资源使用情况</li></ul><p><strong>使用场景：</strong></p><ul><li>排查Pod启动失败问题</li><li>查看应用运行状态和资源使用</li><li>调试容器内部环境</li><li>实时监控应用输出</li><li>本地调试集群内服务</li></ul><h2 id="5-配置与更新命令"><a href="#5-配置与更新命令" class="headerlink" title="5. 配置与更新命令"></a>5. 配置与更新命令</h2><p><strong>命令格式：</strong></p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">kubectl <span class="built_in">set</span> image deployment/deployment_name container_name=image:newtag  <span class="comment"># 更新部署的镜像</span></span><br><span class="line">kubectl patch deployment deployment_name -p <span class="string">'{"spec":{"replicas":3}}'</span>    <span class="comment"># 部分更新资源</span></span><br><span class="line">kubectl rollout <span class="built_in">history</span> deployment deployment_name                        <span class="comment"># 查看部署历史</span></span><br><span class="line">kubectl rollout undo deployment deployment_name                           <span class="comment"># 回滚到上一个版本</span></span><br><span class="line">kubectl rollout undo deployment deployment_name --to-revision=N           <span class="comment"># 回滚到指定版本</span></span><br><span class="line">kubectl rollout status deployment deployment_name                         <span class="comment"># 查看滚动更新状态</span></span><br><span class="line">kubectl <span class="built_in">set</span> <span class="built_in">env</span> deployment/deployment_name ENV_NAME=ENV_VALUE            <span class="comment"># 设置环境变量</span></span><br><span class="line">kubectl <span class="built_in">set</span> resources deployment/deployment_name --limits=cpu=200m      <span class="comment"># 设置资源限制</span></span><br><span class="line">kubectl patch pod pod_name -p <span class="string">'{"spec":{"activeDeadlineSeconds":100}}'</span>   <span class="comment"># 部分更新Pod</span></span><br></pre></td></tr></tbody></table></figure><p><strong>功能说明：</strong></p><ul><li><code>kubectl set image</code>: 更新部署的镜像</li><li><code>kubectl patch</code>: 部分更新资源配置</li><li><code>kubectl rollout</code>: 管理部署的滚动更新和回滚</li><li><code>kubectl set env/resources</code>: 设置环境变量和资源限制</li></ul><p><strong>使用场景：</strong></p><ul><li>灰度发布新版本</li><li>回滚故障更新</li><li>监控更新进度</li><li>修改资源配置</li></ul><h2 id="6-节点与集群管理命令"><a href="#6-节点与集群管理命令" class="headerlink" title="6. 节点与集群管理命令"></a>6. 节点与集群管理命令</h2><p><strong>命令格式：</strong></p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">kubectl cordon node_name                    <span class="comment"># 标记节点不可调度</span></span><br><span class="line">kubectl uncordon node_name                  <span class="comment"># 标记节点可调度</span></span><br><span class="line">kubectl drain node_name                     <span class="comment"># 安全排空节点</span></span><br><span class="line">kubectl taint nodes node_name key=value:NoSchedule  <span class="comment"># 给节点添加污点</span></span><br><span class="line">kubectl cluster-info                        <span class="comment"># 显示主控节点和服务信息</span></span><br><span class="line">kubectl config view                         <span class="comment"># 查看kubeconfig配置</span></span><br><span class="line">kubectl config get-contexts                 <span class="comment"># 列出kubeconfig中的上下文</span></span><br><span class="line">kubectl config use-context context-name     <span class="comment"># 切换当前上下文</span></span><br><span class="line">kubectl version                             <span class="comment"># 显示客户端和服务端版本</span></span><br></pre></td></tr></tbody></table></figure><p><strong>功能说明：</strong></p><ul><li><code>kubectl cordon/uncordon</code>: 标记节点可调度或不可调度</li><li><code>kubectl drain</code>: 安全驱逐节点上的Pod</li><li><code>kubectl taint</code>: 给节点添加污点</li><li><code>kubectl cluster-info/config</code>: 查看集群和配置信息</li></ul><p><strong>使用场景：</strong></p><ul><li>维护前排空节点</li><li>恢复节点调度</li><li>节点维护前安全驱逐Pod</li><li>集群配置管理</li></ul><h2 id="7-配置管理与网络命令"><a href="#7-配置管理与网络命令" class="headerlink" title="7. 配置管理与网络命令"></a>7. 配置管理与网络命令</h2><p><strong>命令格式：</strong></p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">kubectl create configmap name --from-file=file         <span class="comment"># 创建ConfigMap</span></span><br><span class="line">kubectl create configmap name --from-literal=key=val   <span class="comment"># 创建键值对ConfigMap</span></span><br><span class="line">kubectl create secret generic name --from-literal=key=val <span class="comment"># 创建Secret</span></span><br><span class="line">kubectl create secret generic name --from-file=file    <span class="comment"># 从文件创建Secret</span></span><br><span class="line">kubectl get configmaps -n namespace                   <span class="comment"># 获取ConfigMap</span></span><br><span class="line">kubectl get secrets -n namespace                      <span class="comment"># 获取Secret</span></span><br><span class="line">kubectl get ingress                                   <span class="comment"># 获取入口资源</span></span><br><span class="line">kubectl get networkpolicy                             <span class="comment"># 获取网络策略</span></span><br><span class="line">kubectl create -f service-account.yaml                <span class="comment"># 创建服务账户</span></span><br><span class="line">kubectl get serviceaccount -n namespace               <span class="comment"># 获取服务账户</span></span><br></pre></td></tr></tbody></table></figure><p><strong>功能说明：</strong></p><ul><li><code>kubectl create configmap/secret</code>: 创建配置和密钥</li><li><code>kubectl get ingress/networkpolicy</code>: 获取网络相关资源</li><li><code>kubectl create/get serviceaccount</code>: 管理服务账户</li></ul><p><strong>使用场景：</strong></p><ul><li>管理配置文件和敏感信息</li><li>控制应用网络访问</li><li>权限管理</li></ul><h2 id="8-调试和排错命令"><a href="#8-调试和排错命令" class="headerlink" title="8. 调试和排错命令"></a>8. 调试和排错命令</h2><p><strong>命令格式：</strong></p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">kubectl debug node/node_name -it --image=busybox    <span class="comment"># 调试节点</span></span><br><span class="line">kubectl debug pod_name -it --image=busybox          <span class="comment"># 调试Pod</span></span><br><span class="line">kubectl get componentstatuses                     <span class="comment"># 查看集群组件状态</span></span><br><span class="line">kubectl get pods --field-selector status.phase!=Running <span class="comment"># 查找非运行状态Pod</span></span><br><span class="line">kubectl get pods --field-selector spec.nodeName=&lt;node-name&gt; <span class="comment"># 查找节点上Pod</span></span><br><span class="line">kubectl events --<span class="keyword">for</span> pod/pod_name                 <span class="comment"># 查看Pod事件</span></span><br></pre></td></tr></tbody></table></figure><p><strong>功能说明：</strong></p><ul><li><code>kubectl debug</code>: 创建调试Pod用于排错</li><li><code>kubectl get componentstatuses</code>: 检查集群组件状态</li><li>字段选择器: 通过字段筛选资源</li></ul><p><strong>使用场景：</strong></p><ul><li>调试集群节点和Pod</li><li>排查集群组件问题</li><li>查找特定状态的资源</li></ul><h1 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h1><p>本文档全面总结了Docker、Sealos和Kubectl三个重要工具的运维命令，涵盖了从基础操作到高级管理的各个方面。这些命令是云原生运维工程师必须掌握的核心技能，熟练使用这些命令可以有效提高日常运维效率，保障应用的稳定运行。</p><h2 id="常用运维流程示例"><a href="#常用运维流程示例" class="headerlink" title="常用运维流程示例"></a>常用运维流程示例</h2><h3 id="1-应用部署流程"><a href="#1-应用部署流程" class="headerlink" title="1. 应用部署流程"></a>1. 应用部署流程</h3><ol><li>使用Docker构建应用镜像</li><li>使用Sealos部署Kubernetes集群</li><li>使用Kubectl部署应用到集群</li></ol><h3 id="2-问题排查流程"><a href="#2-问题排查流程" class="headerlink" title="2. 问题排查流程"></a>2. 问题排查流程</h3><ol><li>使用kubectl get pods检查Pod状态</li><li>使用kubectl describe pod查看详情</li><li>使用kubectl logs查看日志</li><li>使用kubectl exec进入Pod调试</li></ol><h3 id="3-集群维护流程"><a href="#3-集群维护流程" class="headerlink" title="3. 集群维护流程"></a>3. 集群维护流程</h3><ol><li>使用kubectl cordon标记节点不可调度</li><li>使用kubectl drain安全排空节点</li><li>维护完成后使用kubectl uncordon恢复节点调度</li><li>使用sealos exec在节点上执行维护命令</li></ol><p>掌握这些命令和流程，可以有效提升Kubernetes集群和应用的管理效率。</p>]]></content>
      
      
      
        <tags>
            
            <tag> 运维 </tag>
            
            <tag> k8s </tag>
            
            <tag> sealos </tag>
            
            <tag> docker </tag>
            
            <tag> kubectl </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>本地安装sealos记录</title>
      <link href="/2025/12/07/0002.ben-di-an-zhuang-sealos-ji-lu/"/>
      <url>/2025/12/07/0002.ben-di-an-zhuang-sealos-ji-lu/</url>
      
        <content type="html"><![CDATA[<h1 id="Sealos和Kubernetes本地安装记录"><a href="#Sealos和Kubernetes本地安装记录" class="headerlink" title="Sealos和Kubernetes本地安装记录"></a>Sealos和Kubernetes本地安装记录</h1><h2 id="目的"><a href="#目的" class="headerlink" title="目的"></a>目的</h2><p>本记录详细说明了如何在本地环境中安装Sealos和Kubernetes。我们将提供一个简洁实用的安装流程，以确保成功搭建Kubernetes环境。</p><h2 id="环境要求"><a href="#环境要求" class="headerlink" title="环境要求"></a>环境要求</h2><ul><li>Ubuntu 22.04 LTS 或更高版本</li><li>至少4GB RAM和2个CPU核心</li><li>至少40GB可用磁盘空间</li><li>能够访问网络以下载组件</li><li>root权限或sudo权限</li></ul><h2 id="系统准备"><a href="#系统准备" class="headerlink" title="系统准备"></a>系统准备</h2><h3 id="1-更新系统包"><a href="#1-更新系统包" class="headerlink" title="1. 更新系统包"></a>1. 更新系统包</h3><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt update &amp;&amp; <span class="built_in">sudo</span> apt upgrade -y</span><br></pre></td></tr></tbody></table></figure><h3 id="2-安装必要工具"><a href="#2-安装必要工具" class="headerlink" title="2. 安装必要工具"></a>2. 安装必要工具</h3><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt install -y curl wget apt-transport-https ca-certificates</span><br></pre></td></tr></tbody></table></figure><h2 id="安装Sealos"><a href="#安装Sealos" class="headerlink" title="安装Sealos"></a>安装Sealos</h2><h3 id="1-安装依赖"><a href="#1-安装依赖" class="headerlink" title="1. 安装依赖"></a>1. 安装依赖</h3><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt install -y uidmap fuse-overlayfs</span><br></pre></td></tr></tbody></table></figure><h3 id="2-下载并安装Sealos"><a href="#2-下载并安装Sealos" class="headerlink" title="2. 下载并安装Sealos"></a>2. 下载并安装Sealos</h3><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 方式1: 从官方源下载</span></span><br><span class="line">wget https://github.com/labring/sealos/releases/download/v5.0.0/sealos_5.0.0_linux_amd64.deb</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装deb包</span></span><br><span class="line"><span class="built_in">sudo</span> dpkg -i sealos_5.0.0_linux_amd64.deb</span><br></pre></td></tr></tbody></table></figure><h3 id="3-验证安装"><a href="#3-验证安装" class="headerlink" title="3. 验证安装"></a>3. 验证安装</h3><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">sealos version</span><br></pre></td></tr></tbody></table></figure><p>如果成功，应该能看到Sealos的版本信息。</p><h2 id="安装Kubernetes"><a href="#安装Kubernetes" class="headerlink" title="安装Kubernetes"></a>安装Kubernetes</h2><h3 id="1-配置系统参数"><a href="#1-配置系统参数" class="headerlink" title="1. 配置系统参数"></a>1. 配置系统参数</h3><p>由于Sealos运行Kubernetes需要纯净环境，我们需要确保系统配置正确：</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 关闭交换分区（Kubernetes要求）</span></span><br><span class="line"><span class="built_in">sudo</span> swapoff -a</span><br><span class="line"></span><br><span class="line"><span class="comment"># 永久禁用交换分区（添加到fstab注释）</span></span><br><span class="line"><span class="built_in">sudo</span> sed -i <span class="string">'/ swap / s/^\(.*\)$/#\1/g'</span> /etc/fstab</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启用内核模块</span></span><br><span class="line"><span class="built_in">sudo</span> modprobe overlay</span><br><span class="line"><span class="built_in">sudo</span> modprobe br_netfilter</span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置内核参数</span></span><br><span class="line"><span class="built_in">cat</span> &lt;&lt;<span class="string">EOF | sudo tee /etc/modules-load.d/k8s.conf</span></span><br><span class="line"><span class="string">overlay</span></span><br><span class="line"><span class="string">br_netfilter</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置系统参数</span></span><br><span class="line"><span class="built_in">cat</span> &lt;&lt;<span class="string">EOF | sudo tee /etc/sysctl.d/k8s.conf</span></span><br><span class="line"><span class="string">net.bridge.bridge-nf-call-iptables  = 1</span></span><br><span class="line"><span class="string">net.bridge.bridge-nf-call-ip6tables = 1</span></span><br><span class="line"><span class="string">net.ipv4.ip_forward                 = 1</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 应用系统参数</span></span><br><span class="line"><span class="built_in">sudo</span> sysctl --system</span><br></pre></td></tr></tbody></table></figure><h3 id="2-安装Containerd（如果系统没有默认安装）"><a href="#2-安装Containerd（如果系统没有默认安装）" class="headerlink" title="2. 安装Containerd（如果系统没有默认安装）"></a>2. 安装Containerd（如果系统没有默认安装）</h3><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 安装containerd</span></span><br><span class="line"><span class="built_in">sudo</span> apt install -y containerd</span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置containerd</span></span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">mkdir</span> -p /etc/containerd</span><br><span class="line">containerd config default | <span class="built_in">sudo</span> <span class="built_in">tee</span> /etc/containerd/config.toml</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改设置以使用systemd作为cgroup驱动</span></span><br><span class="line"><span class="built_in">sudo</span> sed -i <span class="string">'s/SystemdCgroup = false/SystemdCgroup = true/'</span> /etc/containerd/config.toml</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重启containerd</span></span><br><span class="line"><span class="built_in">sudo</span> systemctl restart containerd</span><br><span class="line"><span class="built_in">sudo</span> systemctl <span class="built_in">enable</span> containerd</span><br></pre></td></tr></tbody></table></figure><h3 id="3-使用Sealos部署单节点Kubernetes集群"><a href="#3-使用Sealos部署单节点Kubernetes集群" class="headerlink" title="3. 使用Sealos部署单节点Kubernetes集群"></a>3. 使用Sealos部署单节点Kubernetes集群</h3><p>获取本机IP地址（这将是控制节点的IP）：</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">MASTER_IP=$(hostname -I | awk <span class="string">'{print $1}'</span>)</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"Master IP: <span class="variable">$MASTER_IP</span>"</span></span><br></pre></td></tr></tbody></table></figure><p>使用Sealos创建单节点集群：</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 运行Kubernetes集群</span></span><br><span class="line"><span class="built_in">sudo</span> sealos run labring/kubernetes:v1.28.15 labring/calico:v3.26.2 --masters <span class="variable">$MASTER_IP</span></span><br></pre></td></tr></tbody></table></figure><p>这将：</p><ul><li>拉取并安装Kubernetes v1.28.15</li><li>安装Calico网络插件</li><li>创建单节点集群</li></ul><h2 id="配置kubectl"><a href="#配置kubectl" class="headerlink" title="配置kubectl"></a>配置kubectl</h2><h3 id="1-配置访问凭证"><a href="#1-配置访问凭证" class="headerlink" title="1. 配置访问凭证"></a>1. 配置访问凭证</h3><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p <span class="variable">$HOME</span>/.kube</span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">cp</span> /etc/kubernetes/admin.conf <span class="variable">$HOME</span>/.kube/config</span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">chown</span> $(<span class="built_in">id</span> -u):$(<span class="built_in">id</span> -g) <span class="variable">$HOME</span>/.kube/config</span><br></pre></td></tr></tbody></table></figure><h3 id="2-验证集群状态"><a href="#2-验证集群状态" class="headerlink" title="2. 验证集群状态"></a>2. 验证集群状态</h3><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">kubectl get nodes</span><br></pre></td></tr></tbody></table></figure><p>如果一切正常，您应该看到类似以下输出：</p><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">NAME     STATUS   ROLES           AGE   VERSION</span><br><span class="line">&lt;hostname&gt;   Ready    control-plane   2m    v1.28.15</span><br></pre></td></tr></tbody></table></figure><h3 id="3-验证所有系统Pod运行状态"><a href="#3-验证所有系统Pod运行状态" class="headerlink" title="3. 验证所有系统Pod运行状态"></a>3. 验证所有系统Pod运行状态</h3><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">kubectl get pods -A</span><br></pre></td></tr></tbody></table></figure><h2 id="配置单节点集群"><a href="#配置单节点集群" class="headerlink" title="配置单节点集群"></a>配置单节点集群</h2><p>在单节点集群中，我们需要允许Pod在控制平面上运行：</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">kubectl taint nodes --all node-role.kubernetes.io/control-plane-</span><br></pre></td></tr></tbody></table></figure><h2 id="故障排除"><a href="#故障排除" class="headerlink" title="故障排除"></a>故障排除</h2><h3 id="如果Sealos安装失败"><a href="#如果Sealos安装失败" class="headerlink" title="如果Sealos安装失败"></a>如果Sealos安装失败</h3><p>如果Sealos无法正常部署Kubernetes，您可以使用kubeadm手动部署：</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 1. 安装kubeadm、kubelet和kubectl</span></span><br><span class="line">curl -fsSL https://pkgs.k8s.io/core:/stable:/v1.28/deb/Release.key | <span class="built_in">sudo</span> gpg --dearmor -o /etc/apt/keyrings/kubernetes-apt-keyring.gpg</span><br><span class="line"><span class="built_in">echo</span> <span class="string">'deb [signed-by=/etc/apt/keyrings/kubernetes-apt-keyring.gpg] https://pkgs.k8s.io/core:/stable:/v1.28/deb/ /'</span> | <span class="built_in">sudo</span> <span class="built_in">tee</span> /etc/apt/sources.list.d/kubernetes.list</span><br><span class="line"><span class="built_in">sudo</span> apt update</span><br><span class="line"><span class="built_in">sudo</span> apt install -y kubelet kubeadm kubectl</span><br><span class="line"><span class="built_in">sudo</span> apt-mark hold kubelet kubeadm kubectl</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 初始化集群</span></span><br><span class="line"><span class="built_in">sudo</span> kubeadm init --pod-network-cidr=10.244.0.0/16 --apiserver-advertise-address=<span class="variable">$MASTER_IP</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 配置kubectl</span></span><br><span class="line"><span class="built_in">mkdir</span> -p <span class="variable">$HOME</span>/.kube</span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">cp</span> -i /etc/kubernetes/admin.conf <span class="variable">$HOME</span>/.kube/config</span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">chown</span> $(<span class="built_in">id</span> -u):$(<span class="built_in">id</span> -g) <span class="variable">$HOME</span>/.kube/config</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. 安装网络插件（Flannel作为示例）</span></span><br><span class="line">kubectl apply -f https://github.com/flannel-io/flannel/releases/latest/download/kube-flannel.yml</span><br></pre></td></tr></tbody></table></figure><h3 id="如果遇到容器运行时错误"><a href="#如果遇到容器运行时错误" class="headerlink" title="如果遇到容器运行时错误"></a>如果遇到容器运行时错误</h3><p>如果出现与containerd相关的错误，尝试重新启动服务：</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="built_in">sudo</span> systemctl restart containerd</span><br><span class="line"><span class="built_in">sudo</span> systemctl restart kubelet</span><br></pre></td></tr></tbody></table></figure><h2 id="验证安装"><a href="#验证安装" class="headerlink" title="验证安装"></a>验证安装</h2><h3 id="1-检查集群信息"><a href="#1-检查集群信息" class="headerlink" title="1. 检查集群信息"></a>1. 检查集群信息</h3><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">kubectl cluster-info</span><br></pre></td></tr></tbody></table></figure><h3 id="2-创建测试Pod"><a href="#2-创建测试Pod" class="headerlink" title="2. 创建测试Pod"></a>2. 创建测试Pod</h3><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">kubectl create deployment nginx --image=nginx</span><br><span class="line">kubectl get pods</span><br></pre></td></tr></tbody></table></figure><h3 id="3-检查集群组件状态"><a href="#3-检查集群组件状态" class="headerlink" title="3. 检查集群组件状态"></a>3. 检查集群组件状态</h3><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">kubectl get componentstatuses</span><br></pre></td></tr></tbody></table></figure><h2 id="清理和重置"><a href="#清理和重置" class="headerlink" title="清理和重置"></a>清理和重置</h2><p>如果需要重新开始，可以使用以下命令清理环境：</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 使用Sealos重置集群</span></span><br><span class="line"><span class="built_in">sudo</span> sealos reset</span><br><span class="line"></span><br><span class="line"><span class="comment"># 或者使用kubeadm重置</span></span><br><span class="line"><span class="built_in">sudo</span> kubeadm reset</span><br><span class="line"></span><br><span class="line"><span class="comment"># 清理iptables规则</span></span><br><span class="line"><span class="built_in">sudo</span> iptables -F &amp;&amp; <span class="built_in">sudo</span> iptables -t nat -F &amp;&amp; <span class="built_in">sudo</span> iptables -t mangle -F &amp;&amp; <span class="built_in">sudo</span> iptables -X</span><br></pre></td></tr></tbody></table></figure><h2 id="过程中的问题与解决"><a href="#过程中的问题与解决" class="headerlink" title="过程中的问题与解决"></a>过程中的问题与解决</h2><p>在实际安装过程中，我遇到了以下几个关键问题，记录如下：</p><h3 id="1-Sealos环境冲突问题"><a href="#1-Sealos环境冲突问题" class="headerlink" title="1. Sealos环境冲突问题"></a>1. Sealos环境冲突问题</h3><p>在使用<code>sudo sealos run labring/kubernetes:v1.28.15 labring/calico:v3.26.2 --masters 192.168.1.18</code>命令时，遇到错误：</p><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">Error: failed to run checker: containerd is installed on 192.168.1.18:22 please uninstall it first</span><br></pre></td></tr></tbody></table></figure><p><strong>解决方案</strong>：Sealos要求纯净环境，不允许存在预安装的containerd。我执行了以下命令：</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="built_in">sudo</span> systemctl stop containerd &amp;&amp; <span class="built_in">sudo</span> systemctl <span class="built_in">disable</span> containerd</span><br><span class="line"><span class="built_in">sudo</span> apt remove containerd.io containerd -y</span><br></pre></td></tr></tbody></table></figure><h3 id="2-镜像仓库访问问题"><a href="#2-镜像仓库访问问题" class="headerlink" title="2. 镜像仓库访问问题"></a>2. 镜像仓库访问问题</h3><p>在尝试使用Sealos安装时，遇到了网络插件镜像无法拉取的问题：</p><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">Error: error parsing image name "//labring/calico:v3.26.2": reading manifest v3.26.2 in docker.io/labring/calico: manifest unknown</span><br></pre></td></tr></tbody></table></figure><p><strong>解决方案</strong>：切换到使用kubeadm手动安装，这是备选方案。</p><h3 id="3-GPG密钥问题"><a href="#3-GPG密钥问题" class="headerlink" title="3. GPG密钥问题"></a>3. GPG密钥问题</h3><p>在使用kubeadm安装过程中，执行添加Kubernetes GPG密钥的命令时遇到问题：</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">curl -fsSL https://pkgs.k8s.io/core:/stable:/v1.28/deb/Release.key | <span class="built_in">sudo</span> gpg --dearmor -o /etc/apt/keyrings/kubernetes-apt-keyring.gpg</span><br></pre></td></tr></tbody></table></figure><p>出现 <code>gpg: cannot open '/dev/tty': 没有那个设备或地址</code> 错误。</p><p><strong>解决方案</strong>：改用apt-key命令：</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">curl -fsSL https://pkgs.k8s.io/core:/stable:/v1.28/deb/Release.key | <span class="built_in">sudo</span> apt-key add -</span><br></pre></td></tr></tbody></table></figure><h3 id="4-容器运行时重新配置"><a href="#4-容器运行时重新配置" class="headerlink" title="4. 容器运行时重新配置"></a>4. 容器运行时重新配置</h3><p>由于之前移除了containerd，Kubernetes无法启动，因为CRI（容器运行时接口）不可用。</p><p><strong>解决方案</strong>：下载并安装containerd二进制文件：</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">wget https://github.com/containerd/containerd/releases/download/v1.7.20/containerd-1.7.20-linux-amd64.tar.gz</span><br><span class="line"><span class="built_in">sudo</span> tar Cxzf /usr/local containerd-1.7.20-linux-amd64.tar.gz</span><br></pre></td></tr></tbody></table></figure><p>然后创建systemd服务文件并启动containerd。</p><h3 id="5-节点状态问题"><a href="#5-节点状态问题" class="headerlink" title="5. 节点状态问题"></a>5. 节点状态问题</h3><p>在kubeadm初始化集群后，节点显示为<code>NotReady</code>状态，而不是预期的<code>Ready</code>。</p><p><strong>解决方案</strong>：</p><ul><li>安装Flannel网络插件解决CNI问题</li><li>移除节点的污点以允许Pod在单节点集群上调度：</li></ul><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">kubectl taint nodes --all node-role.kubernetes.io/control-plane-</span><br></pre></td></tr></tbody></table></figure><ul><li>等待一段时间使所有组件就绪</li></ul><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>通过这次安装实践，我成功搭建了本地的Kubernetes环境，主要收获如下：</p><ol><li><strong>Sealos和Kubernetes环境</strong>：成功安装了Sealos CLI工具和单节点Kubernetes集群</li><li><strong>kubectl配置</strong>：正确配置了kubectl命令行工具，可以正常管理集群</li><li><strong>网络插件</strong>：成功部署了Flannel网络插件，使Pod间可以正常通信</li><li><strong>问题解决经验</strong>：在过程中解决了多个典型问题，包括环境冲突、容器运行时配置和节点状态问题</li></ol><h3 id="经验教训"><a href="#经验教训" class="headerlink" title="经验教训"></a>经验教训</h3><ol><li><strong>环境准备的重要性</strong>：在部署Kubernetes前，确保系统环境符合要求至关重要</li><li><strong>备选方案的准备</strong>：当首选方案（Sealos）遇到问题时，kubeadm是一个可靠的备选方案</li><li><strong>网络插件必不可少</strong>：集群初始化后必须安装CNI网络插件，否则Pod无法正常通信</li><li><strong>单节点集群的特殊配置</strong>：需要移除master节点的污点才能在单节点上调度Pod</li></ol><p>这次安装过程虽然遇到了一些挑战，但也提供了宝贵的实践经验，对理解和部署Kubernetes环境有很大帮助。</p><h2 id="Docker与Containerd的共存关系"><a href="#Docker与Containerd的共存关系" class="headerlink" title="Docker与Containerd的共存关系"></a>Docker与Containerd的共存关系</h2><p>在安装过程中，我发现了一个有趣的现象：系统上同时存在Docker容器和服务以及Kubernetes集群。</p><h3 id="共存机制"><a href="#共存机制" class="headerlink" title="共存机制"></a>共存机制</h3><p>实际上，Docker和Kubernetes可以共存，因为它们都使用了containerd作为容器运行时：</p><ol><li><strong>双重命名空间</strong>：containerd支持多客户端，Docker使用’moby’命名空间，而Kubernetes使用’k8s.io’命名空间</li><li><strong>共享容器运行时</strong>：Docker和Kubernetes共享同一个containerd实例，但通过不同的命名空间隔离</li><li><strong>进程结构</strong>：Docker daemon通过<code>--containerd=/run/containerd/containerd.sock</code>连接到containerd，而Kubernetes的kubelet也连接到同一个containerd</li></ol><h3 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h3><p>虽然技术上可行，但这种配置在生产环境中不推荐，因为：</p><ul><li>容器资源竞争</li><li>网络和存储配置可能冲突</li><li>安全性和隔离性可能受到影响</li></ul><h2 id="运维命令"><a href="#运维命令" class="headerlink" title="运维命令"></a>运维命令</h2><h3 id="kubectl运维命令"><a href="#kubectl运维命令" class="headerlink" title="kubectl运维命令"></a>kubectl运维命令</h3><p>kubectl的配置文件通常存储在<code>$HOME/.kube/config</code>，这是访问Kubernetes集群的凭证文件。</p><p>常用运维命令：</p><ul><li><code>kubectl get nodes</code> - 查看集群节点状态</li><li><code>kubectl get pods -A</code> - 查看所有命名空间中的Pod</li><li><code>kubectl get services -A</code> - 查看所有服务</li><li><code>kubectl get deployments -A</code> - 查看所有部署</li><li><code>kubectl describe pod &lt;pod-name&gt; -n &lt;namespace&gt;</code> - 查看Pod详细信息</li><li><code>kubectl logs &lt;pod-name&gt; -n &lt;namespace&gt;</code> - 查看Pod日志</li><li><code>kubectl apply -f &lt;file.yaml&gt;</code> - 部署资源</li><li><code>kubectl delete -f &lt;file.yaml&gt;</code> - 删除资源</li><li><code>kubectl scale deployment &lt;name&gt; --replicas=&lt;number&gt;</code> - 扩缩容部署</li><li><code>kubectl cluster-info</code> - 查看集群信息</li><li><code>kubectl top nodes/pods</code> - 查看资源使用情况</li></ul><h3 id="Sealos运维命令"><a href="#Sealos运维命令" class="headerlink" title="Sealos运维命令"></a>Sealos运维命令</h3><p>虽然我们最终没有使用Sealos完成安装，但其基本运维命令包括：</p><ul><li><code>sealos run &lt;image&gt;</code> - 部署集群</li><li><code>sealos destroy</code> - 销毁集群</li><li><code>sealos reset</code> - 重置集群</li><li><code>sealos version</code> - 查看版本</li><li><code>sealos status</code> - 查看集群状态</li><li><code>sealos exec &lt;command&gt;</code> - 在集群上执行命令</li></ul><p>这些命令提供了管理Kubernetes集群的便捷方式，通过容器镜像封装了Kubernetes组件。</p>]]></content>
      
      
      
        <tags>
            
            <tag> Kubernetes </tag>
            
            <tag> Sealos </tag>
            
            <tag> 本地部署 </tag>
            
            <tag> 容器化 </tag>
            
            <tag> 运维 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>个人博客搭建</title>
      <link href="/2025/11/30/0001.ge-ren-bo-ke-da-jian/"/>
      <url>/2025/11/30/0001.ge-ren-bo-ke-da-jian/</url>
      
        <content type="html"><![CDATA[<h1 id="基于Qwen-Code-hexo-theme-matery-GitHub-Pages的个人技术博客搭建指南"><a href="#基于Qwen-Code-hexo-theme-matery-GitHub-Pages的个人技术博客搭建指南" class="headerlink" title="基于Qwen Code + hexo-theme-matery + GitHub Pages的个人技术博客搭建指南"></a>基于Qwen Code + hexo-theme-matery + GitHub Pages的个人技术博客搭建指南</h1><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>随着技术知识的快速发展和信息爆炸式增长，建立个人技术博客成为知识沉淀和分享的重要途径。本指南详细阐述如何利用Qwen Code的AI能力、hexo-theme-matery主题和GitHub Pages服务，构建一个高效、美观且功能完善的技术博客平台。</p><h2 id="1-搭建环境与工具准备"><a href="#1-搭建环境与工具准备" class="headerlink" title="1. 搭建环境与工具准备"></a>1. 搭建环境与工具准备</h2><h3 id="1-1-基础环境依赖"><a href="#1-1-基础环境依赖" class="headerlink" title="1.1 基础环境依赖"></a>1.1 基础环境依赖</h3><ul><li><strong>Node.js</strong>（版本 ≥ 14.0.0）</li><li><strong>Git</strong>（版本控制）</li><li><strong>Hexo CLI</strong>（博客框架命令行工具）</li></ul><h3 id="1-2-Qwen-Code-介绍"><a href="#1-2-Qwen-Code-介绍" class="headerlink" title="1.2 Qwen Code 介绍"></a>1.2 Qwen Code 介绍</h3><p>Qwen Code是集成于开发环境的AI助手，具备以下核心功能：</p><ul><li><strong>代码生成</strong>：根据自然语言描述生成代码</li><li><strong>文档编写</strong>：辅助技术文档创作</li><li><strong>问题诊断</strong>：快速定位和修复问题</li><li><strong>运维优化</strong>：自动化重复性任务处理</li></ul><h2 id="2-Hexo-博客框架搭建"><a href="#2-Hexo-博客框架搭建" class="headerlink" title="2. Hexo 博客框架搭建"></a>2. Hexo 博客框架搭建</h2><h3 id="2-1-Hexo-安装与初始化"><a href="#2-1-Hexo-安装与初始化" class="headerlink" title="2.1 Hexo 安装与初始化"></a>2.1 Hexo 安装与初始化</h3><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">npm install -g hexo-cli</span><br><span class="line">hexo init your-blog-name</span><br><span class="line"><span class="built_in">cd</span> your-blog-name</span><br><span class="line">npm install</span><br></pre></td></tr></tbody></table></figure><h3 id="2-2-验证安装"><a href="#2-2-验证安装" class="headerlink" title="2.2 验证安装"></a>2.2 验证安装</h3><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">hexo server</span><br><span class="line"><span class="comment"># 访问 http://localhost:4000 确认环境正常</span></span><br></pre></td></tr></tbody></table></figure><h2 id="3-hexo-theme-matery-主题配置"><a href="#3-hexo-theme-matery-主题配置" class="headerlink" title="3. hexo-theme-matery 主题配置"></a>3. hexo-theme-matery 主题配置</h2><h3 id="3-1-主题安装"><a href="#3-1-主题安装" class="headerlink" title="3.1 主题安装"></a>3.1 主题安装</h3><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/blinkfox/hexo-theme-matery.git themes/hexo-theme-matery</span><br></pre></td></tr></tbody></table></figure><h3 id="3-2-主题启用"><a href="#3-2-主题启用" class="headerlink" title="3.2 主题启用"></a>3.2 主题启用</h3><p>修改根目录 <code>_config.yml</code>：</p><figure class="highlight yaml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attr">theme:</span> <span class="string">hexo-theme-matery</span></span><br></pre></td></tr></tbody></table></figure><h3 id="3-3-主题特性概述"><a href="#3-3-主题特性概述" class="headerlink" title="3.3 主题特性概述"></a>3.3 主题特性概述</h3><p>hexo-theme-matery主题主要特性：</p><ul><li><strong>Material Design</strong>：遵循Google Material Design设计规范</li><li><strong>响应式布局</strong>：适配桌面端、平板、移动端</li><li><strong>瀑布流展示</strong>：博客文章列表的动态布局</li><li><strong>时间轴归档</strong>：按时间维度的文章归档展示</li><li><strong>多评论系统</strong>：支持Gitalk、Valine、Disqus等</li><li><strong>数据可视化</strong>：技能雷达图、项目展示等功能</li></ul><h2 id="4-博客页面结构构建"><a href="#4-博客页面结构构建" class="headerlink" title="4. 博客页面结构构建"></a>4. 博客页面结构构建</h2><h3 id="4-1-必要页面创建"><a href="#4-1-必要页面创建" class="headerlink" title="4.1 必要页面创建"></a>4.1 必要页面创建</h3><p>创建分类、标签、关于等基础页面：</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">hexo new page <span class="string">"categories"</span></span><br><span class="line">hexo new page <span class="string">"tags"</span></span><br><span class="line">hexo new page <span class="string">"about"</span></span><br><span class="line">hexo new page <span class="string">"contact"</span></span><br><span class="line">hexo new page <span class="string">"friends"</span></span><br></pre></td></tr></tbody></table></figure><p>然后配置页面Front-matter：</p><figure class="highlight yaml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># categories/index.md</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">title:</span> <span class="string">categories</span></span><br><span class="line"><span class="attr">date:</span> <span class="number">2025-11-30</span></span><br><span class="line"><span class="attr">type:</span> <span class="string">"categories"</span></span><br><span class="line"><span class="attr">layout:</span> <span class="string">"categories"</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="comment"># tags/index.md</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">title:</span> <span class="string">tags</span></span><br><span class="line"><span class="attr">date:</span> <span class="number">2025-11-30</span></span><br><span class="line"><span class="attr">type:</span> <span class="string">"tags"</span></span><br><span class="line"><span class="attr">layout:</span> <span class="string">"tags"</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="comment"># about/index.md</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">title:</span> <span class="string">about</span></span><br><span class="line"><span class="attr">date:</span> <span class="number">2025-11-30</span></span><br><span class="line"><span class="attr">type:</span> <span class="string">"about"</span></span><br><span class="line"><span class="attr">layout:</span> <span class="string">"about"</span></span><br><span class="line"><span class="meta">---</span></span><br></pre></td></tr></tbody></table></figure><h3 id="4-2-菜单导航配置"><a href="#4-2-菜单导航配置" class="headerlink" title="4.2 菜单导航配置"></a>4.2 菜单导航配置</h3><p>在主题配置文件中配置导航菜单：</p><figure class="highlight yaml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attr">menu:</span></span><br><span class="line">  <span class="attr">Index:</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">/</span></span><br><span class="line">    <span class="attr">icon:</span> <span class="string">fas</span> <span class="string">fa-home</span></span><br><span class="line">  <span class="attr">Tags:</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">/tags</span></span><br><span class="line">    <span class="attr">icon:</span> <span class="string">fas</span> <span class="string">fa-tags</span></span><br><span class="line">  <span class="attr">Categories:</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">/categories</span></span><br><span class="line">    <span class="attr">icon:</span> <span class="string">fas</span> <span class="string">fa-bookmark</span></span><br><span class="line">  <span class="attr">Archives:</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">/archives</span></span><br><span class="line">    <span class="attr">icon:</span> <span class="string">fas</span> <span class="string">fa-archive</span></span><br><span class="line">  <span class="attr">About:</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">/about</span></span><br><span class="line">    <span class="attr">icon:</span> <span class="string">fas</span> <span class="string">fa-user-circle</span></span><br></pre></td></tr></tbody></table></figure><h2 id="5-AI辅助开发与运维"><a href="#5-AI辅助开发与运维" class="headerlink" title="5. AI辅助开发与运维"></a>5. AI辅助开发与运维</h2><h3 id="5-1-Qwen-Code在博客搭建中的应用"><a href="#5-1-Qwen-Code在博客搭建中的应用" class="headerlink" title="5.1 Qwen Code在博客搭建中的应用"></a>5.1 Qwen Code在博客搭建中的应用</h3><p><strong>配置生成</strong>：通过自然语言描述快速生成复杂配置文件</p><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">指令：生成包含AI、ETL、大数据标签的hexo配置文件</span><br></pre></td></tr></tbody></table></figure><p><strong>内容创作</strong>：辅助技术文章编写和优化</p><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">指令：为大数据处理技术文章生成大纲和内容要点</span><br></pre></td></tr></tbody></table></figure><p><strong>代码优化</strong>：改进代码质量和性能</p><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">指令：优化hexo主题的JavaScript性能</span><br></pre></td></tr></tbody></table></figure><h3 id="5-2-自动化运维脚本"><a href="#5-2-自动化运维脚本" class="headerlink" title="5.2 自动化运维脚本"></a>5.2 自动化运维脚本</h3><p>创建部署脚本，实现一键发布：</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># deploy.sh</span></span><br><span class="line">hexo clean</span><br><span class="line">hexo generate</span><br><span class="line">hexo deploy</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"博客已成功部署！"</span></span><br></pre></td></tr></tbody></table></figure><h2 id="6-个性化配置与优化"><a href="#6-个性化配置与优化" class="headerlink" title="6. 个性化配置与优化"></a>6. 个性化配置与优化</h2><h3 id="6-1-站点信息配置"><a href="#6-1-站点信息配置" class="headerlink" title="6.1 站点信息配置"></a>6.1 站点信息配置</h3><p>在根配置文件中设置站点信息：</p><figure class="highlight yaml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 站点基本信息</span></span><br><span class="line"><span class="attr">title:</span> <span class="string">huhuhuhr</span></span><br><span class="line"><span class="attr">subtitle:</span> <span class="string">'学习记录与技术分享'</span></span><br><span class="line"><span class="attr">description:</span> <span class="string">'这里是huhuhuhr的技术博客，记录学习历程和技术心得'</span></span><br><span class="line"><span class="attr">keywords:</span> <span class="string">'AI, ETL, 大数据, 技术, 学习, 编程'</span></span><br><span class="line"><span class="attr">author:</span> <span class="string">huhuhuhr</span></span><br><span class="line"><span class="attr">language:</span> <span class="string">zh-CN</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># URL配置</span></span><br><span class="line"><span class="attr">url:</span> <span class="string">https://your-domain.com</span></span><br></pre></td></tr></tbody></table></figure><h3 id="6-2-主题个性化"><a href="#6-2-主题个性化" class="headerlink" title="6.2 主题个性化"></a>6.2 主题个性化</h3><p>配置主题的个人信息：</p><figure class="highlight yaml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 主题配置文件</span></span><br><span class="line"><span class="attr">profile:</span></span><br><span class="line">  <span class="attr">avatar:</span> <span class="string">/medias/avatar.jpg</span></span><br><span class="line">  <span class="attr">career:</span> <span class="string">'系统架构师'</span></span><br><span class="line">  <span class="attr">introduction:</span> <span class="string">'热爱技术，专注AI、ETL和大数据领域，通过博客记录学习历程和技术心得。'</span></span><br><span class="line"></span><br><span class="line"><span class="attr">socialLink:</span></span><br><span class="line">  <span class="attr">github:</span> <span class="string">https://github.com/your-username</span></span><br><span class="line">  <span class="attr">email:</span> <span class="string">your-email@example.com</span></span><br></pre></td></tr></tbody></table></figure><h2 id="7-GitHub-Pages-部署"><a href="#7-GitHub-Pages-部署" class="headerlink" title="7. GitHub Pages 部署"></a>7. GitHub Pages 部署</h2><h3 id="7-1-部署插件安装"><a href="#7-1-部署插件安装" class="headerlink" title="7.1 部署插件安装"></a>7.1 部署插件安装</h3><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">npm install hexo-deployer-git --save</span><br></pre></td></tr></tbody></table></figure><h3 id="7-2-部署配置"><a href="#7-2-部署配置" class="headerlink" title="7.2 部署配置"></a>7.2 部署配置</h3><figure class="highlight yaml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attr">deploy:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">git</span></span><br><span class="line">  <span class="attr">repo:</span> <span class="string">git@github.com:username/username.github.io.git</span></span><br><span class="line">  <span class="attr">branch:</span> <span class="string">main</span></span><br></pre></td></tr></tbody></table></figure><h3 id="7-3-部署执行"><a href="#7-3-部署执行" class="headerlink" title="7.3 部署执行"></a>7.3 部署执行</h3><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">hexo deploy -g  <span class="comment"># 生成并部署</span></span><br></pre></td></tr></tbody></table></figure><h2 id="8-自定义域名配置"><a href="#8-自定义域名配置" class="headerlink" title="8. 自定义域名配置"></a>8. 自定义域名配置</h2><h3 id="8-1-CNAME文件创建"><a href="#8-1-CNAME文件创建" class="headerlink" title="8.1 CNAME文件创建"></a>8.1 CNAME文件创建</h3><p>在 <code>source</code> 目录下创建 <code>CNAME</code> 文件：</p><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">your-domain.com</span><br></pre></td></tr></tbody></table></figure><h3 id="8-2-DNS记录配置"><a href="#8-2-DNS记录配置" class="headerlink" title="8.2 DNS记录配置"></a>8.2 DNS记录配置</h3><p>在域名提供商处添加DNS记录：</p><ul><li>A记录：指向GitHub Pages IP地址</li><li>CNAME记录：子域名指向 GitHub 仓库</li></ul><h3 id="8-3-GitHub仓库设置"><a href="#8-3-GitHub仓库设置" class="headerlink" title="8.3 GitHub仓库设置"></a>8.3 GitHub仓库设置</h3><p>在仓库的 “Settings” -&gt; “Pages” 中配置自定义域名。</p><h2 id="9-性能优化与SEO配置"><a href="#9-性能优化与SEO配置" class="headerlink" title="9. 性能优化与SEO配置"></a>9. 性能优化与SEO配置</h2><h3 id="9-1-搜索插件配置"><a href="#9-1-搜索插件配置" class="headerlink" title="9.1 搜索插件配置"></a>9.1 搜索插件配置</h3><figure class="highlight yaml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attr">search:</span></span><br><span class="line">  <span class="attr">path:</span> <span class="string">search.xml</span></span><br><span class="line">  <span class="attr">field:</span> <span class="string">post</span></span><br></pre></td></tr></tbody></table></figure><h3 id="9-2-SEO优化配置"><a href="#9-2-SEO优化配置" class="headerlink" title="9.2 SEO优化配置"></a>9.2 SEO优化配置</h3><p>启用sitemap、keywords等SEO相关配置：</p><figure class="highlight yaml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 文章字数统计</span></span><br><span class="line"><span class="attr">postInfo:</span></span><br><span class="line">  <span class="attr">date:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">update:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">wordCount:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">min2read:</span> <span class="literal">true</span></span><br></pre></td></tr></tbody></table></figure><h2 id="10-内容创作最佳实践"><a href="#10-内容创作最佳实践" class="headerlink" title="10. 内容创作最佳实践"></a>10. 内容创作最佳实践</h2><h3 id="10-1-文章Front-matter规范"><a href="#10-1-文章Front-matter规范" class="headerlink" title="10.1 文章Front-matter规范"></a>10.1 文章Front-matter规范</h3><figure class="highlight yaml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">title:</span> <span class="string">文章标题</span></span><br><span class="line"><span class="attr">date:</span> <span class="number">2025-11-30 12:00:00</span></span><br><span class="line"><span class="attr">author:</span> <span class="string">huhuhuhr</span></span><br><span class="line"><span class="attr">tags:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">技术标签1</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">技术标签2</span></span><br><span class="line"><span class="attr">categories:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">技术分类</span></span><br><span class="line"><span class="attr">summary:</span> <span class="string">文章摘要</span></span><br><span class="line"><span class="meta">---</span></span><br></pre></td></tr></tbody></table></figure><h3 id="10-2-内容结构化"><a href="#10-2-内容结构化" class="headerlink" title="10.2 内容结构化"></a>10.2 内容结构化</h3><ul><li><strong>问题引入</strong>：阐述文章要解决的问题</li><li><strong>解决方案</strong>：详细描述解决过程和方法</li><li><strong>技术总结</strong>：提炼关键知识点和经验</li><li><strong>后续思考</strong>：提出进一步的研究方向</li></ul><h2 id="11-维护与更新策略"><a href="#11-维护与更新策略" class="headerlink" title="11. 维护与更新策略"></a>11. 维护与更新策略</h2><h3 id="11-1-定期维护任务"><a href="#11-1-定期维护任务" class="headerlink" title="11.1 定期维护任务"></a>11.1 定期维护任务</h3><ul><li><strong>内容审核</strong>：定期检查内容的准确性和时效性</li><li><strong>技术更新</strong>：跟进技术发展，更新过时内容</li><li><strong>性能监控</strong>：检查网站加载速度和可用性</li></ul><h3 id="11-2-AI辅助维护"><a href="#11-2-AI辅助维护" class="headerlink" title="11.2 AI辅助维护"></a>11.2 AI辅助维护</h3><p>利用Qwen Code进行：</p><ul><li>语法和逻辑检查</li><li>内容改写和优化</li><li>SEO友好的标题和描述生成</li></ul><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>通过本指南的实施，我们成功构建了一个基于现代技术栈的个人技术博客：利用Hexo框架的高效静态生成能力、hexo-theme-matery主题的精美设计、GitHub Pages的稳定托管服务，以及Qwen Code的AI辅助能力，实现了技术博客的快速搭建和高效运维。</p><p>这种技术选型的优势在于：</p><ol><li><strong>成本效益</strong>：利用免费服务降低运营成本</li><li><strong>技术先进</strong>：采用现代前端技术和设计理念</li><li><strong>易于维护</strong>：简单配置和自动化部署</li><li><strong>可扩展性</strong>：支持功能模块的灵活扩展</li></ol><p>在知识经济时代，个人技术博客不仅是知识沉淀的工具，更是技术影响力的载体。通过系统化的搭建和精细化的运营，将为个人技术品牌建设奠定坚实基础。</p>]]></content>
      
      
      <categories>
          
          <category> 技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Qwen Code </tag>
            
            <tag> Hexo </tag>
            
            <tag> 博客搭建 </tag>
            
            <tag> AI工具 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
