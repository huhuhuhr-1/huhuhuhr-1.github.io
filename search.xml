<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>claude docs</title>
      <link href="/2025/12/24/claude-docs/"/>
      <url>/2025/12/24/claude-docs/</url>
      
        <content type="html"><![CDATA[<h1>Claude Code CLI 完整使用指南</h1><blockquote><p>Claude Code - 专业的 AI 辅助编程命令行工具</p></blockquote><h2 id="目录">目录</h2><ul><li><a href="#%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8B">快速开始</a></li><li><a href="#%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5">核心概念</a></li><li><a href="#%E5%91%BD%E4%BB%A4%E8%AF%A6%E8%A7%A3">命令详解</a></li><li><a href="#%E9%80%89%E9%A1%B9%E5%8F%82%E8%80%83">选项参考</a></li><li><a href="#%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF%E4%B8%8E%E7%A4%BA%E4%BE%8B">使用场景与示例</a></li><li><a href="#%E9%AB%98%E7%BA%A7%E7%94%A8%E6%B3%95">高级用法</a></li><li><a href="#%E6%95%85%E9%9A%9C%E6%8E%92%E9%99%A4">故障排除</a></li></ul><hr><h2 id="快速开始">快速开始</h2><h3 id="安装">安装</h3><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 安装稳定版</span></span><br><span class="line">claude install stable</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装最新版</span></span><br><span class="line">claude install latest</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装特定版本</span></span><br><span class="line">claude install 1.0.0</span><br></pre></td></tr></tbody></table></figure><h3 id="基本使用">基本使用</h3><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 启动交互式会话（默认）</span></span><br><span class="line">claude</span><br><span class="line"></span><br><span class="line"><span class="comment"># 直接提问并退出（非交互模式）</span></span><br><span class="line">claude -p <span class="string">"帮我分析这个代码文件"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 继续上一次对话</span></span><br><span class="line">claude -c</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看帮助信息</span></span><br><span class="line">claude --<span class="built_in">help</span></span><br></pre></td></tr></tbody></table></figure><h3 id="第一个示例">第一个示例</h3><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 让 Claude 帮你创建一个 Python 脚本</span></span><br><span class="line">claude -p <span class="string">"创建一个读取 CSV 文件的 Python 脚本"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 在当前项目目录中启动交互式会话</span></span><br><span class="line">claude</span><br></pre></td></tr></tbody></table></figure><hr><h2 id="核心概念">核心概念</h2><h3 id="1-交互式会话模式">1. 交互式会话模式</h3><p><strong>默认模式</strong>，适合复杂的开发任务：</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">claude</span><br></pre></td></tr></tbody></table></figure><p>特点：</p><ul><li>持续的对话上下文</li><li>多轮交互</li><li>工作区权限管理</li><li>会话可恢复</li></ul><h3 id="2-非交互模式（Print-Mode）">2. 非交互模式（Print Mode）</h3><p><strong>适合脚本化和批量处理</strong>：</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 基本用法</span></span><br><span class="line">claude -p <span class="string">"你的问题"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定输出格式</span></span><br><span class="line">claude -p <span class="string">"分析代码"</span> --output-format json</span><br><span class="line"></span><br><span class="line"><span class="comment"># 管道操作</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"重构这个函数"</span> | claude -p</span><br></pre></td></tr></tbody></table></figure><p>特点：</p><ul><li>一次性执行</li><li>可输出 JSON 格式</li><li>适合集成到 CI/CD</li><li>跳过工作区信任对话框（仅在可信目录使用）</li></ul><h3 id="3-会话持久化">3. 会话持久化</h3><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 继续上一次会话</span></span><br><span class="line">claude -c</span><br><span class="line"><span class="comment"># 或</span></span><br><span class="line">claude --<span class="built_in">continue</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 恢复指定会话</span></span><br><span class="line">claude -r &lt;session-id&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用会话选择器</span></span><br><span class="line">claude --resume</span><br><span class="line"></span><br><span class="line"><span class="comment"># 搜索并恢复会话</span></span><br><span class="line">claude --resume <span class="string">"代码审查"</span></span><br></pre></td></tr></tbody></table></figure><h3 id="4-工作区与权限">4. 工作区与权限</h3><p>Claude Code 使用工作区概念管理文件访问权限：</p><ul><li><strong>首次访问目录</strong>：会弹出信任对话框</li><li><strong>权限模式</strong>：可通过 <code>--permission-mode</code> 配置</li><li><strong>工具白名单</strong>：使用 <code>--allowed-tools</code> 限制可用工具</li></ul><hr><h2 id="命令详解">命令详解</h2><h3 id="mcp-MCP-服务器配置管理">mcp - MCP 服务器配置管理</h3><p>MCP（Model Context Protocol）服务器让 Claude 能够访问外部服务和 API。</p><h4 id="可用子命令">可用子命令</h4><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 查看 MCP 帮助</span></span><br><span class="line">claude mcp --<span class="built_in">help</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 列出所有 MCP 服务器</span></span><br><span class="line">claude mcp list</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取特定服务器详情</span></span><br><span class="line">claude mcp get &lt;name&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加 HTTP 服务器</span></span><br><span class="line">claude mcp add --transport http sentry https://mcp.sentry.dev/mcp</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加 SSE 服务器</span></span><br><span class="line">claude mcp add --transport sse asana https://mcp.asana.com/sse</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加 stdio 服务器（带环境变量）</span></span><br><span class="line">claude mcp add --transport stdio airtable --<span class="built_in">env</span> AIRTABLE_API_KEY=YOUR_KEY -- npx -y airtable-mcp-server</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用 JSON 字符串添加服务器</span></span><br><span class="line">claude mcp add-json &lt;name&gt; &lt;json&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 从 Claude Desktop 导入服务器配置</span></span><br><span class="line">claude mcp add-from-claude-desktop</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除 MCP 服务器</span></span><br><span class="line">claude mcp remove &lt;name&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重置项目范围的服务器选择</span></span><br><span class="line">claude mcp reset-project-choices</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动 Claude Code MCP 服务器</span></span><br><span class="line">claude mcp serve</span><br></pre></td></tr></tbody></table></figure><h4 id="配置示例">配置示例</h4><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 从配置文件加载 MCP 服务器</span></span><br><span class="line">claude --mcp-config ./mcp-servers.json</span><br><span class="line"></span><br><span class="line"><span class="comment"># 从多个配置文件加载</span></span><br><span class="line">claude --mcp-config ./server1.json ./server2.json</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用 JSON 字符串配置</span></span><br><span class="line">claude --mcp-config <span class="string">'{"name":"my-server","command":"node","args":["./server.js"]}'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 严格模式：仅使用 --mcp-config 指定的服务器</span></span><br><span class="line">claude --strict-mcp-config --mcp-config ./my-server.json</span><br></pre></td></tr></tbody></table></figure><h4 id="传输类型说明">传输类型说明</h4><p>MCP 服务器支持三种传输类型：</p><ol><li><strong>HTTP 传输</strong> - 通过 HTTP 端点连接</li><li><strong>SSE 传输</strong> - 通过 Server-Sent Events 连接</li><li><strong>stdio 传输</strong> - 通过标准输入输出连接（本地进程）</li></ol><p><strong>实际使用示例</strong>：</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># HTTP 服务器示例（Sentry）</span></span><br><span class="line">claude mcp add --transport http sentry https://mcp.sentry.dev/mcp</span><br><span class="line"></span><br><span class="line"><span class="comment"># SSE 服务器示例（Asana）</span></span><br><span class="line">claude mcp add --transport sse asana https://mcp.asana.com/sse</span><br><span class="line"></span><br><span class="line"><span class="comment"># stdio 服务器示例（Airtable，带环境变量）</span></span><br><span class="line">claude mcp add --transport stdio airtable --<span class="built_in">env</span> AIRTABLE_API_KEY=your_key -- npx -y airtable-mcp-server</span><br><span class="line"></span><br><span class="line"><span class="comment"># stdio 服务器示例（本地 Node.js 服务器）</span></span><br><span class="line">claude mcp add --transport stdio my-server -- node /path/to/server.js</span><br></pre></td></tr></tbody></table></figure><hr><h3 id="plugin-插件管理">plugin - 插件管理</h3><p>管理 Claude Code 的插件扩展。</p><h4 id="可用子命令-2">可用子命令</h4><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 查看插件帮助</span></span><br><span class="line">claude plugin --<span class="built_in">help</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 验证插件或市场清单</span></span><br><span class="line">claude plugin validate &lt;path&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 管理插件市场</span></span><br><span class="line">claude plugin marketplace</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装插件（支持从特定市场安装）</span></span><br><span class="line">claude plugin install &lt;plugin&gt;</span><br><span class="line">claude plugin install &lt;plugin&gt;@&lt;marketplace&gt;</span><br><span class="line"><span class="comment"># 简写形式</span></span><br><span class="line">claude plugin i &lt;plugin&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 卸载插件</span></span><br><span class="line">claude plugin uninstall &lt;plugin&gt;</span><br><span class="line"><span class="comment"># 或</span></span><br><span class="line">claude plugin remove &lt;plugin&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启用已禁用的插件</span></span><br><span class="line">claude plugin <span class="built_in">enable</span> &lt;plugin&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 禁用已启用的插件</span></span><br><span class="line">claude plugin <span class="built_in">disable</span> &lt;plugin&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 更新插件到最新版本（需要重启）</span></span><br><span class="line">claude plugin update [plugin]</span><br></pre></td></tr></tbody></table></figure><h4 id="插件市场管理">插件市场管理</h4><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 管理插件市场</span></span><br><span class="line">claude plugin marketplace</span><br><span class="line"></span><br><span class="line"><span class="comment"># 从默认市场安装插件</span></span><br><span class="line">claude plugin install my-plugin</span><br><span class="line"></span><br><span class="line"><span class="comment"># 从特定市场安装插件</span></span><br><span class="line">claude plugin install my-plugin@custom-marketplace</span><br><span class="line"></span><br><span class="line"><span class="comment"># 验证插件清单</span></span><br><span class="line">claude plugin validate ./path/to/plugin</span><br></pre></td></tr></tbody></table></figure><h4 id="插件启用-禁用">插件启用/禁用</h4><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 启用已禁用的插件</span></span><br><span class="line">claude plugin <span class="built_in">enable</span> my-plugin</span><br><span class="line"></span><br><span class="line"><span class="comment"># 禁用已启用的插件</span></span><br><span class="line">claude plugin <span class="built_in">disable</span> my-plugin</span><br></pre></td></tr></tbody></table></figure><hr><h3 id="setup-token-设置认证令牌">setup-token - 设置认证令牌</h3><p>配置长期认证令牌（需要 Claude 订阅）。</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 启动令牌设置向导</span></span><br><span class="line">claude setup-token</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置后可在会话中使用</span></span><br><span class="line"><span class="comment"># 令牌会保存在配置文件中，无需每次输入</span></span><br></pre></td></tr></tbody></table></figure><hr><h3 id="doctor-健康检查">doctor - 健康检查</h3><p>检查 Claude Code 自动更新器的健康状态。</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 运行健康检查</span></span><br><span class="line">claude doctor</span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查项目可能包括：</span></span><br><span class="line"><span class="comment"># - 配置文件状态</span></span><br><span class="line"><span class="comment"># - 安装完整性</span></span><br><span class="line"><span class="comment"># - 网络连接</span></span><br><span class="line"><span class="comment"># - 认证状态</span></span><br></pre></td></tr></tbody></table></figure><hr><h3 id="update-更新检查">update - 更新检查</h3><p>检查并安装更新。</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 检查更新</span></span><br><span class="line">claude update</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果有更新，会自动安装最新版本</span></span><br></pre></td></tr></tbody></table></figure><hr><h3 id="install-安装原生版本">install - 安装原生版本</h3><p>安装 Claude Code 原生构建版本。</p><h4 id="基本用法">基本用法</h4><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 安装稳定版（默认）</span></span><br><span class="line">claude install</span><br><span class="line"></span><br><span class="line"><span class="comment"># 明确指定稳定版</span></span><br><span class="line">claude install stable</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装最新预发布版</span></span><br><span class="line">claude install latest</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装特定版本</span></span><br><span class="line">claude install 1.2.0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 强制重新安装</span></span><br><span class="line">claude install --force</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看安装选项</span></span><br><span class="line">claude install --<span class="built_in">help</span></span><br></pre></td></tr></tbody></table></figure><hr><h2 id="选项参考">选项参考</h2><h3 id="输出格式选项">输出格式选项</h3><p>控制输出格式和行为的选项。</p><h4 id="p-print"><code>-p, --print</code></h4><p>非交互模式，打印响应后退出。</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 基本用法</span></span><br><span class="line">claude -p <span class="string">"解释这段代码"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 管道输入</span></span><br><span class="line"><span class="built_in">cat</span> main.py | claude -p <span class="string">"添加注释"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 结合其他选项</span></span><br><span class="line">claude -p <span class="string">"分析代码"</span> --output-format json &gt; result.json</span><br></pre></td></tr></tbody></table></figure><p><strong>注意事项</strong>：</p><ul><li>跳过工作区信任对话框，仅在可信目录使用</li><li>适合脚本化和自动化</li></ul><h4 id="output-format-format"><code>--output-format &lt;format&gt;</code></h4><p>指定输出格式（仅配合 <code>--print</code> 使用）。</p><p><strong>可选值</strong>：</p><ul><li><code>text</code> - 纯文本（默认）</li><li><code>json</code> - JSON 格式（单个结果）</li><li><code>stream-json</code> - 实时流式 JSON</li></ul><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># JSON 输出</span></span><br><span class="line">claude -p <span class="string">"分析项目结构"</span> --output-format json</span><br><span class="line"></span><br><span class="line"><span class="comment"># 流式 JSON（实时流式输出）</span></span><br><span class="line">claude -p <span class="string">"长任务处理"</span> --output-format stream-json</span><br><span class="line"></span><br><span class="line"><span class="comment"># 保存到文件</span></span><br><span class="line">claude -p <span class="string">"生成代码"</span> --output-format json &gt; output.json</span><br></pre></td></tr></tbody></table></figure><h4 id="json-schema-schema"><code>--json-schema &lt;schema&gt;</code></h4><p>JSON Schema 验证，确保输出符合指定结构。</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 使用 JSON Schema</span></span><br><span class="line">claude -p <span class="string">"提取 API 信息"</span> --output-format json \</span><br><span class="line">  --json-schema <span class="string">'{"type":"object","properties":{"name":{"type":"string"},"version":{"type":"string"}},"required":["name","version"]}'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 复杂 Schema 示例</span></span><br><span class="line">claude -p <span class="string">"分析依赖"</span> --output-format json \</span><br><span class="line">  --json-schema <span class="string">'{</span></span><br><span class="line"><span class="string">    "type": "array",</span></span><br><span class="line"><span class="string">    "items": {</span></span><br><span class="line"><span class="string">      "type": "object",</span></span><br><span class="line"><span class="string">      "properties": {</span></span><br><span class="line"><span class="string">        "name": {"type": "string"},</span></span><br><span class="line"><span class="string">        "version": {"type": "string"},</span></span><br><span class="line"><span class="string">        "license": {"type": "string"}</span></span><br><span class="line"><span class="string">      }</span></span><br><span class="line"><span class="string">    }</span></span><br><span class="line"><span class="string">  }'</span></span><br></pre></td></tr></tbody></table></figure><h4 id="include-partial-messages"><code>--include-partial-messages</code></h4><p>包含部分消息块（仅配合 <code>--print</code> 和 <code>--output-format=stream-json</code>）。</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 实时接收部分消息</span></span><br><span class="line">claude -p <span class="string">"生成大量代码"</span> \</span><br><span class="line">  --output-format stream-json \</span><br><span class="line">  --include-partial-messages</span><br></pre></td></tr></tbody></table></figure><h4 id="input-format-format"><code>--input-format &lt;format&gt;</code></h4><p>输入格式（仅配合 <code>--print</code> 使用）。</p><p><strong>可选值</strong>：</p><ul><li><code>text</code> - 纯文本（默认）</li><li><code>stream-json</code> - 实时流式 JSON 输入</li></ul><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 流式输入处理</span></span><br><span class="line"><span class="built_in">cat</span> input.json | claude -p --input-format stream-json \</span><br><span class="line">  --output-format json</span><br></pre></td></tr></tbody></table></figure><h4 id="replay-user-messages"><code>--replay-user-messages</code></h4><p>重新发送来自 stdin 的用户消息（配合流式输入输出）。</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 消息确认回显</span></span><br><span class="line"><span class="built_in">cat</span> input.json | claude -p \</span><br><span class="line">  --input-format stream-json \</span><br><span class="line">  --output-format stream-json \</span><br><span class="line">  --replay-user-messages</span><br></pre></td></tr></tbody></table></figure><hr><h3 id="调试选项">调试选项</h3><p>用于调试和问题排查。</p><h4 id="d-debug-filter"><code>-d, --debug [filter]</code></h4><p>启用调试模式，支持类别过滤。</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 启用所有调试信息</span></span><br><span class="line">claude -d</span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定调试类别</span></span><br><span class="line">claude -d <span class="string">"api,hooks"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 排除特定类别</span></span><br><span class="line">claude -d <span class="string">"!statsig,!file"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 组合使用</span></span><br><span class="line">claude -d <span class="string">"api,!network"</span></span><br></pre></td></tr></tbody></table></figure><p><strong>常见调试类别</strong>：</p><ul><li><code>api</code> - API 调用</li><li><code>hooks</code> - 钩子执行</li><li><code>statsig</code> - 统计分析</li><li><code>file</code> - 文件操作</li><li><code>network</code> - 网络请求</li></ul><h4 id="verbose"><code>--verbose</code></h4><p>覆盖详细模式设置。</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 启用详细输出</span></span><br><span class="line">claude --verbose</span><br><span class="line"></span><br><span class="line"><span class="comment"># 结合其他选项</span></span><br><span class="line">claude --verbose -p <span class="string">"详细分析"</span></span><br></pre></td></tr></tbody></table></figure><h4 id="mcp-debug"><code>--mcp-debug</code></h4><p><strong>已弃用</strong>，请使用 <code>--debug</code> 代替。</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 旧方式（不推荐）</span></span><br><span class="line">claude --mcp-debug</span><br><span class="line"></span><br><span class="line"><span class="comment"># 新方式</span></span><br><span class="line">claude -d mcp</span><br></pre></td></tr></tbody></table></figure><hr><h3 id="会话管理选项">会话管理选项</h3><p>控制和恢复会话的选项。</p><h4 id="c-continue"><code>-c, --continue</code></h4><p>继续最近的会话。</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 继续上一次会话</span></span><br><span class="line">claude -c</span><br><span class="line"><span class="comment"># 或</span></span><br><span class="line">claude --<span class="built_in">continue</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 继续会话并执行新任务</span></span><br><span class="line">claude -c <span class="string">"继续优化代码"</span></span><br></pre></td></tr></tbody></table></figure><h4 id="r-resume-value"><code>-r, --resume [value]</code></h4><p>恢复指定会话，或打开交互式选择器。</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 打开会话选择器</span></span><br><span class="line">claude -r</span><br><span class="line"></span><br><span class="line"><span class="comment"># 搜索并选择会话</span></span><br><span class="line">claude -r <span class="string">"代码审查"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 恢复指定 session-id</span></span><br><span class="line">claude -r abc123-def456-ghi789</span><br></pre></td></tr></tbody></table></figure><h4 id="fork-session"><code>--fork-session</code></h4><p>创建新会话 ID 而不是重用原会话（配合 <code>--resume</code> 或 <code>--continue</code>）。</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 恢复会话但创建新分支</span></span><br><span class="line">claude -r --fork-session</span><br><span class="line"></span><br><span class="line"><span class="comment"># 继续会话但创建新分支</span></span><br><span class="line">claude -c --fork-session</span><br></pre></td></tr></tbody></table></figure><h4 id="no-session-persistence"><code>--no-session-persistence</code></h4><p>禁用会话持久化（仅配合 <code>--print</code>）。</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 一次性执行，不保存会话</span></span><br><span class="line">claude -p <span class="string">"临时任务"</span> --no-session-persistence</span><br></pre></td></tr></tbody></table></figure><h4 id="session-id-uuid"><code>--session-id &lt;uuid&gt;</code></h4><p>使用指定的会话 ID。</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 使用特定会话 ID</span></span><br><span class="line">claude --session-id 550e8400-e29b-41d4-a716-446655440000</span><br><span class="line"></span><br><span class="line"><span class="comment"># 生成并使用新会话 ID</span></span><br><span class="line">uuidgen | xargs -I {} claude --session-id {}</span><br></pre></td></tr></tbody></table></figure><hr><h3 id="工具权限选项">工具权限选项</h3><p>控制工具访问权限的选项。</p><h4 id="allowedTools-allowed-tools-tools"><code>--allowedTools, --allowed-tools &lt;tools...&gt;</code></h4><p>允许的工具列表（逗号或空格分隔）。</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 允许特定工具</span></span><br><span class="line">claude --allowed-tools Bash,Edit,Read</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用逗号分隔</span></span><br><span class="line">claude --allowed-tools <span class="string">"Bash,Edit,Read"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用模式匹配</span></span><br><span class="line">claude --allowed-tools <span class="string">"Bash(git:*)"</span> <span class="string">"Edit"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 仅允许文件操作</span></span><br><span class="line">claude --allowed-tools Read,Write,Edit</span><br><span class="line"></span><br><span class="line"><span class="comment"># 非交互模式示例</span></span><br><span class="line">claude -p <span class="string">"检查 Git 状态"</span> \</span><br><span class="line">  --allowed-tools <span class="string">"Bash(git:status)"</span> \</span><br><span class="line">  --<span class="built_in">print</span></span><br></pre></td></tr></tbody></table></figure><h4 id="tools-tools"><code>--tools &lt;tools...&gt;</code></h4><p>指定可用工具集（仅 <code>--print</code> 模式）。</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 使用所有默认工具</span></span><br><span class="line">claude -p <span class="string">"任务"</span> --tools default</span><br><span class="line"></span><br><span class="line"><span class="comment"># 禁用所有工具</span></span><br><span class="line">claude -p <span class="string">"纯文本任务"</span> --tools <span class="string">""</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定特定工具</span></span><br><span class="line">claude -p <span class="string">"任务"</span> --tools <span class="string">"Bash,Edit,Read"</span></span><br></pre></td></tr></tbody></table></figure><h4 id="disallowedTools-disallowed-tools-tools"><code>--disallowedTools, --disallowed-tools &lt;tools...&gt;</code></h4><p>拒绝的工具列表（逗号或空格分隔）。</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 禁用危险工具</span></span><br><span class="line">claude --disallowed-tools <span class="string">"Bash(rm:*),Bash(dd:*)"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 禁用网络操作</span></span><br><span class="line">claude --disallowed-tools <span class="string">"Bash(curl:*),Bash(wget:*)"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 禁止编辑特定文件</span></span><br><span class="line">claude --disallowed-tools <span class="string">"Edit(*.config)"</span></span><br></pre></td></tr></tbody></table></figure><h4 id="dangerously-skip-permissions"><code>--dangerously-skip-permissions</code></h4><p>绕过所有权限检查（仅推荐用于无网络访问的沙箱环境）。</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 危险：跳过所有权限检查</span></span><br><span class="line">claude --dangerously-skip-permissions</span><br><span class="line"></span><br><span class="line"><span class="comment"># ⚠️ 谨慎使用</span></span><br><span class="line"><span class="comment"># 仅在完全隔离的环境中使用</span></span><br></pre></td></tr></tbody></table></figure><h4 id="allow-dangerously-skip-permissions"><code>--allow-dangerously-skip-permissions</code></h4><p>启用跳过权限检查的选项，但默认不启用。</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 启用该功能但默认不激活</span></span><br><span class="line">claude --allow-dangerously-skip-permissions</span><br><span class="line"></span><br><span class="line"><span class="comment"># 后续可通过其他方式激活</span></span><br></pre></td></tr></tbody></table></figure><hr><h3 id="模型配置选项">模型配置选项</h3><p>控制 AI 模型行为的选项。</p><h4 id="model-model"><code>--model &lt;model&gt;</code></h4><p>指定会话使用的模型。</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 使用模型别名</span></span><br><span class="line">claude --model sonnet</span><br><span class="line">claude --model opus</span><br><span class="line">claude --model haiku</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用完整模型名称</span></span><br><span class="line">claude --model claude-sonnet-4-5-20250929</span><br><span class="line">claude --model claude-opus-4-5-20251101</span><br><span class="line"></span><br><span class="line"><span class="comment"># 非交互模式</span></span><br><span class="line">claude -p <span class="string">"快速任务"</span> --model haiku --<span class="built_in">print</span></span><br></pre></td></tr></tbody></table></figure><p><strong>常用模型别名</strong>：</p><ul><li><code>sonnet</code> - 平衡性能和速度</li><li><code>opus</code> - 最高质量</li><li><code>haiku</code> - 最快响应</li></ul><h4 id="fallback-model-model"><code>--fallback-model &lt;model&gt;</code></h4><p>启用默认模型过载时的自动降级（仅 <code>--print</code> 模式）。</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 设置备用模型</span></span><br><span class="line">claude -p <span class="string">"重要任务"</span> \</span><br><span class="line">  --model opus \</span><br><span class="line">  --fallback-model sonnet \</span><br><span class="line">  --<span class="built_in">print</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 当 opus 过载时自动降级到 sonnet</span></span><br></pre></td></tr></tbody></table></figure><h4 id="agent-agent"><code>--agent &lt;agent&gt;</code></h4><p>指定会话使用的代理（覆盖 ‘agent’ 设置）。</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 使用特定代理</span></span><br><span class="line">claude --agent code-reviewer</span><br><span class="line"></span><br><span class="line"><span class="comment"># 配合自定义代理</span></span><br><span class="line">claude --agents <span class="string">'{"reviewer":{"description":"Reviews code","prompt":"你是代码审查专家"}}'</span> \</span><br><span class="line">  --agent reviewer</span><br></pre></td></tr></tbody></table></figure><h4 id="agents-json"><code>--agents &lt;json&gt;</code></h4><p>定义自定义代理的 JSON 对象。</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 定义多个代理</span></span><br><span class="line">claude --agents <span class="string">'{</span></span><br><span class="line"><span class="string">  "reviewer": {</span></span><br><span class="line"><span class="string">    "description": "Reviews code for bugs and style issues",</span></span><br><span class="line"><span class="string">    "prompt": "You are a code reviewer. Focus on clarity and correctness."</span></span><br><span class="line"><span class="string">  },</span></span><br><span class="line"><span class="string">  "optimizer": {</span></span><br><span class="line"><span class="string">    "description": "Optimizes code for performance",</span></span><br><span class="line"><span class="string">    "prompt": "You are a performance optimization expert."</span></span><br><span class="line"><span class="string">  }</span></span><br><span class="line"><span class="string">}'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用自定义代理</span></span><br><span class="line">claude --agent reviewer</span><br></pre></td></tr></tbody></table></figure><hr><h3 id="MCP-配置选项">MCP 配置选项</h3><p>MCP（Model Context Protocol）相关配置。</p><h4 id="mcp-config-configs"><code>--mcp-config &lt;configs...&gt;</code></h4><p>从 JSON 文件或字符串加载 MCP 服务器（空格分隔）。</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 从文件加载</span></span><br><span class="line">claude --mcp-config ./servers/server1.json</span><br><span class="line"></span><br><span class="line"><span class="comment"># 从多个文件加载</span></span><br><span class="line">claude --mcp-config ./server1.json ./server2.json</span><br><span class="line"></span><br><span class="line"><span class="comment"># 从 JSON 字符串加载</span></span><br><span class="line">claude --mcp-config <span class="string">'{"name":"my-server","command":"node","args":["./server.js"]}'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 混合使用</span></span><br><span class="line">claude --mcp-config ./config.json <span class="string">'{"name":"temp-server","command":"python"}'</span></span><br></pre></td></tr></tbody></table></figure><p><strong>配置文件格式示例</strong> (<code>server.json</code>)：</p><figure class="highlight json"><table><tbody><tr><td class="code"><pre><span class="line"><span class="punctuation">{</span></span><br><span class="line">  <span class="attr">"name"</span><span class="punctuation">:</span> <span class="string">"my-server"</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">"command"</span><span class="punctuation">:</span> <span class="string">"node"</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">"args"</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">"./server.js"</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">"env"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">    <span class="attr">"API_KEY"</span><span class="punctuation">:</span> <span class="string">"your-key"</span></span><br><span class="line">  <span class="punctuation">}</span></span><br><span class="line"><span class="punctuation">}</span></span><br></pre></td></tr></tbody></table></figure><h4 id="strict-mcp-config"><code>--strict-mcp-config</code></h4><p>仅使用 <code>--mcp-config</code> 指定的 MCP 服务器，忽略其他配置。</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 严格模式：仅使用指定的服务器</span></span><br><span class="line">claude --strict-mcp-config \</span><br><span class="line">  --mcp-config ./my-server.json</span><br><span class="line"></span><br><span class="line"><span class="comment"># 不加载其他已配置的 MCP 服务器</span></span><br></pre></td></tr></tbody></table></figure><hr><h3 id="系统提示词选项">系统提示词选项</h3><p>控制系统提示词的选项。</p><h4 id="system-prompt-prompt"><code>--system-prompt &lt;prompt&gt;</code></h4><p>使用自定义系统提示词。</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 完全自定义系统提示词</span></span><br><span class="line">claude --system-prompt <span class="string">"你是一个 Rust 专家"</span> \</span><br><span class="line">  -p <span class="string">"帮我优化这段代码"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置角色和任务</span></span><br><span class="line">claude --system-prompt <span class="string">"你是代码审查专家，专注于安全性和性能"</span> \</span><br><span class="line">  -p <span class="string">"审查这个文件"</span></span><br></pre></td></tr></tbody></table></figure><h4 id="append-system-prompt-prompt"><code>--append-system-prompt &lt;prompt&gt;</code></h4><p>追加系统提示词到默认提示词。</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 追加额外指令</span></span><br><span class="line">claude --append-system-prompt <span class="string">"始终包含单元测试"</span> \</span><br><span class="line">  -p <span class="string">"创建一个函数"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 追加格式要求</span></span><br><span class="line">claude --append-system-prompt <span class="string">"所有代码必须包含详细注释"</span> \</span><br><span class="line">  -p <span class="string">"实现快速排序"</span></span><br></pre></td></tr></tbody></table></figure><hr><h3 id="权限模式选项">权限模式选项</h3><p>控制权限检查行为。</p><h4 id="permission-mode-mode"><code>--permission-mode &lt;mode&gt;</code></h4><p>指定会话的权限模式。</p><p><strong>可选值</strong>：</p><ul><li><code>default</code> - 默认权限模式</li><li><code>acceptEdits</code> - 自动接受编辑</li><li><code>bypassPermissions</code> - 绕过权限检查</li><li><code>delegate</code> - 委托权限决策</li><li><code>dontAsk</code> - 不询问权限</li><li><code>plan</code> - 计划模式</li></ul><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 自动接受编辑</span></span><br><span class="line">claude --permission-mode acceptEdits</span><br><span class="line"></span><br><span class="line"><span class="comment"># 绕过权限检查（谨慎使用）</span></span><br><span class="line">claude --permission-mode bypassPermissions</span><br><span class="line"></span><br><span class="line"><span class="comment"># 委托模式</span></span><br><span class="line">claude --permission-mode delegate</span><br><span class="line"></span><br><span class="line"><span class="comment"># 不询问模式</span></span><br><span class="line">claude --permission-mode dontAsk</span><br><span class="line"></span><br><span class="line"><span class="comment"># 计划模式</span></span><br><span class="line">claude --permission-mode plan</span><br><span class="line"></span><br><span class="line"><span class="comment"># 配合非交互模式</span></span><br><span class="line">claude -p <span class="string">"批量重构"</span> \</span><br><span class="line">  --permission-mode acceptEdits \</span><br><span class="line">  --<span class="built_in">print</span></span><br></pre></td></tr></tbody></table></figure><hr><h3 id="设置和配置选项">设置和配置选项</h3><h4 id="settings-file-or-json"><code>--settings &lt;file-or-json&gt;</code></h4><p>从文件或 JSON 字符串加载额外设置。</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 从文件加载</span></span><br><span class="line">claude --settings ./my-settings.json</span><br><span class="line"></span><br><span class="line"><span class="comment"># 从 JSON 字符串加载</span></span><br><span class="line">claude --settings <span class="string">'{"model":"sonnet","temperature":0.7}'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 配合其他选项</span></span><br><span class="line">claude --settings ./config.json \</span><br><span class="line">  --permission-mode acceptEdits</span><br></pre></td></tr></tbody></table></figure><h4 id="setting-sources-sources"><code>--setting-sources &lt;sources&gt;</code></h4><p>指定要加载的设置源（逗号分隔）。</p><p><strong>可选值</strong>：</p><ul><li><code>user</code> - 用户设置</li><li><code>project</code> - 项目设置</li><li><code>local</code> - 本地设置</li></ul><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 只加载用户设置</span></span><br><span class="line">claude --setting-sources user</span><br><span class="line"></span><br><span class="line"><span class="comment"># 加载用户和项目设置</span></span><br><span class="line">claude --setting-sources user,project</span><br><span class="line"></span><br><span class="line"><span class="comment"># 加载所有设置（默认）</span></span><br><span class="line">claude --setting-sources user,project,<span class="built_in">local</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 只加载项目设置</span></span><br><span class="line">claude --setting-sources project</span><br></pre></td></tr></tbody></table></figure><h4 id="plugin-dir-paths"><code>--plugin-dir &lt;paths...&gt;</code></h4><p>仅为此会话从指定目录加载插件（可重复）。</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 从单个目录加载插件</span></span><br><span class="line">claude --plugin-dir ./custom-plugins</span><br><span class="line"></span><br><span class="line"><span class="comment"># 从多个目录加载</span></span><br><span class="line">claude --plugin-dir ./plugins1 ./plugins2</span><br><span class="line"></span><br><span class="line"><span class="comment"># 配合主会话</span></span><br><span class="line">claude --plugin-dir ~/.claude/plugins \</span><br><span class="line">  -p <span class="string">"使用自定义插件"</span></span><br></pre></td></tr></tbody></table></figure><hr><h3 id="Beta-和测试选项">Beta 和测试选项</h3><h4 id="betas-betas"><code>--betas &lt;betas...&gt;</code></h4><p>在 API 请求中包含 Beta 标头（仅 API 密钥用户）。</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 启用单个 Beta 功能</span></span><br><span class="line">claude --betas new-feature</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启用多个 Beta 功能</span></span><br><span class="line">claude --betas feature1,feature2</span><br><span class="line"></span><br><span class="line"><span class="comment"># API 密钥用户专用</span></span><br><span class="line"><span class="comment"># 用于测试实验性功能</span></span><br></pre></td></tr></tbody></table></figure><hr><h3 id="IDE-集成选项">IDE 集成选项</h3><h4 id="ide"><code>--ide</code></h4><p>启动时自动连接到 IDE（如果有恰好一个有效 IDE）。</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 自动连接 IDE</span></span><br><span class="line">claude --ide</span><br><span class="line"></span><br><span class="line"><span class="comment"># 配合其他选项</span></span><br><span class="line">claude --ide -c <span class="string">"继续调试"</span></span><br></pre></td></tr></tbody></table></figure><h4 id="no-chrome"><code>--no-chrome</code></h4><p>禁用 Chrome 集成。</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 禁用 Chrome 集成</span></span><br><span class="line">claude --no-chrome</span><br></pre></td></tr></tbody></table></figure><h4 id="chrome"><code>--chrome</code></h4><p>启用 Chrome 集成。</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 启用 Chrome 集成</span></span><br><span class="line">claude --chrome</span><br></pre></td></tr></tbody></table></figure><hr><h3 id="目录和会话选项">目录和会话选项</h3><h4 id="add-dir-directories"><code>--add-dir &lt;directories...&gt;</code></h4><p>允许工具访问的额外目录（可重复）。</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 添加单个目录</span></span><br><span class="line">claude --add-dir /path/to/project</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加多个目录</span></span><br><span class="line">claude --add-dir ./src ./tests ./docs</span><br><span class="line"></span><br><span class="line"><span class="comment"># 配合工作区</span></span><br><span class="line">claude --add-dir ~/projects/shared \</span><br><span class="line">  -p <span class="string">"访问共享目录"</span></span><br></pre></td></tr></tbody></table></figure><hr><h3 id="其他选项">其他选项</h3><h4 id="max-budget-usd-amount"><code>--max-budget-usd &lt;amount&gt;</code></h4><p>API 调用的最大美元金额（仅 <code>--print</code> 模式）。</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 设置预算限制</span></span><br><span class="line">claude -p <span class="string">"大型分析任务"</span> \</span><br><span class="line">  --max-budget-usd 5.00 \</span><br><span class="line">  --<span class="built_in">print</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 限制成本</span></span><br><span class="line">claude -p <span class="string">"生成大量代码"</span> \</span><br><span class="line">  --model opus \</span><br><span class="line">  --max-budget-usd 10.00 \</span><br><span class="line">  --<span class="built_in">print</span></span><br></pre></td></tr></tbody></table></figure><h4 id="disable-slash-commands"><code>--disable-slash-commands</code></h4><p>禁用所有斜杠命令。</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 禁用斜杠命令</span></span><br><span class="line">claude --disable-slash-commands</span><br><span class="line"></span><br><span class="line"><span class="comment"># 防止意外触发斜杠命令</span></span><br></pre></td></tr></tbody></table></figure><h4 id="v-version"><code>-v, --version</code></h4><p>输出版本号。</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 查看版本</span></span><br><span class="line">claude -v</span><br><span class="line"><span class="comment"># 或</span></span><br><span class="line">claude --version</span><br></pre></td></tr></tbody></table></figure><h4 id="h-help"><code>-h, --help</code></h4><p>显示帮助信息。</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 主帮助</span></span><br><span class="line">claude --<span class="built_in">help</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 子命令帮助</span></span><br><span class="line">claude mcp --<span class="built_in">help</span></span><br><span class="line">claude plugin --<span class="built_in">help</span></span><br></pre></td></tr></tbody></table></figure><hr><h2 id="使用场景与示例">使用场景与示例</h2><h3 id="场景-1：代码审查">场景 1：代码审查</h3><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 交互式审查</span></span><br><span class="line">claude --agent reviewer</span><br><span class="line">&gt; 请审查 src/main.py 文件</span><br><span class="line"></span><br><span class="line"><span class="comment"># 非交互式批量审查</span></span><br><span class="line">claude -p <span class="string">"审查 src/ 目录下的所有 Python 文件"</span> \</span><br><span class="line">  --allowed-tools <span class="string">"Read,Grep"</span> \</span><br><span class="line">  --<span class="built_in">print</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用 JSON 输出集成到 CI/CD</span></span><br><span class="line">claude -p <span class="string">"审查代码并输出问题"</span> \</span><br><span class="line">  --output-format json \</span><br><span class="line">  --json-schema <span class="string">'{</span></span><br><span class="line"><span class="string">    "type": "array",</span></span><br><span class="line"><span class="string">    "items": {</span></span><br><span class="line"><span class="string">      "type": "object",</span></span><br><span class="line"><span class="string">      "properties": {</span></span><br><span class="line"><span class="string">        "file": {"type": "string"},</span></span><br><span class="line"><span class="string">        "line": {"type": "integer"},</span></span><br><span class="line"><span class="string">        "issue": {"type": "string"},</span></span><br><span class="line"><span class="string">        "severity": {"type": "string"}</span></span><br><span class="line"><span class="string">      }</span></span><br><span class="line"><span class="string">    }</span></span><br><span class="line"><span class="string">  }'</span> \</span><br><span class="line">  &gt; review-results.json</span><br></pre></td></tr></tbody></table></figure><h3 id="场景-2：批量代码生成">场景 2：批量代码生成</h3><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 生成多个文件</span></span><br><span class="line">claude -p <span class="string">"为以下模块创建单元测试：auth, user, payment"</span> \</span><br><span class="line">  --allowed-tools <span class="string">"Write,Read"</span> \</span><br><span class="line">  --<span class="built_in">print</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用流式输出监控进度</span></span><br><span class="line">claude -p <span class="string">"生成完整的 API 文档"</span> \</span><br><span class="line">  --output-format stream-json \</span><br><span class="line">  --include-partial-messages \</span><br><span class="line">  --<span class="built_in">print</span></span><br></pre></td></tr></tbody></table></figure><h3 id="场景-3：CI-CD-集成">场景 3：CI/CD 集成</h3><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># ci-integration.sh</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. 代码风格检查</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"检查代码风格..."</span></span><br><span class="line">claude -p <span class="string">"检查 src/ 目录的代码风格"</span> \</span><br><span class="line">  --output-format json \</span><br><span class="line">  --allowed-tools <span class="string">"Read,Grep"</span> \</span><br><span class="line">  &gt; style-check.json</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 运行测试</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"运行测试..."</span></span><br><span class="line">claude -p <span class="string">"分析测试覆盖率报告"</span> \</span><br><span class="line">  --input-format text \</span><br><span class="line">  --output-format json \</span><br><span class="line">  &lt; coverage.txt \</span><br><span class="line">  &gt; test-analysis.json</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 生成变更日志</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"生成变更日志..."</span></span><br><span class="line">claude -p <span class="string">"基于 git log 生成变更日志"</span> \</span><br><span class="line">  --allowed-tools <span class="string">"Bash(git:*)"</span> \</span><br><span class="line">  --<span class="built_in">print</span> \</span><br><span class="line">  &gt; CHANGELOG.md</span><br></pre></td></tr></tbody></table></figure><h3 id="场景-4：MCP-服务器集成">场景 4：MCP 服务器集成</h3><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 配置数据库 MCP 服务器</span></span><br><span class="line">claude --mcp-config <span class="string">'{</span></span><br><span class="line"><span class="string">  "name": "postgres",</span></span><br><span class="line"><span class="string">  "command": "npx",</span></span><br><span class="line"><span class="string">  "args": ["@modelcontextprotocol/server-postgres"],</span></span><br><span class="line"><span class="string">  "env": {</span></span><br><span class="line"><span class="string">    "DATABASE_URL": "postgresql://localhost/mydb"</span></span><br><span class="line"><span class="string">  }</span></span><br><span class="line"><span class="string">}'</span> -p <span class="string">"查询用户表"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用多个 MCP 服务器</span></span><br><span class="line">claude \</span><br><span class="line">  --mcp-config ./postgres-server.json \</span><br><span class="line">  --mcp-config ./filesystem-server.json \</span><br><span class="line">  -p <span class="string">"从数据库读取用户数据并保存到文件系统"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 严格模式：仅使用指定服务器</span></span><br><span class="line">claude --strict-mcp-config \</span><br><span class="line">  --mcp-config ./my-server.json \</span><br><span class="line">  -p <span class="string">"执行自定义任务"</span></span><br></pre></td></tr></tbody></table></figure><h3 id="场景-5：会话恢复与分支">场景 5：会话恢复与分支</h3><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 场景：中断的编码任务</span></span><br><span class="line">claude</span><br><span class="line">&gt; 开始实现用户认证功能...</span><br><span class="line"><span class="comment"># [会话中断]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 恢复会话</span></span><br><span class="line">claude -c</span><br><span class="line"></span><br><span class="line"><span class="comment"># 或从特定会话恢复</span></span><br><span class="line">claude -r <span class="string">"用户认证"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建分支会话尝试不同方案</span></span><br><span class="line">claude -r --fork-session</span><br><span class="line">&gt; 让我们尝试使用 JWT 而不是 Session</span><br></pre></td></tr></tbody></table></figure><h3 id="场景-6：成本控制">场景 6：成本控制</h3><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 设置预算限制</span></span><br><span class="line">claude -p <span class="string">"分析大型代码库"</span> \</span><br><span class="line">  --model haiku \</span><br><span class="line">  --fallback-model sonnet \</span><br><span class="line">  --max-budget-usd 3.00 \</span><br><span class="line">  --<span class="built_in">print</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 为不同任务设置不同预算</span></span><br><span class="line">claude -p <span class="string">"简单任务"</span> --model haiku --max-budget-usd 0.50 --<span class="built_in">print</span></span><br><span class="line">claude -p <span class="string">"复杂任务"</span> --model opus --max-budget-usd 10.00 --<span class="built_in">print</span></span><br></pre></td></tr></tbody></table></figure><h3 id="场景-7：多模型策略">场景 7：多模型策略</h3><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 快速原型使用 haiku</span></span><br><span class="line">claude -p <span class="string">"创建基本结构"</span> \</span><br><span class="line">  --model haiku \</span><br><span class="line">  --<span class="built_in">print</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 优化使用 sonnet</span></span><br><span class="line">claude -p <span class="string">"优化代码性能"</span> \</span><br><span class="line">  --model sonnet \</span><br><span class="line">  --<span class="built_in">print</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 最终审查使用 opus</span></span><br><span class="line">claude -p <span class="string">"深度代码审查"</span> \</span><br><span class="line">  --model opus \</span><br><span class="line">  --<span class="built_in">print</span></span><br></pre></td></tr></tbody></table></figure><h3 id="场景-8：自定义代理工作流">场景 8：自定义代理工作流</h3><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 定义工作流代理</span></span><br><span class="line">claude --agents <span class="string">'{</span></span><br><span class="line"><span class="string">  "analyzer": {</span></span><br><span class="line"><span class="string">    "description": "分析代码结构和依赖",</span></span><br><span class="line"><span class="string">    "prompt": "你是代码分析专家"</span></span><br><span class="line"><span class="string">  },</span></span><br><span class="line"><span class="string">  "optimizer": {</span></span><br><span class="line"><span class="string">    "description": "优化代码性能",</span></span><br><span class="line"><span class="string">    "prompt": "你是性能优化专家"</span></span><br><span class="line"><span class="string">  },</span></span><br><span class="line"><span class="string">  "tester": {</span></span><br><span class="line"><span class="string">    "description": "生成测试用例",</span></span><br><span class="line"><span class="string">    "prompt": "你是测试专家"</span></span><br><span class="line"><span class="string">  }</span></span><br><span class="line"><span class="string">}'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行工作流</span></span><br><span class="line">claude --agent analyzer -p <span class="string">"分析项目结构"</span> --<span class="built_in">print</span></span><br><span class="line">claude --agent optimizer -p <span class="string">"优化瓶颈代码"</span> --<span class="built_in">print</span></span><br><span class="line">claude --agent tester -p <span class="string">"生成集成测试"</span> --<span class="built_in">print</span></span><br></pre></td></tr></tbody></table></figure><hr><h2 id="高级用法">高级用法</h2><h3 id="自定义系统提示词">自定义系统提示词</h3><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 完全自定义</span></span><br><span class="line">claude --system-prompt <span class="string">"你是 Rust 专家，专注于性能和安全性"</span> \</span><br><span class="line">  -p <span class="string">"实现并发数据结构"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 追加到默认提示词</span></span><br><span class="line">claude --append-system-prompt <span class="string">"所有代码必须包含文档注释和单元测试"</span> \</span><br><span class="line">  -p <span class="string">"创建二叉搜索树"</span></span><br></pre></td></tr></tbody></table></figure><h3 id="工具权限精细控制">工具权限精细控制</h3><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 允许特定 Git 命令</span></span><br><span class="line">claude --allowed-tools <span class="string">"Bash(git:status),Bash(git:log),Bash(git:diff)"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 禁止危险操作</span></span><br><span class="line">claude --disallowed-tools <span class="string">"Bash(rm:*),Bash(dd:*)"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 组合使用</span></span><br><span class="line">claude \</span><br><span class="line">  --allowed-tools <span class="string">"Bash(git:*),Read,Edit"</span> \</span><br><span class="line">  --disallowed-tools <span class="string">"Bash(git:push)"</span> \</span><br><span class="line">  -p <span class="string">"审查代码但不推送"</span></span><br></pre></td></tr></tbody></table></figure><h3 id="多源设置加载">多源设置加载</h3><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 优先级：local &gt; project &gt; user</span></span><br><span class="line">claude --setting-sources project,<span class="built_in">local</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 仅项目设置</span></span><br><span class="line">claude --setting-sources project</span><br><span class="line"></span><br><span class="line"><span class="comment"># 自定义设置覆盖</span></span><br><span class="line">claude \</span><br><span class="line">  --settings ./override.json \</span><br><span class="line">  --setting-sources user,project</span><br></pre></td></tr></tbody></table></figure><h3 id="流式数据处理">流式数据处理</h3><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 实时流式输入输出</span></span><br><span class="line"><span class="built_in">cat</span> large-dataset.json | claude -p \</span><br><span class="line">  --input-format stream-json \</span><br><span class="line">  --output-format stream-json \</span><br><span class="line">  --replay-user-messages \</span><br><span class="line">  &gt; processed-output.json</span><br><span class="line"></span><br><span class="line"><span class="comment"># 监控流式处理</span></span><br><span class="line">claude -p <span class="string">"处理大规模数据"</span> \</span><br><span class="line">  --output-format stream-json \</span><br><span class="line">  --include-partial-messages \</span><br><span class="line">  --<span class="built_in">print</span></span><br></pre></td></tr></tbody></table></figure><h3 id="调试复杂问题">调试复杂问题</h3><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 启用特定类别调试</span></span><br><span class="line">claude -d <span class="string">"api,hooks"</span> -p <span class="string">"调试 MCP 连接"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 排除噪音</span></span><br><span class="line">claude -d <span class="string">"!statsig,!file"</span> -p <span class="string">"专注 API 调用"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 详细模式</span></span><br><span class="line">claude --verbose -d <span class="string">"all"</span> -p <span class="string">"完整调试信息"</span></span><br></pre></td></tr></tbody></table></figure><hr><h2 id="故障排除">故障排除</h2><h3 id="常见问题">常见问题</h3><h4 id="1-MCP-服务器连接失败">1. MCP 服务器连接失败</h4><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 启用 MCP 调试</span></span><br><span class="line">claude -d <span class="string">"mcp"</span> --mcp-config ./server.json -p <span class="string">"测试连接"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查服务器配置</span></span><br><span class="line">claude mcp list</span><br><span class="line"></span><br><span class="line"><span class="comment"># 验证配置文件格式</span></span><br><span class="line"><span class="built_in">cat</span> ./server.json | jq .</span><br></pre></td></tr></tbody></table></figure><h4 id="2-权限被拒绝">2. 权限被拒绝</h4><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 查看当前权限模式</span></span><br><span class="line">claude --permission-mode default -p <span class="string">"检查权限"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 临时绕过（仅可信环境）</span></span><br><span class="line">claude --permission-mode bypassPermissions -p <span class="string">"任务"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 允许特定工具</span></span><br><span class="line">claude --allowed-tools <span class="string">"Read,Edit"</span> -p <span class="string">"受限任务"</span></span><br></pre></td></tr></tbody></table></figure><h4 id="3-会话无法恢复">3. 会话无法恢复</h4><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 列出可用会话</span></span><br><span class="line">claude -r</span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查会话 ID</span></span><br><span class="line">claude --session-id &lt;your-uuid&gt; -p <span class="string">"测试"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用 fork 创建新分支</span></span><br><span class="line">claude -c --fork-session</span><br></pre></td></tr></tbody></table></figure><h4 id="4-模型过载">4. 模型过载</h4><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 设置备用模型</span></span><br><span class="line">claude -p <span class="string">"重要任务"</span> \</span><br><span class="line">  --model opus \</span><br><span class="line">  --fallback-model sonnet \</span><br><span class="line">  --<span class="built_in">print</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 直接使用备用模型</span></span><br><span class="line">claude -p <span class="string">"任务"</span> --model sonnet --<span class="built_in">print</span></span><br></pre></td></tr></tbody></table></figure><h4 id="5-插件加载失败">5. 插件加载失败</h4><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 检查插件目录</span></span><br><span class="line">claude --plugin-dir ./custom-plugins -p <span class="string">"测试插件"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 列出已安装插件</span></span><br><span class="line">claude plugin list</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重新安装插件</span></span><br><span class="line">claude plugin install &lt;plugin-name&gt; --reinstall</span><br></pre></td></tr></tbody></table></figure><h3 id="调试技巧">调试技巧</h3><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 1. 启用详细输出</span></span><br><span class="line">claude --verbose -d <span class="string">"all"</span> -p <span class="string">"调试任务"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 检查配置</span></span><br><span class="line">claude --settings ~/.claude/settings.json -p <span class="string">"验证配置"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 测试工具权限</span></span><br><span class="line">claude --allowed-tools <span class="string">"Bash(echo:*)"</span> -p <span class="string">"echo 'test'"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. 检查 MCP 配置</span></span><br><span class="line">claude mcp list</span><br><span class="line">claude -d <span class="string">"mcp"</span> -p <span class="string">"测试 MCP"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 5. 运行健康检查</span></span><br><span class="line">claude doctor</span><br></pre></td></tr></tbody></table></figure><hr><h2 id="最佳实践">最佳实践</h2><h3 id="1-性能优化">1. 性能优化</h3><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 简单任务使用轻量级模型</span></span><br><span class="line">claude -p <span class="string">"小任务"</span> --model haiku --<span class="built_in">print</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置预算避免超支</span></span><br><span class="line">claude -p <span class="string">"任务"</span> --max-budget-usd 5.00 --<span class="built_in">print</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用备用模型确保可用性</span></span><br><span class="line">claude -p <span class="string">"关键任务"</span> \</span><br><span class="line">  --model opus \</span><br><span class="line">  --fallback-model sonnet \</span><br><span class="line">  --<span class="built_in">print</span></span><br></pre></td></tr></tbody></table></figure><h3 id="2-安全性">2. 安全性</h3><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 限制工具权限</span></span><br><span class="line">claude --allowed-tools <span class="string">"Read,Grep"</span> -p <span class="string">"只读任务"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 禁用危险操作</span></span><br><span class="line">claude --disallowed-tools <span class="string">"Bash(rm:*),Bash(dd:*)"</span> -p <span class="string">"安全任务"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 在可信环境使用 -p</span></span><br><span class="line">claude -p <span class="string">"任务"</span> --<span class="built_in">print</span>  <span class="comment"># 跳过信任对话框，确保目录可信</span></span><br></pre></td></tr></tbody></table></figure><h3 id="3-自动化集成">3. 自动化集成</h3><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 使用 JSON 输出便于解析</span></span><br><span class="line">claude -p <span class="string">"任务"</span> --output-format json --<span class="built_in">print</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用 JSON Schema 确保输出格式</span></span><br><span class="line">claude -p <span class="string">"任务"</span> \</span><br><span class="line">  --output-format json \</span><br><span class="line">  --json-schema <span class="string">'{"type":"object","properties":{"result":{"type":"string"}}}'</span> \</span><br><span class="line">  --<span class="built_in">print</span></span><br></pre></td></tr></tbody></table></figure><h3 id="4-会话管理">4. 会话管理</h3><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 使用有意义的会话便于恢复</span></span><br><span class="line">claude  <span class="comment"># 在会话中专注于单个任务</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 定期保存重要会话</span></span><br><span class="line">claude -r <span class="string">"重要任务"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用 fork 尝试不同方案</span></span><br><span class="line">claude -c --fork-session</span><br></pre></td></tr></tbody></table></figure><hr><h2 id="附录">附录</h2><h3 id="快速参考卡片">快速参考卡片</h3><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 基本使用</span></span><br><span class="line">claude                    <span class="comment"># 交互式会话</span></span><br><span class="line">claude -p <span class="string">"任务"</span>          <span class="comment"># 非交互模式</span></span><br><span class="line">claude -c                 <span class="comment"># 继续上一次会话</span></span><br><span class="line">claude -r [<span class="built_in">id</span>]            <span class="comment"># 恢复会话</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 常用选项</span></span><br><span class="line">--model &lt;name&gt;            <span class="comment"># 指定模型</span></span><br><span class="line">--output-format json      <span class="comment"># JSON 输出</span></span><br><span class="line">--allowed-tools &lt;list&gt;    <span class="comment"># 工具白名单</span></span><br><span class="line">--mcp-config &lt;file&gt;       <span class="comment"># MCP 配置</span></span><br><span class="line">-d &lt;filter&gt;               <span class="comment"># 调试模式</span></span><br><span class="line">--verbose                 <span class="comment"># 详细输出</span></span><br><span class="line">--permission-mode &lt;mode&gt;  <span class="comment"># 权限模式</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 常用命令</span></span><br><span class="line">claude mcp list           <span class="comment"># 列出 MCP 服务器</span></span><br><span class="line">claude plugin list        <span class="comment"># 列出插件</span></span><br><span class="line">claude doctor             <span class="comment"># 健康检查</span></span><br><span class="line">claude update             <span class="comment"># 更新检查</span></span><br><span class="line">claude install stable     <span class="comment"># 安装稳定版</span></span><br></pre></td></tr></tbody></table></figure><h3 id="相关资源">相关资源</h3><ul><li><a href="https://docs.claude.com/claude-code">Claude Code 官方文档</a></li><li><a href="https://modelcontextprotocol.io">MCP 协议规范</a></li><li><a href="https://docs.anthropic.com/api">Claude API 文档</a></li></ul><hr><h2 id="版本信息">版本信息</h2><p>本文档基于 Claude Code CLI 的当前版本编写。使用 <code>claude --version</code> 查看安装的版本。</p><hr><h2 id="文档更新日志">文档更新日志</h2><h3 id="2025-12-24">2025-12-24</h3><p><strong>修正内容</strong>：</p><ul><li>✅ 更新 <code>mcp</code> 命令文档，添加所有实际子命令（<code>serve</code>, <code>get</code>, <code>add-json</code>, <code>add-from-claude-desktop</code>, <code>reset-project-choices</code>）</li><li>✅ 修正 <code>add</code> 命令的参数格式（<code>add [options] &lt;name&gt; &lt;commandOrUrl&gt; [args...]</code>）</li><li>✅ 添加 <code>--transport</code> 选项说明（支持 http、sse、stdio）</li><li>✅ 添加实际 MCP 服务器配置示例（Sentry HTTP、Asana SSE、Airtable stdio）</li><li>✅ 更新 <code>plugin</code> 命令文档，添加所有子命令（<code>validate</code>, <code>marketplace</code>, <code>enable</code>, <code>disable</code>）</li><li>✅ 修正插件安装命令格式（支持 <code>plugin@marketplace</code> 格式）</li><li>✅ 添加 <code>--force</code> 选项到 <code>install</code> 命令</li><li>✅ 添加 <code>plan</code> 到 <code>--permission-mode</code> 可选值</li></ul><p><strong>验证方法</strong>：<br>所有命令和选项均已通过实际 <code>claude --help</code> 和子命令帮助验证。</p><hr><p><strong>最后更新</strong>: 2025-12-25</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>tmp-record</title>
      <link href="/2025/12/09/tmp-record/"/>
      <url>/2025/12/09/tmp-record/</url>
      
        <content type="html"><![CDATA[<h2 id="https-github-com-rlancemartin-claude-diary原文章https-rlancemartin-github-io-2025-12-01-claude-diary"><a href="https://github.com/rlancemartin/claude-diary%E5%8E%9F%E6%96%87%E7%AB%A0https://rlancemartin.github.io/2025/12/01/claude_diary/">https://github.com/rlancemartin/claude-diary原文章https://rlancemartin.github.io/2025/12/01/claude_diary/</a></h2><p>● ✅ Claude Diary 本机构建完成！</p><p>安装结果</p><p>已成功安装的组件：</p><ol><li>命令文件：<br>- ~/.claude/commands/dairy.md - 日记生成命令<br>- ~/.claude/commands/reflect.md - 模式反思命令</li><li>钩子系统：<br>- ~/.claude/hooks/pre-compact.sh - 自动日记生成钩子（已设置执行权限）</li></ol><p>使用方法：</p><p>现在可以在 Claude Code 中使用以下命令：</p><h1>手动创建当前会话的日记条目</h1><p>/diary</p><h1>分析日记条目并更新 <a href="http://CLAUDE.md">CLAUDE.md</a></h1><p>/reflect</p><h1>带选项的反思命令</h1><p>/reflect last 10 entries<br>/reflect from 2025-01-01 to 2025-01-31<br>/reflect for project /path/to/project<br>/reflect related to testing</p><p>自动化功能：</p><ul><li>PreCompact 钩子：当会话达到 200+ 条消息准备压缩时，会自动触发 /diary 命令生成日记条目</li></ul><p>存储位置：</p><ul><li>日记条目：~/.claude/memory/diary/YYYY-MM-DD-session-N.md</li><li>反思文档：~/.claude/memory/reflections/YYYY-MM-reflection-N.md</li><li>处理日志：~/.claude/memory/reflections/processed.log</li></ul><p>系统现在已经准备好开始学习你的开发模式和偏好了！你可以通过运行 /diary 来开始记录当前会话。</p><p>下面我给你一套系统、可落地、可长期复用的<strong>Agent SDK 学习方法论</strong>，适用于 LangChain、Qwen Code TypeScript SDK、LlamaIndex、ModelScope-Agent 等所有智能体框架。内容偏“工程实战 + 架构理解”，能帮助你快速掌握 SDK、本质能力、设计理念和最佳实践。</p><hr><h1><strong>一、学习 Agent SDK 的总体路线图（从外到内、从用到懂）</strong></h1><p>学习智能体 SDK 的正确顺序，不是 API 从头念到尾，而是：</p><h2 id="阶段-1：掌握基本使用（能跑）"><strong>阶段 1：掌握基本使用（能跑）</strong></h2><p>目标：能写出最小可用 Demo，并理解其核心结构。</p><p>核心任务：</p><ol><li>会用模型（LLM/Embedding/Code LLM）</li><li>会用 Prompt、Memory、Tools（或 Functions）</li><li>能构建一个最小的 Agent（ReAct、Tool Calling、Code Interpreter）</li></ol><p>你可以用 1 天时间完成这些，避免卡在概念上的停滞。</p><hr><h2 id="阶段-2：理解框架设计（能扩）"><strong>阶段 2：理解框架设计（能扩）</strong></h2><p>目标：理解为什么要这样设计，如何扩展自定义模块。</p><p>核心内容：</p><ol><li><strong>LangChain：Runnable、LCEL、Tool、OutputParser、AgentExecutor</strong></li><li><strong>Qwen Code TS SDK：Agent、Step、Tool、Message Stream、Code Interpreter Runtime</strong></li><li>工具调用机制（OpenAI function calling / JSON Schema）</li><li>任务规划（ReAct / Plan-Execute）</li><li>Agent 的结构化输入输出</li></ol><p>这阶段的重点是理解“链式调用”和“工具执行生命周期”。</p><hr><h2 id="阶段-3：深入工程落地（能上生产）"><strong>阶段 3：深入工程落地（能上生产）</strong></h2><p>目标：掌握 agent 在生产中的能力和限制。</p><p>重点技能：</p><ol><li><strong>并发与任务调度</strong></li><li><strong>状态管理（Memory / Checkpoint）</strong></li><li><strong>安全控制（工具权限、沙箱、代码执行限制）</strong></li><li><strong>观测能力（Tracing、Telemetry、调用链分析）</strong></li><li><strong>可测试性（模拟工具、Mock LLM）</strong></li></ol><p>这是把 SDK 变成“系统能力”的关键阶段。</p><hr><h2 id="阶段-4：掌握框架底层原理（能改）"><strong>阶段 4：掌握框架底层原理（能改）</strong></h2><p>目标：能理解并调整 SDK 内部机制，能写自定义工具链。</p><p>学习点：</p><ol><li><strong>LLM 推理模式（ReAct、CoT、Plan-Execute、Self-Refine）</strong></li><li><strong>Tool 调度和 Agent Loop 实现机制</strong></li><li><strong>流式输出（SSE / WebSocket）实现原理</strong></li><li><strong>沙箱和代码解释器实现原理（Qwen Code 强项）</strong></li><li><strong>上下文管理与 Token 预算控制策略</strong></li></ol><p>这个阶段让你能从“用框架”转到“创造框架”。</p><hr><h1><strong>二、学习 Agent SDK 必备的能力（核心技能清单）</strong></h1><h2 id="技能-1：Prompt-Engineering（提示工程）"><strong>技能 1：Prompt Engineering（提示工程）</strong></h2><p>必须掌握：</p><ul><li>系统提示词 (System Prompt) 的结构化写法</li><li>工具使用示例提示（非常关键）</li><li>角色扮演式智能体构建</li><li>多智能体协作的提示方式（planner/executor）</li></ul><hr><h2 id="技能-2：Tool-Function-Calling-设计"><strong>技能 2：Tool / Function Calling 设计</strong></h2><p>你需要理解：</p><ul><li>什么时候需要工具，而不是 LLM 直接回答</li><li>工具应如何拆分（单一职责原则）</li><li>工具输入输出的 JSON Schema 规范</li><li>工具安全边界（避免文件系统/命令注入）</li></ul><p>这是 Agent 的灵魂技能。</p><hr><h2 id="技能-3：代码解释器-沙箱执行的理解"><strong>技能 3：代码解释器 / 沙箱执行的理解</strong></h2><p>特别在 Qwen Code 中非常重要：</p><p>要掌握：</p><ul><li>代码执行生命周期（准备、运行、输出捕获、资源清理）</li><li>Python/JS 沙箱模型</li><li>文件系统隔离</li><li>如何通过工具暴露文件、网络、数据库访问（安全前提下）</li></ul><hr><h2 id="技能-4：状态管理-Memory"><strong>技能 4：状态管理 / Memory</strong></h2><p>你要理解：</p><ul><li>短期记忆 vs 长期记忆</li><li>LangChain Memory 与 Checkpointing 的区别</li><li>Qwen Code 的多轮数据传递机制</li><li>如何构建可回溯的 Agent 过程</li></ul><hr><h2 id="技能-5：可观测性（Observability）"><strong>技能 5：可观测性（Observability）</strong></h2><p>生产级 Agent 必备：</p><ul><li>LangSmith（LangChain 官方观测平台）</li><li>OpenTelemetry 集成</li><li>Token 成本分析</li><li>工具执行日志链路</li></ul><hr><h2 id="技能-6：程序化思维（Agent-as-Software）"><strong>技能 6：程序化思维（Agent as Software）</strong></h2><p>SDK 的核心思想：<strong>Agent 不是 Prompt，而是软件系统</strong>。</p><p>需要掌握：</p><ul><li>模块拆分</li><li>接口/工具规范化</li><li>可测试性（Mock LLM）</li><li>多 Agent 架构（Planner / Worker / Critic）</li></ul><hr><h1><strong>三、适用于 LangChain 和 Qwen Code 的统一学习方法论</strong></h1><p>下面这套方法论，你可以反复用于任何 Agent SDK。</p><hr><h2 id="方法论-1：从“写一个功能”开始，不要从-API-学起"><strong>方法论 1：从“写一个功能”开始，不要从 API 学起</strong></h2><p>比如目标是：</p><blockquote><p>写一个能爬网页、分析内容并生成总结的 Agent。</p></blockquote><p>你会自动用上：</p><ul><li>LLM</li><li>Tool</li><li>Memory</li><li>Streaming</li><li>Agent Loop</li></ul><p>比看文档有效 10 倍。</p><hr><h2 id="方法论-2：从“任务流图（Chain-Graph）”理解框架"><strong>方法论 2：从“任务流图（Chain Graph）”理解框架</strong></h2><p>所有 Agent SDK 本质上都是：</p><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">Input</span><br><span class="line">  -&gt; Parse  -&gt; Tool Select -&gt; Tool Execute -&gt; Reasoning -&gt; Output</span><br></pre></td></tr></tbody></table></figure><p>如果你能画这个图，就能看懂任何 SDK。</p><hr><h2 id="方法论-3：阅读一个优秀的开源项目并复刻它"><strong>方法论 3：阅读一个优秀的开源项目并复刻它</strong></h2><p>最佳示例：</p><h3 id="LangChain">LangChain</h3><ul><li>LangGraph</li><li>LCEL Pipelines</li><li>ReAct Agent 实现源码</li></ul><h3 id="Qwen-Code-TypeScript-SDK">Qwen Code TypeScript SDK</h3><ul><li>官方 examples：具有完整 agent+tool+code interpreter 的范例</li><li>Code Interpreter 的 sandbox 实现</li></ul><p>阅读这些比看文档有效多了。</p><hr><h2 id="方法论-4：把-SDK-压缩到一个最小可控模型（MiniAgent）"><strong>方法论 4：把 SDK 压缩到一个最小可控模型（MiniAgent）</strong></h2><p>你可以自己动手写一个 200 行左右的 “迷你 Agent 框架”，理解其核心是：</p><ol><li>让 LLM 解析意图</li><li>结构化输出 Tool 调用</li><li>调用 Tool 并返回结果</li><li>循环直到返回自然语言答案</li></ol><p>理解了这个，你可以学会任何框架。</p><hr><h2 id="方法论-5：刻意训练工具开发能力"><strong>方法论 5：刻意训练工具开发能力</strong></h2><p>每天做 3 个小工具，包括：</p><ul><li>文件读写</li><li>网页爬虫</li><li>数据库读写</li><li>代码执行</li><li>报表生成</li></ul><p>Agent 的强大，100% 来自工具库的丰富度。</p><hr><h1><strong>四、至少需要掌握的技能清单（工程级）</strong></h1><p>总结如下，是你最低要掌握的清单：</p><h2 id="基础能力"><strong>基础能力</strong></h2><ul><li>JavaScript/TypeScript</li><li>Python（如果要用 Code Interpreter）</li><li>基本后端技能（API、DB、HTTP）</li></ul><h2 id="Agent-核心技能"><strong>Agent 核心技能</strong></h2><ul><li>Prompt 结构化设计</li><li>JSON Schema /工具设计</li><li>Tool-Calling 机制</li><li>代码执行沙箱理解</li><li>推理模式（ReAct、Plan&amp;Execute）</li></ul><h2 id="框架相关能力"><strong>框架相关能力</strong></h2><ul><li>LangChain Runnable / LCEL</li><li>LangGraph（状态机 Agent）</li><li>Qwen Code Interpreter API</li><li>Streaming + SSE/WebSocket</li></ul><h2 id="工程化必备"><strong>工程化必备</strong></h2><ul><li>监控 &amp; 调试 &amp; Token 分析</li><li>多 Agent 协作模式</li><li>安全机制（工具权限、执行隔离）</li><li>高并发代理调度</li></ul><hr><h1><strong>如果你愿意，我可以为你制定：</strong></h1><ol><li><strong>LangChain + Qwen Code SDK 的 7 天速成计划</strong></li><li><strong>长期 Agent 架构训练路线图</strong></li><li><strong>你当前能力的差距评估与强化建议</strong></li><li><strong>打造你自己的 Agent SDK（MiniAgent）</strong></li></ol><p>你想从哪一项开始？</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Qwen Code 0.4.0 TypeScript SDK 完全实战指南</title>
      <link href="/2025/12/08/0007-qwen-code-0-4-0-typescript-sdk-guide/"/>
      <url>/2025/12/08/0007-qwen-code-0-4-0-typescript-sdk-guide/</url>
      
        <content type="html"><![CDATA[<h1>Qwen Code 0.4.0 TypeScript SDK 完全实战指南</h1><blockquote><p>从命令行工具到可编程 AI 平台的革命性升级 - 包含完整可运行的项目示例</p></blockquote><h2 id="前言">前言</h2><p>Qwen Code 0.4.0 发布了 TypeScript SDK，这是一个历史性的更新。它将 Qwen Code 从一个纯粹的命令行工具转变为一个可以嵌入到任何 TypeScript/JavaScript 应用中的可编程 AI 平台。</p><p>本文将提供<strong>完全可运行的实战指南</strong>，让你能够亲身体验这个 SDK 的强大能力。</p><hr><h2 id="1-环境准备">1. 环境准备</h2><h3 id="1-1-系统要求">1.1 系统要求</h3><ul><li>Node.js &gt;= 20.0.0</li><li>npm 或 yarn</li><li>基础的 TypeScript 知识（可选）</li></ul><h3 id="1-2-安装-Qwen-Code-CLI">1.2 安装 Qwen Code CLI</h3><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 全局安装 Qwen Code CLI</span></span><br><span class="line">npm install -g @qwen-code/qwen-code@latest</span><br><span class="line"></span><br><span class="line"><span class="comment"># 验证安装</span></span><br><span class="line">qwen --version</span><br><span class="line"><span class="comment"># 应该输出: 0.4.0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 测试 CLI 是否工作（首次运行会要求认证）</span></span><br><span class="line">qwen <span class="string">"Hello, test"</span></span><br></pre></td></tr></tbody></table></figure><p>如果认证有问题，请参考官方文档设置认证（推荐使用 Qwen OAuth）。</p><h3 id="1-3-创建项目目录">1.3 创建项目目录</h3><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 创建主项目目录</span></span><br><span class="line"><span class="built_in">mkdir</span> qwen-sdk-demo</span><br><span class="line"><span class="built_in">cd</span> qwen-sdk-demo</span><br><span class="line"></span><br><span class="line"><span class="comment"># 初始化 npm 项目</span></span><br><span class="line">npm init -y</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装 SDK</span></span><br><span class="line">npm install @qwen-code/sdk zod</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装 TypeScript 和开发工具</span></span><br><span class="line">npm install --save-dev typescript @types/node tsx nodemon</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建配置文件</span></span><br><span class="line">npx tsc --init</span><br></pre></td></tr></tbody></table></figure><h3 id="1-4-配置环境变量">1.4 配置环境变量</h3><p>创建 <code>.env</code> 文件：</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># .env</span></span><br><span class="line">QWEN_CODE_CLI_PATH=/home/你的用户名/.nvm/versions/node/v24.11.1/bin/qwen</span><br></pre></td></tr></tbody></table></figure><p><strong>重要</strong>: 将 <code>/home/你的用户名/</code> 替换为你的实际路径。可以通过以下命令找到正确路径：</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="built_in">which</span> qwen</span><br><span class="line"><span class="comment"># 输出类似: /home/yourname/.nvm/versions/node/v24.11.1/bin/qwen</span></span><br></pre></td></tr></tbody></table></figure><h3 id="1-5-配置-TypeScript">1.5 配置 TypeScript</h3><p>创建 <code>tsconfig.json</code>：</p><figure class="highlight json"><table><tbody><tr><td class="code"><pre><span class="line"><span class="punctuation">{</span></span><br><span class="line">  <span class="attr">"compilerOptions"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">    <span class="attr">"target"</span><span class="punctuation">:</span> <span class="string">"ES2022"</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">"module"</span><span class="punctuation">:</span> <span class="string">"ESNext"</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">"moduleResolution"</span><span class="punctuation">:</span> <span class="string">"bundler"</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">"allowSyntheticDefaultImports"</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">"esModuleInterop"</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">"allowJs"</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">"strict"</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">"skipLibCheck"</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">"outDir"</span><span class="punctuation">:</span> <span class="string">"./dist"</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">"rootDir"</span><span class="punctuation">:</span> <span class="string">"./src"</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">"declaration"</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">"sourceMap"</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">  <span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">"include"</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">"src/**/*"</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">"exclude"</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">"node_modules"</span><span class="punctuation">,</span> <span class="string">"dist"</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">}</span></span><br></pre></td></tr></tbody></table></figure><h3 id="1-6-更新-package-json">1.6 更新 package.json</h3><figure class="highlight json"><table><tbody><tr><td class="code"><pre><span class="line"><span class="punctuation">{</span></span><br><span class="line">  <span class="attr">"name"</span><span class="punctuation">:</span> <span class="string">"qwen-sdk-demo"</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">"version"</span><span class="punctuation">:</span> <span class="string">"1.0.0"</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">"type"</span><span class="punctuation">:</span> <span class="string">"module"</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">"scripts"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">    <span class="attr">"build"</span><span class="punctuation">:</span> <span class="string">"tsc"</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">"dev"</span><span class="punctuation">:</span> <span class="string">"tsx watch src/index.ts"</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">"start"</span><span class="punctuation">:</span> <span class="string">"node dist/index.js"</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">"test"</span><span class="punctuation">:</span> <span class="string">"npm run build &amp;&amp; npm run start"</span></span><br><span class="line">  <span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">"dependencies"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">    <span class="attr">"@qwen-code/sdk"</span><span class="punctuation">:</span> <span class="string">"^0.4.0"</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">"zod"</span><span class="punctuation">:</span> <span class="string">"^3.22.4"</span></span><br><span class="line">  <span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">"devDependencies"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">    <span class="attr">"@types/node"</span><span class="punctuation">:</span> <span class="string">"^20.0.0"</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">"tsx"</span><span class="punctuation">:</span> <span class="string">"^4.0.0"</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">"typescript"</span><span class="punctuation">:</span> <span class="string">"^5.0.0"</span></span><br><span class="line">  <span class="punctuation">}</span></span><br><span class="line"><span class="punctuation">}</span></span><br></pre></td></tr></tbody></table></figure><p>创建目录结构：</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> src</span><br><span class="line"><span class="built_in">mkdir</span> src/tools</span><br><span class="line"><span class="built_in">mkdir</span> src/agents</span><br><span class="line"><span class="built_in">mkdir</span> src/utils</span><br></pre></td></tr></tbody></table></figure><hr><h2 id="2-基础功能演示">2. 基础功能演示</h2><h3 id="2-1-创建基础配置">2.1 创建基础配置</h3><p>创建 <code>src/utils/config.ts</code>：</p><figure class="highlight typescript"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">// src/utils/config.ts</span></span><br><span class="line"><span class="keyword">import</span> dotenv <span class="keyword">from</span> <span class="string">'dotenv'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 加载环境变量</span></span><br><span class="line">dotenv.<span class="title function_">config</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> config = {</span><br><span class="line">  <span class="attr">qwenPath</span>: process.<span class="property">env</span>.<span class="property">QWEN_CODE_CLI_PATH</span> || <span class="string">'qwen'</span>,</span><br><span class="line">  <span class="attr">projectPath</span>: process.<span class="title function_">cwd</span>(),</span><br><span class="line">  <span class="attr">debug</span>: process.<span class="property">env</span>.<span class="property">NODE_ENV</span> === <span class="string">'development'</span></span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="comment">// 验证配置</span></span><br><span class="line"><span class="keyword">if</span> (!config.<span class="property">qwenPath</span> || config.<span class="property">qwenPath</span> === <span class="string">'qwen'</span>) {</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">warn</span>(<span class="string">'⚠️  警告: 未设置 QWEN_CODE_CLI_PATH，使用系统 PATH'</span>);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h3 id="2-2-创建第一个-SDK-应用">2.2 创建第一个 SDK 应用</h3><p>创建 <code>src/index.ts</code>：</p><figure class="highlight typescript"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">// src/index.ts</span></span><br><span class="line"><span class="keyword">import</span> { query } <span class="keyword">from</span> <span class="string">'@qwen-code/sdk'</span>;</span><br><span class="line"><span class="keyword">import</span> { config } <span class="keyword">from</span> <span class="string">'./utils/config'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">basicDemo</span>(<span class="params"></span>) {</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">'🚀 Qwen Code SDK 基础演示\n'</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">try</span> {</span><br><span class="line">    <span class="keyword">const</span> result = <span class="title function_">query</span>({</span><br><span class="line">      <span class="attr">prompt</span>: <span class="string">'你好！请用中文简单介绍一下你自己，限制在100字以内。'</span>,</span><br><span class="line">      <span class="attr">options</span>: {</span><br><span class="line">        <span class="attr">pathToQwenExecutable</span>: config.<span class="property">qwenPath</span>,</span><br><span class="line">        <span class="attr">cwd</span>: config.<span class="property">projectPath</span>,</span><br><span class="line">        <span class="attr">debug</span>: config.<span class="property">debug</span>,</span><br><span class="line">        <span class="attr">permissionMode</span>: <span class="string">'yolo'</span></span><br><span class="line">      }</span><br><span class="line">    });</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">'🤖 AI 回复:'</span>);</span><br><span class="line">    <span class="keyword">for</span> <span class="title function_">await</span> (<span class="keyword">const</span> message <span class="keyword">of</span> result) {</span><br><span class="line">      <span class="keyword">if</span> (message.<span class="property">type</span> === <span class="string">'assistant'</span>) {</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(message.<span class="property">message</span>.<span class="property">content</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">'\n✅ 基础演示完成！'</span>);</span><br><span class="line">  } <span class="keyword">catch</span> (error) {</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">'❌ 错误:'</span>, error.<span class="property">message</span>);</span><br><span class="line">    <span class="keyword">if</span> (error.<span class="property">message</span>.<span class="title function_">includes</span>(<span class="string">'not found'</span>)) {</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">'\n💡 解决建议:'</span>);</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">'1. 检查 QWEN_CODE_CLI_PATH 环境变量是否正确设置'</span>);</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">'2. 确保已安装 Qwen Code CLI: npm install -g @qwen-code/qwen-code'</span>);</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">'3. 运行 which qwen 查找正确路径'</span>);</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 运行基础演示</span></span><br><span class="line"><span class="title function_">basicDemo</span>();</span><br></pre></td></tr></tbody></table></figure><h3 id="2-3-运行测试">2.3 运行测试</h3><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 确保在 qwen-sdk-demo 目录中</span></span><br><span class="line"><span class="built_in">pwd</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装 dotenv 包（我们之前忘记安装了）</span></span><br><span class="line">npm install dotenv</span><br><span class="line"></span><br><span class="line"><span class="comment"># 开发模式运行</span></span><br><span class="line">npm run dev</span><br></pre></td></tr></tbody></table></figure><p>如果一切正常，你应该看到类似输出：</p><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">🚀 Qwen Code SDK 基础演示</span><br><span class="line"></span><br><span class="line">🤖 AI 回复:</span><br><span class="line">你好！我是Qwen Code，专门处理软件工程任务的AI助手。我可以帮助你进行代码编写、调试、重构、文档生成等工作，同时也能够运行构建、测试等命令。我会严格遵守项目规范，确保代码质量和安全性。</span><br><span class="line"></span><br><span class="line">✅ 基础演示完成！</span><br></pre></td></tr></tbody></table></figure><hr><h2 id="3-自定义工具开发">3. 自定义工具开发</h2><h3 id="3-1-创建文件分析工具">3.1 创建文件分析工具</h3><p>创建 <code>src/tools/fileTools.ts</code>：</p><figure class="highlight typescript"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">// src/tools/fileTools.ts</span></span><br><span class="line"><span class="keyword">import</span> { tool } <span class="keyword">from</span> <span class="string">'@qwen-code/sdk'</span>;</span><br><span class="line"><span class="keyword">import</span> { z } <span class="keyword">from</span> <span class="string">'zod'</span>;</span><br><span class="line"><span class="keyword">import</span> { readFileSync, readdirSync, statSync } <span class="keyword">from</span> <span class="string">'fs'</span>;</span><br><span class="line"><span class="keyword">import</span> { join, extname } <span class="keyword">from</span> <span class="string">'path'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 文件分析工具</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> fileAnalyzerTool = <span class="title function_">tool</span>(</span><br><span class="line">  <span class="string">'analyze_file'</span>,</span><br><span class="line">  <span class="string">'分析文件的详细信息，包括大小、行数、语言等'</span>,</span><br><span class="line">  {</span><br><span class="line">    <span class="attr">filePath</span>: z.<span class="title function_">string</span>().<span class="title function_">describe</span>(<span class="string">'要分析的文件路径'</span>),</span><br><span class="line">    <span class="attr">includeContent</span>: z.<span class="title function_">boolean</span>().<span class="title function_">default</span>(<span class="literal">false</span>).<span class="title function_">describe</span>(<span class="string">'是否包含文件内容预览'</span>)</span><br><span class="line">  },</span><br><span class="line">  <span class="title function_">async</span> (args) =&gt; {</span><br><span class="line">    <span class="keyword">try</span> {</span><br><span class="line">      <span class="keyword">const</span> stats = <span class="title function_">statSync</span>(args.<span class="property">filePath</span>);</span><br><span class="line">      <span class="keyword">const</span> content = <span class="title function_">readFileSync</span>(args.<span class="property">filePath</span>, <span class="string">'utf-8'</span>);</span><br><span class="line">      <span class="keyword">const</span> lines = content.<span class="title function_">split</span>(<span class="string">'\n'</span>).<span class="property">length</span>;</span><br><span class="line">      <span class="keyword">const</span> ext = <span class="title function_">extname</span>(args.<span class="property">filePath</span>);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 简单的语言检测</span></span><br><span class="line">      <span class="keyword">let</span> language = <span class="string">'unknown'</span>;</span><br><span class="line">      <span class="keyword">const</span> <span class="attr">langMap</span>: <span class="title class_">Record</span>&lt;<span class="built_in">string</span>, <span class="built_in">string</span>&gt; = {</span><br><span class="line">        <span class="string">'.ts'</span>: <span class="string">'TypeScript'</span>,</span><br><span class="line">        <span class="string">'.js'</span>: <span class="string">'JavaScript'</span>,</span><br><span class="line">        <span class="string">'.py'</span>: <span class="string">'Python'</span>,</span><br><span class="line">        <span class="string">'.java'</span>: <span class="string">'Java'</span>,</span><br><span class="line">        <span class="string">'.cpp'</span>: <span class="string">'C++'</span>,</span><br><span class="line">        <span class="string">'.c'</span>: <span class="string">'C'</span>,</span><br><span class="line">        <span class="string">'.go'</span>: <span class="string">'Go'</span>,</span><br><span class="line">        <span class="string">'.rs'</span>: <span class="string">'Rust'</span>,</span><br><span class="line">        <span class="string">'.php'</span>: <span class="string">'PHP'</span>,</span><br><span class="line">        <span class="string">'.rb'</span>: <span class="string">'Ruby'</span></span><br><span class="line">      };</span><br><span class="line">      language = langMap[ext] || ext.<span class="title function_">substring</span>(<span class="number">1</span>).<span class="title function_">toUpperCase</span>() || <span class="string">'unknown'</span>;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> analysis = {</span><br><span class="line">        <span class="attr">path</span>: args.<span class="property">filePath</span>,</span><br><span class="line">        <span class="attr">size</span>: <span class="string">`<span class="subst">${(stats.size / <span class="number">1024</span>).toFixed(<span class="number">2</span>)}</span> KB`</span>,</span><br><span class="line">        <span class="attr">lines</span>: lines,</span><br><span class="line">        <span class="attr">language</span>: language,</span><br><span class="line">        <span class="attr">lastModified</span>: stats.<span class="property">mtime</span>.<span class="title function_">toISOString</span>(),</span><br><span class="line">        <span class="attr">contentPreview</span>: args.<span class="property">includeContent</span> ? content.<span class="title function_">substring</span>(<span class="number">0</span>, <span class="number">200</span>) + <span class="string">'...'</span> : <span class="literal">undefined</span></span><br><span class="line">      };</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> {</span><br><span class="line">        <span class="attr">content</span>: [{</span><br><span class="line">          <span class="attr">type</span>: <span class="string">'text'</span>,</span><br><span class="line">          <span class="attr">text</span>: <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(analysis, <span class="literal">null</span>, <span class="number">2</span>)</span><br><span class="line">        }]</span><br><span class="line">      };</span><br><span class="line">    } <span class="keyword">catch</span> (error) {</span><br><span class="line">      <span class="keyword">return</span> {</span><br><span class="line">        <span class="attr">content</span>: [{</span><br><span class="line">          <span class="attr">type</span>: <span class="string">'text'</span>,</span><br><span class="line">          <span class="attr">text</span>: <span class="string">`文件分析失败: <span class="subst">${error.message}</span>`</span></span><br><span class="line">        }],</span><br><span class="line">        <span class="attr">isError</span>: <span class="literal">true</span></span><br><span class="line">      };</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 目录结构分析工具</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> directoryAnalyzerTool = <span class="title function_">tool</span>(</span><br><span class="line">  <span class="string">'analyze_directory'</span>,</span><br><span class="line">  <span class="string">'分析目录结构，统计文件类型和数量'</span>,</span><br><span class="line">  {</span><br><span class="line">    <span class="attr">dirPath</span>: z.<span class="title function_">string</span>().<span class="title function_">describe</span>(<span class="string">'要分析的目录路径'</span>),</span><br><span class="line">    <span class="attr">depth</span>: z.<span class="title function_">number</span>().<span class="title function_">default</span>(<span class="number">2</span>).<span class="title function_">describe</span>(<span class="string">'分析深度'</span>),</span><br><span class="line">    <span class="attr">includeHidden</span>: z.<span class="title function_">boolean</span>().<span class="title function_">default</span>(<span class="literal">false</span>).<span class="title function_">describe</span>(<span class="string">'是否包含隐藏文件'</span>)</span><br><span class="line">  },</span><br><span class="line">  <span class="title function_">async</span> (args) =&gt; {</span><br><span class="line">    <span class="keyword">try</span> {</span><br><span class="line">      <span class="keyword">const</span> analyze = (<span class="attr">dirPath</span>: <span class="built_in">string</span>, <span class="attr">currentDepth</span>: <span class="built_in">number</span>): <span class="function"><span class="params">any</span> =&gt;</span> {</span><br><span class="line">        <span class="keyword">if</span> (currentDepth &lt;= <span class="number">0</span>) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">          <span class="keyword">const</span> items = <span class="title function_">readdirSync</span>(dirPath);</span><br><span class="line">          <span class="keyword">let</span> fileCount = <span class="number">0</span>;</span><br><span class="line">          <span class="keyword">let</span> dirCount = <span class="number">0</span>;</span><br><span class="line">          <span class="keyword">const</span> <span class="attr">fileTypes</span>: <span class="title class_">Record</span>&lt;<span class="built_in">string</span>, <span class="built_in">number</span>&gt; = {};</span><br><span class="line">          <span class="keyword">const</span> <span class="attr">structure</span>: <span class="built_in">any</span>[] = [];</span><br><span class="line"></span><br><span class="line">          <span class="keyword">for</span> (<span class="keyword">const</span> item <span class="keyword">of</span> items) {</span><br><span class="line">            <span class="comment">// 跳过隐藏文件（如果不包含）</span></span><br><span class="line">            <span class="keyword">if</span> (!args.<span class="property">includeHidden</span> &amp;&amp; item.<span class="title function_">startsWith</span>(<span class="string">'.'</span>)) {</span><br><span class="line">              <span class="keyword">continue</span>;</span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">            <span class="keyword">const</span> fullPath = <span class="title function_">join</span>(dirPath, item);</span><br><span class="line">            <span class="keyword">const</span> stat = <span class="title function_">statSync</span>(fullPath);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (stat.<span class="title function_">isDirectory</span>() &amp;&amp; currentDepth &gt; <span class="number">1</span>) {</span><br><span class="line">              dirCount++;</span><br><span class="line">              <span class="keyword">const</span> subAnalysis = <span class="title function_">analyze</span>(fullPath, currentDepth - <span class="number">1</span>);</span><br><span class="line">              structure.<span class="title function_">push</span>({</span><br><span class="line">                <span class="attr">name</span>: item,</span><br><span class="line">                <span class="attr">type</span>: <span class="string">'directory'</span>,</span><br><span class="line">                <span class="attr">children</span>: subAnalysis?.<span class="property">structure</span> || []</span><br><span class="line">              });</span><br><span class="line">            } <span class="keyword">else</span> <span class="keyword">if</span> (stat.<span class="title function_">isFile</span>()) {</span><br><span class="line">              fileCount++;</span><br><span class="line">              <span class="keyword">const</span> ext = <span class="title function_">extname</span>(item);</span><br><span class="line">              fileTypes[ext] = (fileTypes[ext] || <span class="number">0</span>) + <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">              structure.<span class="title function_">push</span>({</span><br><span class="line">                <span class="attr">name</span>: item,</span><br><span class="line">                <span class="attr">type</span>: <span class="string">'file'</span>,</span><br><span class="line">                <span class="attr">size</span>: <span class="string">`<span class="subst">${(stat.size / <span class="number">1024</span>).toFixed(<span class="number">2</span>)}</span> KB`</span></span><br><span class="line">              });</span><br><span class="line">            }</span><br><span class="line">          }</span><br><span class="line"></span><br><span class="line">          <span class="keyword">return</span> {</span><br><span class="line">            <span class="attr">path</span>: dirPath,</span><br><span class="line">            fileCount,</span><br><span class="line">            dirCount,</span><br><span class="line">            fileTypes,</span><br><span class="line">            <span class="attr">structure</span>: structure.<span class="title function_">slice</span>(<span class="number">0</span>, <span class="number">10</span>) <span class="comment">// 限制显示数量</span></span><br><span class="line">          };</span><br><span class="line">        } <span class="keyword">catch</span> (error) {</span><br><span class="line">          <span class="keyword">return</span> { <span class="attr">error</span>: error.<span class="property">message</span> };</span><br><span class="line">        }</span><br><span class="line">      };</span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> result = <span class="title function_">analyze</span>(args.<span class="property">dirPath</span>, args.<span class="property">depth</span>);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> {</span><br><span class="line">        <span class="attr">content</span>: [{</span><br><span class="line">          <span class="attr">type</span>: <span class="string">'text'</span>,</span><br><span class="line">          <span class="attr">text</span>: <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(result, <span class="literal">null</span>, <span class="number">2</span>)</span><br><span class="line">        }]</span><br><span class="line">      };</span><br><span class="line">    } <span class="keyword">catch</span> (error) {</span><br><span class="line">      <span class="keyword">return</span> {</span><br><span class="line">        <span class="attr">content</span>: [{</span><br><span class="line">          <span class="attr">type</span>: <span class="string">'text'</span>,</span><br><span class="line">          <span class="attr">text</span>: <span class="string">`目录分析失败: <span class="subst">${error.message}</span>`</span></span><br><span class="line">        }],</span><br><span class="line">        <span class="attr">isError</span>: <span class="literal">true</span></span><br><span class="line">      };</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">);</span><br></pre></td></tr></tbody></table></figure><h3 id="3-2-创建系统信息工具">3.2 创建系统信息工具</h3><p>创建 <code>src/tools/systemTools.ts</code>：</p><figure class="highlight typescript"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">// src/tools/systemTools.ts</span></span><br><span class="line"><span class="keyword">import</span> { tool } <span class="keyword">from</span> <span class="string">'@qwen-code/sdk'</span>;</span><br><span class="line"><span class="keyword">import</span> { z } <span class="keyword">from</span> <span class="string">'zod'</span>;</span><br><span class="line"><span class="keyword">import</span> { execSync } <span class="keyword">from</span> <span class="string">'child_process'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 系统信息工具</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> systemInfoTool = <span class="title function_">tool</span>(</span><br><span class="line">  <span class="string">'get_system_info'</span>,</span><br><span class="line">  <span class="string">'获取系统环境信息'</span>,</span><br><span class="line">  {</span><br><span class="line">    <span class="attr">detail</span>: z.<span class="title function_">enum</span>([<span class="string">'basic'</span>, <span class="string">'full'</span>]).<span class="title function_">default</span>(<span class="string">'basic'</span>).<span class="title function_">describe</span>(<span class="string">'信息详细程度'</span>)</span><br><span class="line">  },</span><br><span class="line">  <span class="title function_">async</span> (args) =&gt; {</span><br><span class="line">    <span class="keyword">try</span> {</span><br><span class="line">      <span class="keyword">const</span> os = <span class="keyword">await</span> <span class="keyword">import</span>(<span class="string">'os'</span>);</span><br><span class="line">      <span class="keyword">const</span> <span class="attr">info</span>: <span class="built_in">any</span> = {</span><br><span class="line">        <span class="attr">platform</span>: os.<span class="title function_">platform</span>(),</span><br><span class="line">        <span class="attr">arch</span>: os.<span class="title function_">arch</span>(),</span><br><span class="line">        <span class="attr">nodeVersion</span>: process.<span class="property">version</span>,</span><br><span class="line">        <span class="attr">memory</span>: {</span><br><span class="line">          <span class="attr">total</span>: <span class="string">`<span class="subst">${<span class="built_in">Math</span>.round(os.totalmem() / <span class="number">1024</span> / <span class="number">1024</span> / <span class="number">1024</span>)}</span> GB`</span>,</span><br><span class="line">          <span class="attr">free</span>: <span class="string">`<span class="subst">${<span class="built_in">Math</span>.round(os.freemem() / <span class="number">1024</span> / <span class="number">1024</span> / <span class="number">1024</span>)}</span> GB`</span>,</span><br><span class="line">          <span class="attr">usage</span>: <span class="string">`<span class="subst">${<span class="built_in">Math</span>.round(((os.totalmem() - os.freemem()) / os.totalmem()) * <span class="number">100</span>)}</span>%`</span></span><br><span class="line">        },</span><br><span class="line">        <span class="attr">cpus</span>: os.<span class="title function_">cpus</span>().<span class="property">length</span></span><br><span class="line">      };</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (args.<span class="property">detail</span> === <span class="string">'full'</span>) {</span><br><span class="line">        info.<span class="property">uptime</span> = <span class="string">`<span class="subst">${<span class="built_in">Math</span>.round(os.uptime() / <span class="number">3600</span>)}</span> hours`</span>;</span><br><span class="line">        info.<span class="property">currentDirectory</span> = process.<span class="title function_">cwd</span>();</span><br><span class="line">        info.<span class="property">userInfo</span> = os.<span class="title function_">userInfo</span>();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">          <span class="keyword">const</span> gitVersion = <span class="title function_">execSync</span>(<span class="string">'git --version'</span>, { <span class="attr">encoding</span>: <span class="string">'utf-8'</span> }).<span class="title function_">trim</span>();</span><br><span class="line">          info.<span class="property">gitVersion</span> = gitVersion;</span><br><span class="line">        } <span class="keyword">catch</span> {</span><br><span class="line">          info.<span class="property">gitVersion</span> = <span class="string">'Not installed'</span>;</span><br><span class="line">        }</span><br><span class="line">      }</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> {</span><br><span class="line">        <span class="attr">content</span>: [{</span><br><span class="line">          <span class="attr">type</span>: <span class="string">'text'</span>,</span><br><span class="line">          <span class="attr">text</span>: <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(info, <span class="literal">null</span>, <span class="number">2</span>)</span><br><span class="line">        }]</span><br><span class="line">      };</span><br><span class="line">    } <span class="keyword">catch</span> (error) {</span><br><span class="line">      <span class="keyword">return</span> {</span><br><span class="line">        <span class="attr">content</span>: [{</span><br><span class="line">          <span class="attr">type</span>: <span class="string">'text'</span>,</span><br><span class="line">          <span class="attr">text</span>: <span class="string">`系统信息获取失败: <span class="subst">${error.message}</span>`</span></span><br><span class="line">        }],</span><br><span class="line">        <span class="attr">isError</span>: <span class="literal">true</span></span><br><span class="line">      };</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 时间工具</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> timeTool = <span class="title function_">tool</span>(</span><br><span class="line">  <span class="string">'get_time_info'</span>,</span><br><span class="line">  <span class="string">'获取当前时间和格式化信息'</span>,</span><br><span class="line">  {</span><br><span class="line">    <span class="attr">timezone</span>: z.<span class="title function_">string</span>().<span class="title function_">default</span>(<span class="string">'local'</span>).<span class="title function_">describe</span>(<span class="string">'时区'</span>),</span><br><span class="line">    <span class="attr">format</span>: z.<span class="title function_">enum</span>([<span class="string">'iso'</span>, <span class="string">'readable'</span>, <span class="string">'timestamp'</span>]).<span class="title function_">default</span>(<span class="string">'readable'</span>).<span class="title function_">describe</span>(<span class="string">'时间格式'</span>)</span><br><span class="line">  },</span><br><span class="line">  <span class="title function_">async</span> (args) =&gt; {</span><br><span class="line">    <span class="keyword">try</span> {</span><br><span class="line">      <span class="keyword">const</span> now = <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line">      <span class="keyword">let</span> <span class="attr">result</span>: <span class="built_in">string</span>;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">switch</span> (args.<span class="property">format</span>) {</span><br><span class="line">        <span class="keyword">case</span> <span class="string">'iso'</span>:</span><br><span class="line">          result = now.<span class="title function_">toISOString</span>();</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">'timestamp'</span>:</span><br><span class="line">          result = now.<span class="title function_">getTime</span>().<span class="title function_">toString</span>();</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">'readable'</span>:</span><br><span class="line">          result = now.<span class="title function_">toLocaleString</span>(<span class="string">'zh-CN'</span>, {</span><br><span class="line">            <span class="attr">year</span>: <span class="string">'numeric'</span>,</span><br><span class="line">            <span class="attr">month</span>: <span class="string">'2-digit'</span>,</span><br><span class="line">            <span class="attr">day</span>: <span class="string">'2-digit'</span>,</span><br><span class="line">            <span class="attr">hour</span>: <span class="string">'2-digit'</span>,</span><br><span class="line">            <span class="attr">minute</span>: <span class="string">'2-digit'</span>,</span><br><span class="line">            <span class="attr">second</span>: <span class="string">'2-digit'</span>,</span><br><span class="line">            <span class="attr">weekday</span>: <span class="string">'long'</span></span><br><span class="line">          });</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">      }</span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> timeInfo = {</span><br><span class="line">        <span class="attr">currentTime</span>: result,</span><br><span class="line">        <span class="attr">timezone</span>: args.<span class="property">timezone</span>,</span><br><span class="line">        <span class="attr">unixTimestamp</span>: now.<span class="title function_">getTime</span>(),</span><br><span class="line">        <span class="attr">dateString</span>: now.<span class="title function_">toDateString</span>(),</span><br><span class="line">        <span class="attr">timeString</span>: now.<span class="title function_">toTimeString</span>()</span><br><span class="line">      };</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> {</span><br><span class="line">        <span class="attr">content</span>: [{</span><br><span class="line">          <span class="attr">type</span>: <span class="string">'text'</span>,</span><br><span class="line">          <span class="attr">text</span>: <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(timeInfo, <span class="literal">null</span>, <span class="number">2</span>)</span><br><span class="line">        }]</span><br><span class="line">      };</span><br><span class="line">    } <span class="keyword">catch</span> (error) {</span><br><span class="line">      <span class="keyword">return</span> {</span><br><span class="line">        <span class="attr">content</span>: [{</span><br><span class="line">          <span class="attr">type</span>: <span class="string">'text'</span>,</span><br><span class="line">          <span class="attr">text</span>: <span class="string">`时间信息获取失败: <span class="subst">${error.message}</span>`</span></span><br><span class="line">        }],</span><br><span class="line">        <span class="attr">isError</span>: <span class="literal">true</span></span><br><span class="line">      };</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">);</span><br></pre></td></tr></tbody></table></figure><h3 id="3-3-创建-MCP-服务器">3.3 创建 MCP 服务器</h3><p>创建 <code>src/tools/index.ts</code>：</p><figure class="highlight typescript"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">// src/tools/index.ts</span></span><br><span class="line"><span class="keyword">import</span> { createSdkMcpServer } <span class="keyword">from</span> <span class="string">'@qwen-code/sdk'</span>;</span><br><span class="line"><span class="keyword">import</span> { fileAnalyzerTool, directoryAnalyzerTool } <span class="keyword">from</span> <span class="string">'./fileTools'</span>;</span><br><span class="line"><span class="keyword">import</span> { systemInfoTool, timeTool } <span class="keyword">from</span> <span class="string">'./systemTools'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建自定义 MCP 服务器</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> demoServer = <span class="title function_">createSdkMcpServer</span>({</span><br><span class="line">  <span class="attr">name</span>: <span class="string">'demo-toolkit'</span>,</span><br><span class="line">  <span class="attr">version</span>: <span class="string">'1.0.0'</span>,</span><br><span class="line">  <span class="attr">tools</span>: [</span><br><span class="line">    fileAnalyzerTool,</span><br><span class="line">    directoryAnalyzerTool,</span><br><span class="line">    systemInfoTool,</span><br><span class="line">    timeTool</span><br><span class="line">  ]</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line"><span class="comment">// 服务器信息</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> serverInfo = {</span><br><span class="line">  <span class="attr">name</span>: <span class="string">'demo-toolkit'</span>,</span><br><span class="line">  <span class="attr">tools</span>: [</span><br><span class="line">    <span class="string">'analyze_file - 文件分析'</span>,</span><br><span class="line">    <span class="string">'analyze_directory - 目录分析'</span>,</span><br><span class="line">    <span class="string">'get_system_info - 系统信息'</span>,</span><br><span class="line">    <span class="string">'get_time_info - 时间信息'</span></span><br><span class="line">  ]</span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure><hr><h2 id="4-完整项目：智能项目分析器">4. 完整项目：智能项目分析器</h2><h3 id="4-1-创建主应用">4.1 创建主应用</h3><p>创建 <code>src/project-analyzer.ts</code>：</p><figure class="highlight typescript"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">// src/project-analyzer.ts</span></span><br><span class="line"><span class="keyword">import</span> { query, createSdkMcpServer } <span class="keyword">from</span> <span class="string">'@qwen-code/sdk'</span>;</span><br><span class="line"><span class="keyword">import</span> { config } <span class="keyword">from</span> <span class="string">'./utils/config'</span>;</span><br><span class="line"><span class="keyword">import</span> { demoServer, serverInfo } <span class="keyword">from</span> <span class="string">'./tools'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">ProjectAnalyzer</span> {</span><br><span class="line">  <span class="keyword">private</span> <span class="attr">mcpServer</span>: <span class="built_in">any</span>;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) {</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">mcpServer</span> = demoServer;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">'🔧 初始化项目分析器...'</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">'📦 可用工具:'</span>, serverInfo.<span class="property">tools</span>.<span class="title function_">join</span>(<span class="string">', '</span>));</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">analyzeProject</span>(<span class="params"><span class="attr">projectPath</span>: <span class="built_in">string</span> = <span class="string">'.'</span></span>) {</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`\n📊 开始分析项目: <span class="subst">${projectPath}</span>\n`</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> prompt = <span class="string">`</span></span><br><span class="line"><span class="string">      请使用自定义工具对当前项目进行全面分析：</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">      1. 首先获取系统信息</span></span><br><span class="line"><span class="string">      2. 分析当前目录结构（深度2级）</span></span><br><span class="line"><span class="string">      3. 如果发现 TypeScript/JavaScript 文件，选择1-2个重要文件进行分析</span></span><br><span class="line"><span class="string">      4. 获取当前时间信息</span></span><br><span class="line"><span class="string">      5. 最后生成一个完整的项目分析报告</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">      请按以下格式输出报告：</span></span><br><span class="line"><span class="string">      ## 项目分析报告</span></span><br><span class="line"><span class="string">      ### 系统环境</span></span><br><span class="line"><span class="string">      ### 项目结构</span></span><br><span class="line"><span class="string">      ### 文件分析</span></span><br><span class="line"><span class="string">      ### 总结和建议</span></span><br><span class="line"><span class="string">    `</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> {</span><br><span class="line">      <span class="keyword">const</span> result = <span class="title function_">query</span>({</span><br><span class="line">        prompt,</span><br><span class="line">        <span class="attr">options</span>: {</span><br><span class="line">          <span class="attr">pathToQwenExecutable</span>: config.<span class="property">qwenPath</span>,</span><br><span class="line">          <span class="attr">cwd</span>: projectPath,</span><br><span class="line">          <span class="attr">mcpServers</span>: {</span><br><span class="line">            <span class="string">'demo-toolkit'</span>: <span class="variable language_">this</span>.<span class="property">mcpServer</span></span><br><span class="line">          },</span><br><span class="line">          <span class="attr">permissionMode</span>: <span class="string">'yolo'</span>,</span><br><span class="line">          <span class="attr">debug</span>: config.<span class="property">debug</span>,</span><br><span class="line">          <span class="attr">maxSessionTurns</span>: <span class="number">10</span>,</span><br><span class="line">          <span class="attr">timeout</span>: {</span><br><span class="line">            <span class="attr">canUseTool</span>: <span class="number">30000</span>,</span><br><span class="line">            <span class="attr">mcpRequest</span>: <span class="number">60000</span>,</span><br><span class="line">            <span class="attr">controlRequest</span>: <span class="number">30000</span></span><br><span class="line">          }</span><br><span class="line">        }</span><br><span class="line">      });</span><br><span class="line"></span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">'🤖 AI 分析过程:'</span>);</span><br><span class="line">      <span class="keyword">let</span> assistantResponse = <span class="string">''</span>;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">for</span> <span class="title function_">await</span> (<span class="keyword">const</span> message <span class="keyword">of</span> result) {</span><br><span class="line">        <span class="keyword">if</span> (message.<span class="property">type</span> === <span class="string">'assistant'</span>) {</span><br><span class="line">          <span class="keyword">const</span> content = message.<span class="property">message</span>.<span class="property">content</span>;</span><br><span class="line">          assistantResponse += content + <span class="string">'\n'</span>;</span><br><span class="line"></span><br><span class="line">          <span class="comment">// 实时显示进度</span></span><br><span class="line">          <span class="keyword">if</span> (content.<span class="title function_">includes</span>(<span class="string">'正在'</span>) || content.<span class="title function_">includes</span>(<span class="string">'分析'</span>) || content.<span class="title function_">includes</span>(<span class="string">'获取'</span>)) {</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">'⏳'</span>, content);</span><br><span class="line">          }</span><br><span class="line">        } <span class="keyword">else</span> <span class="keyword">if</span> (message.<span class="property">type</span> === <span class="string">'result'</span>) {</span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">'\n✅ 分析完成!'</span>);</span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">'\n📋 最终报告:'</span>);</span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">log</span>(message.<span class="property">result</span>);</span><br><span class="line">        }</span><br><span class="line">      }</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> { <span class="attr">success</span>: <span class="literal">true</span>, <span class="attr">report</span>: assistantResponse };</span><br><span class="line">    } <span class="keyword">catch</span> (error) {</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">'❌ 分析失败:'</span>, error.<span class="property">message</span>);</span><br><span class="line">      <span class="keyword">return</span> { <span class="attr">success</span>: <span class="literal">false</span>, <span class="attr">error</span>: error.<span class="property">message</span> };</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">quickScan</span>(<span class="params"><span class="attr">filePath</span>: <span class="built_in">string</span></span>) {</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`\n🔍 快速扫描文件: <span class="subst">${filePath}</span>\n`</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> prompt = <span class="string">`</span></span><br><span class="line"><span class="string">      请快速分析指定的文件：<span class="subst">${filePath}</span></span></span><br><span class="line"><span class="string">      使用文件分析工具获取详细信息，并给出简要评价。</span></span><br><span class="line"><span class="string">    `</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> {</span><br><span class="line">      <span class="keyword">const</span> result = <span class="title function_">query</span>({</span><br><span class="line">        prompt,</span><br><span class="line">        <span class="attr">options</span>: {</span><br><span class="line">          <span class="attr">pathToQwenExecutable</span>: config.<span class="property">qwenPath</span>,</span><br><span class="line">          <span class="attr">mcpServers</span>: {</span><br><span class="line">            <span class="string">'demo-toolkit'</span>: <span class="variable language_">this</span>.<span class="property">mcpServer</span></span><br><span class="line">          },</span><br><span class="line">          <span class="attr">permissionMode</span>: <span class="string">'yolo'</span>,</span><br><span class="line">          <span class="attr">maxSessionTurns</span>: <span class="number">3</span></span><br><span class="line">        }</span><br><span class="line">      });</span><br><span class="line"></span><br><span class="line">      <span class="keyword">for</span> <span class="title function_">await</span> (<span class="keyword">const</span> message <span class="keyword">of</span> result) {</span><br><span class="line">        <span class="keyword">if</span> (message.<span class="property">type</span> === <span class="string">'assistant'</span>) {</span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">'📄 文件分析结果:'</span>);</span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">log</span>(message.<span class="property">message</span>.<span class="property">content</span>);</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        }</span><br><span class="line">      }</span><br><span class="line">    } <span class="keyword">catch</span> (error) {</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">'❌ 扫描失败:'</span>, error.<span class="property">message</span>);</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h3 id="4-2-更新主入口文件">4.2 更新主入口文件</h3><p>更新 <code>src/index.ts</code>：</p><figure class="highlight typescript"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">// src/index.ts</span></span><br><span class="line"><span class="keyword">import</span> { <span class="title class_">ProjectAnalyzer</span> } <span class="keyword">from</span> <span class="string">'./project-analyzer'</span>;</span><br><span class="line"><span class="keyword">import</span> { config } <span class="keyword">from</span> <span class="string">'./utils/config'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">main</span>(<span class="params"></span>) {</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">'🚀 Qwen Code 0.4.0 SDK 完整演示'</span>);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">'================================\n'</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 显示配置信息</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">'⚙️  配置信息:'</span>);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">'   Qwen CLI 路径:'</span>, config.<span class="property">qwenPath</span>);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">'   项目路径:'</span>, config.<span class="property">projectPath</span>);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">'   调试模式:'</span>, config.<span class="property">debug</span>);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">''</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> analyzer = <span class="keyword">new</span> <span class="title class_">ProjectAnalyzer</span>();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 基础测试</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">'1️⃣  基础功能测试'</span>);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">'-----------------'</span>);</span><br><span class="line">  <span class="keyword">await</span> <span class="title function_">basicTest</span>();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 项目分析</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">'\n2️⃣  项目分析演示'</span>);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">'-----------------'</span>);</span><br><span class="line">  <span class="keyword">await</span> analyzer.<span class="title function_">analyzeProject</span>(<span class="string">'./'</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 文件扫描演示</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">'\n3️⃣  文件扫描演示'</span>);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">'-----------------'</span>);</span><br><span class="line">  <span class="keyword">await</span> analyzer.<span class="title function_">quickScan</span>(<span class="string">'./src/index.ts'</span>);</span><br><span class="line"></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">'\n🎉 所有演示完成！'</span>);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">'\n💡 你已经成功体验了 Qwen Code SDK 的主要功能：'</span>);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">'   ✅ 基础查询和对话'</span>);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">'   ✅ 自定义工具开发'</span>);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">'   ✅ MCP 服务器集成'</span>);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">'   ✅ 完整项目构建'</span>);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">'   ✅ 错误处理和配置管理'</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">basicTest</span>(<span class="params"></span>) {</span><br><span class="line">  <span class="keyword">try</span> {</span><br><span class="line">    <span class="keyword">const</span> result = <span class="title function_">query</span>({</span><br><span class="line">      <span class="attr">prompt</span>: <span class="string">'请用一句话说明 Qwen Code SDK 的主要优势'</span>,</span><br><span class="line">      <span class="attr">options</span>: {</span><br><span class="line">        <span class="attr">pathToQwenExecutable</span>: config.<span class="property">qwenPath</span>,</span><br><span class="line">        <span class="attr">permissionMode</span>: <span class="string">'yolo'</span>,</span><br><span class="line">        <span class="attr">maxSessionTurns</span>: <span class="number">1</span></span><br><span class="line">      }</span><br><span class="line">    });</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> <span class="title function_">await</span> (<span class="keyword">const</span> message <span class="keyword">of</span> result) {</span><br><span class="line">      <span class="keyword">if</span> (message.<span class="property">type</span> === <span class="string">'assistant'</span>) {</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">'🤖 AI 回复:'</span>, message.<span class="property">message</span>.<span class="property">content</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line">  } <span class="keyword">catch</span> (error) {</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">'❌ 基础测试失败:'</span>, error.<span class="property">message</span>);</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 运行主程序</span></span><br><span class="line"><span class="title function_">main</span>().<span class="title function_">catch</span>(<span class="variable language_">console</span>.<span class="property">error</span>);</span><br></pre></td></tr></tbody></table></figure><h3 id="4-3-运行完整演示">4.3 运行完整演示</h3><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 确保所有依赖都已安装</span></span><br><span class="line">npm install</span><br><span class="line"></span><br><span class="line"><span class="comment"># 运行完整演示</span></span><br><span class="line">npm run dev</span><br></pre></td></tr></tbody></table></figure><p>你应该看到类似输出：</p><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">🚀 Qwen Code 0.4.0 SDK 完整演示</span><br><span class="line">================================</span><br><span class="line"></span><br><span class="line">⚙️  配置信息:</span><br><span class="line">   Qwen CLI 路径: /home/yourname/.nvm/versions/node/v24.11.1/bin/qwen</span><br><span class="line">   项目路径: /path/to/qwen-sdk-demo</span><br><span class="line">   调试模式: true</span><br><span class="line"></span><br><span class="line">🔧 初始化项目分析器...</span><br><span class="line">📦 可用工具: analyze_file - 文件分析, analyze_directory - 目录分析, get_system_info - 系统信息, get_time_info - 时间信息</span><br><span class="line"></span><br><span class="line">1️⃣  基础功能测试</span><br><span class="line">-----------------</span><br><span class="line">🤖 AI 回复: Qwen Code SDK 提供完整的程序化访问能力，支持自定义工具开发、权限控制和多会话管理，让开发者能将AI能力深度集成到自己的应用中。</span><br><span class="line"></span><br><span class="line">2️⃣  项目分析演示</span><br><span class="line">-----------------</span><br><span class="line">📊 开始分析项目: ./</span><br><span class="line"></span><br><span class="line">🤖 AI 分析过程:</span><br><span class="line">⏳ 正在获取系统信息...</span><br><span class="line">⏳ 开始分析项目目录结构...</span><br><span class="line"></span><br><span class="line">✅ 分析完成!</span><br><span class="line"></span><br><span class="line">📋 最终报告:</span><br><span class="line">## 项目分析报告</span><br><span class="line"></span><br><span class="line">### 系统环境</span><br><span class="line">{</span><br><span class="line">  "platform": "linux",</span><br><span class="line">  "arch": "x64",</span><br><span class="line">  "nodeVersion": "v20.0.0",</span><br><span class="line">  "memory": {</span><br><span class="line">    "total": "16 GB",</span><br><span class="line">    "free": "8 GB",</span><br><span class="line">    "usage": "50%"</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">### 项目结构</span><br><span class="line">{</span><br><span class="line">  "path": "./",</span><br><span class="line">  "fileCount": 8,</span><br><span class="line">  "dirCount": 3,</span><br><span class="line">  "fileTypes": {</span><br><span class="line">    ".ts": 6,</span><br><span class="line">    ".json": 2</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">### 文件分析</span><br><span class="line">分析了 src/index.ts 和 tools/fileTools.ts...</span><br><span class="line"></span><br><span class="line">### 总结和建议</span><br><span class="line">这是一个标准的 TypeScript 项目，结构清晰，建议继续完善...</span><br><span class="line"></span><br><span class="line">3️⃣  文件扫描演示</span><br><span class="line">-----------------</span><br><span class="line">🔍 快速扫描文件: ./src/index.ts</span><br><span class="line"></span><br><span class="line">📄 文件分析结果:</span><br><span class="line">{</span><br><span class="line">  "path": "./src/index.ts",</span><br><span class="line">  "size": "2.45 KB",</span><br><span class="line">  "lines": 85,</span><br><span class="line">  "language": "TypeScript",</span><br><span class="line">  "lastModified": "2025-12-08T16:00:00.000Z"</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">🎉 所有演示完成！</span><br><span class="line"></span><br><span class="line">💡 你已经成功体验了 Qwen Code SDK 的主要功能：</span><br><span class="line">   ✅ 基础查询和对话</span><br><span class="line">   ✅ 自定义工具开发</span><br><span class="line">   ✅ MCP 服务器集成</span><br><span class="line">   ✅ 完整项目构建</span><br><span class="line">   ✅ 错误处理和配置管理</span><br></pre></td></tr></tbody></table></figure><hr><h2 id="5-进阶功能：权限控制">5. 进阶功能：权限控制</h2><h3 id="5-1-创建权限控制示例">5.1 创建权限控制示例</h3><p>创建 <code>src/permission-demo.ts</code>：</p><figure class="highlight typescript"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">// src/permission-demo.ts</span></span><br><span class="line"><span class="keyword">import</span> { query } <span class="keyword">from</span> <span class="string">'@qwen-code/sdk'</span>;</span><br><span class="line"><span class="keyword">import</span> { config } <span class="keyword">from</span> <span class="string">'./utils/config'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">permissionDemo</span>(<span class="params"></span>) {</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">'🔐 权限控制演示\n'</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">try</span> {</span><br><span class="line">    <span class="keyword">const</span> result = <span class="title function_">query</span>({</span><br><span class="line">      <span class="attr">prompt</span>: <span class="string">'请尝试创建一个名为 permission-test.txt 的文件，写入"权限控制测试"内容'</span>,</span><br><span class="line">      <span class="attr">options</span>: {</span><br><span class="line">        <span class="attr">pathToQwenExecutable</span>: config.<span class="property">qwenPath</span>,</span><br><span class="line">        <span class="attr">cwd</span>: config.<span class="property">projectPath</span>,</span><br><span class="line">        <span class="attr">permissionMode</span>: <span class="string">'default'</span>, <span class="comment">// 默认需要权限确认</span></span><br><span class="line">        <span class="attr">canUseTool</span>: <span class="title function_">async</span> (toolName, input, { signal }) =&gt; {</span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`🔍 权限请求: <span class="subst">${toolName}</span>`</span>);</span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`📝 参数:`</span>, <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(input, <span class="literal">null</span>, <span class="number">2</span>));</span><br><span class="line"></span><br><span class="line">          <span class="comment">// 自定义权限逻辑</span></span><br><span class="line">          <span class="keyword">if</span> (toolName === <span class="string">'write_file'</span>) {</span><br><span class="line">            <span class="keyword">const</span> filepath = input.<span class="property">filepath</span> || input.<span class="property">path</span>;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 禁止写入系统目录</span></span><br><span class="line">            <span class="keyword">if</span> (filepath.<span class="title function_">includes</span>(<span class="string">'/etc/'</span>) || filepath.<span class="title function_">includes</span>(<span class="string">'/usr/'</span>)) {</span><br><span class="line">              <span class="keyword">return</span> {</span><br><span class="line">                <span class="attr">behavior</span>: <span class="string">'deny'</span>,</span><br><span class="line">                <span class="attr">message</span>: <span class="string">'禁止写入系统目录'</span></span><br><span class="line">              };</span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 检查文件扩展名</span></span><br><span class="line">            <span class="keyword">const</span> allowedExtensions = [<span class="string">'.txt'</span>, <span class="string">'.md'</span>, <span class="string">'.json'</span>, <span class="string">'.ts'</span>, <span class="string">'.js'</span>];</span><br><span class="line">            <span class="keyword">const</span> ext = filepath.<span class="title function_">substring</span>(filepath.<span class="title function_">lastIndexOf</span>(<span class="string">'.'</span>));</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (!allowedExtensions.<span class="title function_">includes</span>(ext)) {</span><br><span class="line">              <span class="keyword">return</span> {</span><br><span class="line">                <span class="attr">behavior</span>: <span class="string">'deny'</span>,</span><br><span class="line">                <span class="attr">message</span>: <span class="string">`不支持的文件类型: <span class="subst">${ext}</span>`</span></span><br><span class="line">              };</span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">'✅ 权限已批准'</span>);</span><br><span class="line">            <span class="keyword">return</span> { <span class="attr">behavior</span>: <span class="string">'allow'</span>, <span class="attr">updatedInput</span>: input };</span><br><span class="line">          }</span><br><span class="line"></span><br><span class="line">          <span class="comment">// 读取操作默认允许</span></span><br><span class="line">          <span class="keyword">if</span> (toolName.<span class="title function_">startsWith</span>(<span class="string">'read_'</span>)) {</span><br><span class="line">            <span class="keyword">return</span> { <span class="attr">behavior</span>: <span class="string">'allow'</span>, <span class="attr">updatedInput</span>: input };</span><br><span class="line">          }</span><br><span class="line"></span><br><span class="line">          <span class="comment">// 其他工具需要询问（实际应用中可以弹出确认对话框）</span></span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">'⚠️  需要用户确认:'</span>, toolName);</span><br><span class="line">          <span class="keyword">return</span> {</span><br><span class="line">            <span class="attr">behavior</span>: <span class="string">'allow'</span>,</span><br><span class="line">            <span class="attr">updatedInput</span>: input <span class="comment">// 演示中直接允许</span></span><br><span class="line">          };</span><br><span class="line">        }</span><br><span class="line">      }</span><br><span class="line">    });</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> <span class="title function_">await</span> (<span class="keyword">const</span> message <span class="keyword">of</span> result) {</span><br><span class="line">      <span class="keyword">if</span> (message.<span class="property">type</span> === <span class="string">'assistant'</span>) {</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">'🤖 AI 操作结果:'</span>);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(message.<span class="property">message</span>.<span class="property">content</span>);</span><br><span class="line">      } <span class="keyword">else</span> <span class="keyword">if</span> (message.<span class="property">type</span> === <span class="string">'system'</span> &amp;&amp; message.<span class="property">data</span>?.<span class="property">permission_denials</span>) {</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">'🚫 权限拒绝:'</span>, message.<span class="property">data</span>.<span class="property">permission_denials</span>);</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line">  } <span class="keyword">catch</span> (error) {</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">'❌ 权限演示失败:'</span>, error.<span class="property">message</span>);</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果直接运行此文件</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">import</span>.<span class="property">meta</span>.<span class="property">url</span> === <span class="string">`file://<span class="subst">${process.argv[<span class="number">1</span>]}</span>`</span>) {</span><br><span class="line">  <span class="title function_">permissionDemo</span>();</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h3 id="5-2-运行权限控制演示">5.2 运行权限控制演示</h3><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 创建运行脚本</span></span><br><span class="line">npx tsx src/permission-demo.ts</span><br></pre></td></tr></tbody></table></figure><hr><h2 id="6-项目部署和打包">6. 项目部署和打包</h2><h3 id="6-1-构建项目">6.1 构建项目</h3><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 构建 TypeScript</span></span><br><span class="line">npm run build</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看构建结果</span></span><br><span class="line"><span class="built_in">ls</span> -la dist/</span><br></pre></td></tr></tbody></table></figure><h3 id="6-2-创建可执行脚本">6.2 创建可执行脚本</h3><p>创建 <code>scripts/run-analyzer.mjs</code>：</p><figure class="highlight javascript"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">// scripts/run-analyzer.mjs</span></span><br><span class="line"><span class="keyword">import</span> { <span class="title class_">ProjectAnalyzer</span> } <span class="keyword">from</span> <span class="string">'../dist/project-analyzer.js'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> analyzer = <span class="keyword">new</span> <span class="title class_">ProjectAnalyzer</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取命令行参数</span></span><br><span class="line"><span class="keyword">const</span> projectPath = process.<span class="property">argv</span>[<span class="number">2</span>] || <span class="string">'.'</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">'🔍 Qwen Code 项目分析器'</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">'========================\n'</span>);</span><br><span class="line"></span><br><span class="line">analyzer.<span class="title function_">analyzeProject</span>(projectPath);</span><br></pre></td></tr></tbody></table></figure><h3 id="6-3-创建使用说明">6.3 创建使用说明</h3><p>创建 <code>README.md</code>：</p><figure class="highlight markdown"><table><tbody><tr><td class="code"><pre><span class="line"><span class="section"># Qwen Code SDK 演示项目</span></span><br><span class="line"></span><br><span class="line">这是一个完整的 Qwen Code 0.4.0 TypeScript SDK 演示项目。</span><br><span class="line"></span><br><span class="line"><span class="section">## 快速开始</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">1.</span> 安装依赖：</span><br><span class="line">   <span class="code">```bash</span></span><br><span class="line"><span class="code">   npm install</span></span><br></pre></td></tr></tbody></table></figure><ol start="2"><li><p>配置环境变量：</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 编辑 .env 文件</span></span><br><span class="line">nano .<span class="built_in">env</span></span><br><span class="line"><span class="comment"># 添加你的 qwen CLI 路径</span></span><br><span class="line">QWEN_CODE_CLI_PATH=/path/to/your/qwen</span><br></pre></td></tr></tbody></table></figure></li><li><p>运行演示：</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">npm run dev</span><br></pre></td></tr></tbody></table></figure></li></ol><h2 id="功能特性">功能特性</h2><ul><li>✅ 基础查询和对话</li><li>✅ 自定义工具开发</li><li>✅ MCP 服务器集成</li><li>✅ 权限控制系统</li><li>✅ 项目分析功能</li><li>✅ 错误处理和配置管理</li></ul><h2 id="使用示例">使用示例</h2><h3 id="基础查询">基础查询</h3><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">npx tsx src/index.ts</span><br></pre></td></tr></tbody></table></figure><h3 id="项目分析">项目分析</h3><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">npx tsx src/project-analyzer.ts</span><br></pre></td></tr></tbody></table></figure><h3 id="权限控制演示">权限控制演示</h3><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">npx tsx src/permission-demo.ts</span><br></pre></td></tr></tbody></table></figure><h2 id="项目结构">项目结构</h2><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">qwen-sdk-demo/</span><br><span class="line">├── src/</span><br><span class="line">│   ├── index.ts           # 主入口</span><br><span class="line">│   ├── project-analyzer.ts # 项目分析器</span><br><span class="line">│   ├── permission-demo.ts   # 权限控制演示</span><br><span class="line">│   ├── tools/             # 自定义工具</span><br><span class="line">│   │   ├── fileTools.ts    # 文件相关工具</span><br><span class="line">│   │   ├── systemTools.ts  # 系统相关工具</span><br><span class="line">│   │   └── index.ts        # 工具导出</span><br><span class="line">│   └── utils/</span><br><span class="line">│       └── config.ts       # 配置管理</span><br><span class="line">├── scripts/               # 运行脚本</span><br><span class="line">├── dist/                  # 构建输出</span><br><span class="line">└── package.json</span><br></pre></td></tr></tbody></table></figure><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line"></span><br><span class="line">---</span><br><span class="line"></span><br><span class="line">## 7. 常见问题解决</span><br><span class="line"></span><br><span class="line">### 7.1 路径问题</span><br><span class="line"></span><br><span class="line">如果遇到 "qwen CLI not found" 错误：</span><br><span class="line"></span><br><span class="line">```bash</span><br><span class="line"># 查找 qwen 路径</span><br><span class="line">which qwen</span><br><span class="line"></span><br><span class="line"># 更新 .env 文件</span><br><span class="line">echo "QWEN_CODE_CLI_PATH=$(which qwen)" &gt;&gt; .env</span><br><span class="line"></span><br><span class="line"># 或者设置环境变量</span><br><span class="line">export QWEN_CODE_CLI_PATH=$(which qwen)</span><br></pre></td></tr></tbody></table></figure><h3 id="7-2-权限问题">7.2 权限问题</h3><p>如果遇到权限错误：</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 确保 qwen 有执行权限</span></span><br><span class="line"><span class="built_in">chmod</span> +x $(<span class="built_in">which</span> qwen)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果需要 sudo 安装</span></span><br><span class="line"><span class="built_in">sudo</span> npm install -g @qwen-code/qwen-code</span><br></pre></td></tr></tbody></table></figure><h3 id="7-3-认证问题">7.3 认证问题</h3><p>如果遇到认证错误：</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 重新认证</span></span><br><span class="line">qwen</span><br><span class="line"></span><br><span class="line"><span class="comment"># 或者使用 OpenAI 兼容模式</span></span><br><span class="line"><span class="built_in">export</span> OPENAI_API_KEY=<span class="string">"your-api-key"</span></span><br><span class="line"><span class="built_in">export</span> OPENAI_BASE_URL=<span class="string">"https://dashscope.aliyuncs.com/compatible-mode/v1"</span></span><br></pre></td></tr></tbody></table></figure><h3 id="7-4-调试模式">7.4 调试模式</h3><p>启用调试模式查看详细日志：</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 设置环境变量</span></span><br><span class="line"><span class="built_in">export</span> NODE_ENV=development</span><br><span class="line"></span><br><span class="line"><span class="comment"># 或者在代码中设置 debug: true</span></span><br></pre></td></tr></tbody></table></figure><hr><h2 id="8-总结">8. 总结</h2><p>通过这个完整的实战项目，你已经体验了 Qwen Code 0.4.0 TypeScript SDK 的所有核心功能：</p><h3 id="🎯-核心能力">🎯 核心能力</h3><ul><li><strong>程序化访问</strong>: 通过 SDK 完全控制 Qwen Code</li><li><strong>自定义工具</strong>: 创建满足特定需求的 AI 工具</li><li><strong>权限控制</strong>: 精细控制 AI 的操作权限</li><li><strong>错误处理</strong>: 完善的错误处理和恢复机制</li></ul><h3 id="🚀-应用场景">🚀 应用场景</h3><ul><li><strong>IDE 插件</strong>: 集成到 VS Code、JetBrains 等</li><li><strong>CI/CD 集成</strong>: 自动化代码审查和测试</li><li><strong>文档生成</strong>: 自动生成技术文档</li><li><strong>代码迁移</strong>: 智能代码重构和迁移</li></ul><p><strong>Qwen Code 0.4.0 SDK 不仅仅是一个工具，它是 AI 编程助手的新纪元。现在，你可以将 AI 能力嵌入到任何应用中，创造出前所未有的开发体验！</strong></p>]]></content>
      
      
      <categories>
          
          <category> 技术实践 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> AI </tag>
            
            <tag> TypeScript </tag>
            
            <tag> Qwen </tag>
            
            <tag> SDK </tag>
            
            <tag> 开发工具 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Markdown语法完整指南</title>
      <link href="/2025/12/08/0006-markdown-yu-fa-wan-zheng-zhi-nan/"/>
      <url>/2025/12/08/0006-markdown-yu-fa-wan-zheng-zhi-nan/</url>
      
        <content type="html"><![CDATA[<h1>Markdown 语法完整指南</h1><p>这是一个完整的Markdown语法参考指南，展示了在Hexo博客中可以使用的各种Markdown元素和扩展功能。</p><h2 id="📝-文本格式">📝 文本格式</h2><h3 id="基础格式">基础格式</h3><figure class="highlight markdown"><table><tbody><tr><td class="code"><pre><span class="line"><span class="strong">**粗体文本**</span></span><br><span class="line"><span class="emphasis">*斜体文本*</span></span><br><span class="line"><span class="strong">**<span class="emphasis">*粗斜体文本*</span>**</span></span><br><span class="line">~~删除线文本~~</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">u</span>&gt;</span></span>下划线文本<span class="language-xml"><span class="tag">&lt;/<span class="name">u</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">mark</span>&gt;</span></span>高亮文本<span class="language-xml"><span class="tag">&lt;/<span class="name">mark</span>&gt;</span></span></span><br></pre></td></tr></tbody></table></figure><p><strong>效果展示</strong>：<br><strong>粗体文本</strong><br><em>斜体文本</em><br><em><strong>粗斜体文本</strong></em><br><s>删除线文本</s><br><u>下划线文本</u><br><mark>高亮文本</mark></p><h3 id="引用">引用</h3><figure class="highlight markdown"><table><tbody><tr><td class="code"><pre><span class="line"><span class="quote">&gt; 这是一级引用</span></span><br><span class="line">&gt;&gt; 这是二级引用</span><br><span class="line">&gt;&gt;&gt; 这是三级引用</span><br></pre></td></tr></tbody></table></figure><p><strong>效果展示</strong>：</p><blockquote><p>这是一级引用</p><blockquote><p>这是二级引用</p><blockquote><p>这是三级引用</p></blockquote></blockquote></blockquote><h2 id="📋-列表">📋 列表</h2><h3 id="无序列表">无序列表</h3><figure class="highlight markdown"><table><tbody><tr><td class="code"><pre><span class="line"><span class="bullet">-</span> 项目一</span><br><span class="line"><span class="bullet">  -</span> 子项目1.1</span><br><span class="line"><span class="bullet">    -</span> 子项目1.1.1</span><br><span class="line"><span class="bullet">  -</span> 子项目1.2</span><br><span class="line"><span class="bullet">-</span> 项目二</span><br><span class="line"><span class="bullet">*</span> 项目三</span><br></pre></td></tr></tbody></table></figure><p><strong>效果展示</strong>：</p><ul><li>项目一<ul><li>子项目1.1<ul><li>子项目1.1.1</li></ul></li><li>子项目1.2</li></ul></li><li>项目二</li></ul><ul><li>项目三</li></ul><h3 id="有序列表">有序列表</h3><figure class="highlight markdown"><table><tbody><tr><td class="code"><pre><span class="line"><span class="bullet">1.</span> 第一项</span><br><span class="line"><span class="bullet">2.</span> 第二项</span><br><span class="line"><span class="bullet">   1.</span> 子项2.1</span><br><span class="line"><span class="bullet">   2.</span> 子项2.2</span><br><span class="line"><span class="bullet">3.</span> 第三项</span><br></pre></td></tr></tbody></table></figure><p><strong>效果展示</strong>：</p><ol><li>第一项</li><li>第二项<ol><li>子项2.1</li><li>子项2.2</li></ol></li><li>第三项</li></ol><h3 id="任务列表">任务列表</h3><figure class="highlight markdown"><table><tbody><tr><td class="code"><pre><span class="line"><span class="bullet">-</span> [x] 已完成的任务</span><br><span class="line"><span class="bullet">-</span> [ ] 待完成的任务</span><br><span class="line"><span class="bullet">-</span> [x] 另一个完成的任务</span><br></pre></td></tr></tbody></table></figure><p><strong>效果展示</strong>：</p><ul><li>[x] 已完成的任务</li><li>[ ] 待完成的任务</li><li>[x] 另一个完成的任务</li></ul><h2 id="🔗-链接和图片">🔗 链接和图片</h2><h3 id="链接">链接</h3><figure class="highlight markdown"><table><tbody><tr><td class="code"><pre><span class="line">[<span class="string">内联链接</span>](<span class="link">https://hexo.io</span>)</span><br><span class="line">[<span class="string">引用链接</span>][<span class="symbol">1</span>]</span><br><span class="line">[<span class="string">邮箱链接</span>](<span class="link">mailto:example@email.com</span>)</span><br><span class="line"></span><br><span class="line">[<span class="symbol">1</span>]: <span class="link">https://hexo.io</span></span><br></pre></td></tr></tbody></table></figure><p><strong>效果展示</strong>：<br><a href="https://hexo.io">内联链接</a><br><a href="https://hexo.io">引用链接</a><br><a href="mailto:example@email.com">邮箱链接</a></p><h3 id="图片">图片</h3><figure class="highlight markdown"><table><tbody><tr><td class="code"><pre><span class="line">![<span class="string">替代文本</span>](<span class="link">https://hexo.io/logo.svg "Hexo Logo"</span>)</span><br></pre></td></tr></tbody></table></figure><p><strong>效果展示</strong>：<br><img src="https://hexo.io/logo.svg" alt="Hexo Logo" title="Hexo Logo"></p><h2 id="📊-表格">📊 表格</h2><h3 id="基础表格">基础表格</h3><figure class="highlight markdown"><table><tbody><tr><td class="code"><pre><span class="line">| 列1 | 列2 | 列3 |</span><br><span class="line">|-----|-----|-----|</span><br><span class="line">| 数据1 | 数据2 | 数据3 |</span><br><span class="line">| 数据4 | 数据5 | 数据6 |</span><br></pre></td></tr></tbody></table></figure><h3 id="对齐表格">对齐表格</h3><figure class="highlight markdown"><table><tbody><tr><td class="code"><pre><span class="line">| 左对齐 | 居中对齐 | 右对齐 |</span><br><span class="line">|:-------|:-------:|-------:|</span><br><span class="line">| 内容1 | 内容2 | 内容3 |</span><br><span class="line">| 长内容 | 短 | 很长的内容 |</span><br></pre></td></tr></tbody></table></figure><p><strong>效果展示</strong>：</p><table><thead><tr><th style="text-align:left">左对齐</th><th style="text-align:center">居中对齐</th><th style="text-align:right">右对齐</th></tr></thead><tbody><tr><td style="text-align:left">内容1</td><td style="text-align:center">内容2</td><td style="text-align:right">内容3</td></tr><tr><td style="text-align:left">长内容</td><td style="text-align:center">短</td><td style="text-align:right">很长的内容</td></tr></tbody></table><h2 id="🎨-代码高亮">🎨 代码高亮</h2><h3 id="行内代码">行内代码</h3><figure class="highlight markdown"><table><tbody><tr><td class="code"><pre><span class="line">这是一段行内代码：<span class="code">`console.log('Hello World')`</span></span><br></pre></td></tr></tbody></table></figure><p><strong>效果展示</strong>：<br>这是一段行内代码：<code>console.log('Hello World')</code></p><h3 id="代码块">代码块</h3><h4 id="Bash-Shell">Bash/Shell</h4><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"Hello Hexo Blog!"</span></span><br><span class="line"><span class="comment"># 创建新文章</span></span><br><span class="line">hexo new post <span class="string">"文章标题"</span></span><br><span class="line"><span class="comment"># 启动开发服务器</span></span><br><span class="line">hexo server</span><br></pre></td></tr></tbody></table></figure><h4 id="Python">Python</h4><figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建数据</span></span><br><span class="line">x = np.linspace(<span class="number">0</span>, <span class="number">10</span>, <span class="number">100</span>)</span><br><span class="line">y = np.sin(x)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 绘制图表</span></span><br><span class="line">plt.figure(figsize=(<span class="number">10</span>, <span class="number">6</span>))</span><br><span class="line">plt.plot(x, y, label=<span class="string">'sin(x)'</span>, linewidth=<span class="number">2</span>)</span><br><span class="line">plt.xlabel(<span class="string">'x'</span>)</span><br><span class="line">plt.ylabel(<span class="string">'y'</span>)</span><br><span class="line">plt.title(<span class="string">'正弦函数图表'</span>)</span><br><span class="line">plt.legend()</span><br><span class="line">plt.grid(<span class="literal">True</span>, alpha=<span class="number">0.3</span>)</span><br><span class="line">plt.show()</span><br></pre></td></tr></tbody></table></figure><h4 id="JavaScript-Node-js">JavaScript/Node.js</h4><figure class="highlight javascript"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">// 异步函数示例</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BlogManager</span> {</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span>) {</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">posts</span> = [];</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">categories</span> = <span class="keyword">new</span> <span class="title class_">Set</span>();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">fetchPosts</span>(<span class="params"></span>) {</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="string">'/api/posts'</span>);</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">posts</span> = <span class="keyword">await</span> response.<span class="title function_">json</span>();</span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">posts</span>;</span><br><span class="line">        } <span class="keyword">catch</span> (error) {</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">'获取文章失败:'</span>, error);</span><br><span class="line">            <span class="keyword">throw</span> error;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="title function_">filterByCategory</span>(<span class="params">category</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">posts</span>.<span class="title function_">filter</span>(<span class="function"><span class="params">post</span> =&gt;</span></span><br><span class="line">            post.<span class="property">categories</span>.<span class="title function_">includes</span>(category)</span><br><span class="line">        );</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">createPost</span>(<span class="params">postData</span>) {</span><br><span class="line">        <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="string">'/api/posts'</span>, {</span><br><span class="line">            <span class="attr">method</span>: <span class="string">'POST'</span>,</span><br><span class="line">            <span class="attr">headers</span>: {</span><br><span class="line">                <span class="string">'Content-Type'</span>: <span class="string">'application/json'</span>,</span><br><span class="line">            },</span><br><span class="line">            <span class="attr">body</span>: <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(postData)</span><br><span class="line">        });</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!response.<span class="property">ok</span>) {</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">'创建文章失败'</span>);</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> response.<span class="title function_">json</span>();</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用示例</span></span><br><span class="line"><span class="keyword">const</span> blog = <span class="keyword">new</span> <span class="title class_">BlogManager</span>();</span><br><span class="line">blog.<span class="title function_">fetchPosts</span>()</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function"><span class="params">posts</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`获取到 <span class="subst">${posts.length}</span> 篇文章`</span>))</span><br><span class="line">    .<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">error</span>(error));</span><br></pre></td></tr></tbody></table></figure><h4 id="YAML配置文件">YAML配置文件</h4><figure class="highlight yaml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># Kubernetes Deployment 配置</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">blog-deployment</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">blog</span></span><br><span class="line">    <span class="attr">version:</span> <span class="string">v1.0</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">3</span></span><br><span class="line">  <span class="attr">strategy:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">RollingUpdate</span></span><br><span class="line">    <span class="attr">rollingUpdate:</span></span><br><span class="line">      <span class="attr">maxSurge:</span> <span class="number">1</span></span><br><span class="line">      <span class="attr">maxUnavailable:</span> <span class="number">0</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">blog</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">blog</span></span><br><span class="line">        <span class="attr">version:</span> <span class="string">v1.0</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">blog-container</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">myblog:latest</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">80</span></span><br><span class="line">          <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">        <span class="attr">env:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">NODE_ENV</span></span><br><span class="line">          <span class="attr">value:</span> <span class="string">"production"</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">PORT</span></span><br><span class="line">          <span class="attr">value:</span> <span class="string">"80"</span></span><br><span class="line">        <span class="attr">resources:</span></span><br><span class="line">          <span class="attr">requests:</span></span><br><span class="line">            <span class="attr">memory:</span> <span class="string">"256Mi"</span></span><br><span class="line">            <span class="attr">cpu:</span> <span class="string">"250m"</span></span><br><span class="line">          <span class="attr">limits:</span></span><br><span class="line">            <span class="attr">memory:</span> <span class="string">"512Mi"</span></span><br><span class="line">            <span class="attr">cpu:</span> <span class="string">"500m"</span></span><br><span class="line">        <span class="attr">livenessProbe:</span></span><br><span class="line">          <span class="attr">httpGet:</span></span><br><span class="line">            <span class="attr">path:</span> <span class="string">/health</span></span><br><span class="line">            <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line">          <span class="attr">initialDelaySeconds:</span> <span class="number">30</span></span><br><span class="line">          <span class="attr">periodSeconds:</span> <span class="number">10</span></span><br><span class="line">        <span class="attr">readinessProbe:</span></span><br><span class="line">          <span class="attr">httpGet:</span></span><br><span class="line">            <span class="attr">path:</span> <span class="string">/ready</span></span><br><span class="line">            <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line">          <span class="attr">initialDelaySeconds:</span> <span class="number">5</span></span><br><span class="line">          <span class="attr">periodSeconds:</span> <span class="number">5</span></span><br></pre></td></tr></tbody></table></figure><h4 id="SQL查询示例">SQL查询示例</h4><figure class="highlight sql"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">-- 复杂的数据库查询示例</span></span><br><span class="line"><span class="keyword">WITH</span> post_stats <span class="keyword">AS</span> (</span><br><span class="line">    <span class="keyword">SELECT</span></span><br><span class="line">        p.id,</span><br><span class="line">        p.title,</span><br><span class="line">        p.created_at,</span><br><span class="line">        <span class="built_in">COUNT</span>(c.id) <span class="keyword">as</span> comment_count,</span><br><span class="line">        <span class="built_in">AVG</span>(r.rating) <span class="keyword">as</span> avg_rating,</span><br><span class="line">        <span class="built_in">COUNT</span>(<span class="keyword">DISTINCT</span> v.id) <span class="keyword">as</span> view_count</span><br><span class="line">    <span class="keyword">FROM</span> posts p</span><br><span class="line">    <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> comments c <span class="keyword">ON</span> p.id <span class="operator">=</span> c.post_id</span><br><span class="line">    <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> ratings r <span class="keyword">ON</span> p.id <span class="operator">=</span> r.post_id</span><br><span class="line">    <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> page_views v <span class="keyword">ON</span> p.id <span class="operator">=</span> v.post_id</span><br><span class="line">    <span class="keyword">WHERE</span> p.status <span class="operator">=</span> <span class="string">'published'</span></span><br><span class="line">        <span class="keyword">AND</span> p.created_at <span class="operator">&gt;=</span> <span class="string">'2024-01-01'</span></span><br><span class="line">    <span class="keyword">GROUP</span> <span class="keyword">BY</span> p.id, p.title, p.created_at</span><br><span class="line">),</span><br><span class="line">category_ranking <span class="keyword">AS</span> (</span><br><span class="line">    <span class="keyword">SELECT</span></span><br><span class="line">        pc.post_id,</span><br><span class="line">        c.name <span class="keyword">as</span> category_name,</span><br><span class="line">        <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">OVER</span> (<span class="keyword">PARTITION</span> <span class="keyword">BY</span> c.name) <span class="keyword">as</span> posts_in_category</span><br><span class="line">    <span class="keyword">FROM</span> post_categories pc</span><br><span class="line">    <span class="keyword">JOIN</span> categories c <span class="keyword">ON</span> pc.category_id <span class="operator">=</span> c.id</span><br><span class="line">)</span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    ps.title,</span><br><span class="line">    ps.created_at,</span><br><span class="line">    ps.comment_count,</span><br><span class="line">    ps.avg_rating,</span><br><span class="line">    ps.view_count,</span><br><span class="line">    cr.category_name,</span><br><span class="line">    cr.posts_in_category,</span><br><span class="line">    <span class="built_in">ROW_NUMBER</span>() <span class="keyword">OVER</span> (<span class="keyword">ORDER</span> <span class="keyword">BY</span> ps.view_count <span class="keyword">DESC</span>, ps.avg_rating <span class="keyword">DESC</span>) <span class="keyword">as</span> popularity_rank</span><br><span class="line"><span class="keyword">FROM</span> post_stats ps</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> category_ranking cr <span class="keyword">ON</span> ps.id <span class="operator">=</span> cr.post_id</span><br><span class="line"><span class="keyword">WHERE</span> ps.comment_count <span class="operator">&gt;</span> <span class="number">0</span> <span class="keyword">OR</span> ps.avg_rating <span class="keyword">IS</span> <span class="keyword">NOT NULL</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> popularity_rank</span><br><span class="line">LIMIT <span class="number">20</span>;</span><br></pre></td></tr></tbody></table></figure><h2 id="📈-Mermaid-图表">📈 Mermaid 图表</h2><p>本博客支持Mermaid图表，可以创建流程图、时序图、甘特图等多种图表。</p><h3 id="流程图">流程图</h3><figure class="highlight markdown"><table><tbody><tr><td class="code"><pre><span class="line">{% mermaid %}</span><br><span class="line">graph TD</span><br><span class="line"><span class="code">    A[开始] --&gt; B{编写Markdown}</span></span><br><span class="line"><span class="code">    B --&gt;|完成| C[预览效果]</span></span><br><span class="line"><span class="code">    B --&gt;|继续编辑| D[修改内容]</span></span><br><span class="line"><span class="code">    D --&gt; B</span></span><br><span class="line"><span class="code">    C --&gt; E{满意?}</span></span><br><span class="line"><span class="code">    E --&gt;|是| F[发布文章]</span></span><br><span class="line"><span class="code">    E --&gt;|否| D</span></span><br><span class="line"><span class="code">    F --&gt; G[结束]</span></span><br><span class="line"><span class="code">{% endmermaid %}</span></span><br></pre></td></tr></tbody></table></figure><p><strong>效果展示</strong>：</p><div class="mermaid">  graph TD    A[开始] --&gt; B{编写Markdown}    B --&gt;|完成| C[预览效果]    B --&gt;|继续编辑| D[修改内容]    D --&gt; B    C --&gt; E{满意?}    E --&gt;|是| F[发布文章]    E --&gt;|否| D    F --&gt; G[结束]</div><h3 id="时序图">时序图</h3><figure class="highlight markdown"><table><tbody><tr><td class="code"><pre><span class="line">{% mermaid %}</span><br><span class="line">sequenceDiagram</span><br><span class="line"><span class="code">    participant U as 用户</span></span><br><span class="line"><span class="code">    participant B as 博客系统</span></span><br><span class="line"><span class="code">    participant D as 数据库</span></span><br><span class="line"><span class="code">    participant C as CDN</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code">    U-&gt;&gt;B: 访问文章页面</span></span><br><span class="line"><span class="code">    B-&gt;&gt;D: 查询文章内容</span></span><br><span class="line"><span class="code">    D--&gt;&gt;B: 返回Markdown数据</span></span><br><span class="line"><span class="code">    B-&gt;&gt;B: 解析Markdown内容</span></span><br><span class="line"><span class="code">    B-&gt;&gt;C: 获取静态资源</span></span><br><span class="line"><span class="code">    C--&gt;&gt;B: 返回CSS/JS</span></span><br><span class="line"><span class="code">    B--&gt;&gt;U: 渲染完整页面</span></span><br><span class="line"><span class="code">    U-&gt;&gt;B: 互动操作（点赞、评论）</span></span><br><span class="line"><span class="code">    B-&gt;&gt;D: 更新数据库</span></span><br><span class="line"><span class="code">    D--&gt;&gt;B: 确认更新</span></span><br><span class="line"><span class="code">    B--&gt;&gt;U: 更新页面显示</span></span><br><span class="line"><span class="code">{% endmermaid %}</span></span><br></pre></td></tr></tbody></table></figure><p><strong>效果展示</strong>：</p><div class="mermaid">  sequenceDiagram    participant U as 用户    participant B as 博客系统    participant D as 数据库    participant C as CDN    U-&gt;&gt;B: 访问文章页面    B-&gt;&gt;D: 查询文章内容    D--&gt;&gt;B: 返回Markdown数据    B-&gt;&gt;B: 解析Markdown内容    B-&gt;&gt;C: 获取静态资源    C--&gt;&gt;B: 返回CSS/JS    B--&gt;&gt;U: 渲染完整页面    U-&gt;&gt;B: 互动操作（点赞、评论）    B-&gt;&gt;D: 更新数据库    D--&gt;&gt;B: 确认更新    B--&gt;&gt;U: 更新页面显示</div><h3 id="类图">类图</h3><figure class="highlight markdown"><table><tbody><tr><td class="code"><pre><span class="line">{% mermaid %}</span><br><span class="line">classDiagram</span><br><span class="line"><span class="code">    class Post {</span></span><br><span class="line"><span class="code">        +String id</span></span><br><span class="line"><span class="code">        +String title</span></span><br><span class="line"><span class="code">        +String content</span></span><br><span class="line"><span class="code">        +Date createdAt</span></span><br><span class="line"><span class="code">        +Date updatedAt</span></span><br><span class="line"><span class="code">        +Array~String~ tags</span></span><br><span class="line"><span class="code">        +String status</span></span><br><span class="line"><span class="code">        +save() Boolean</span></span><br><span class="line"><span class="code">        +publish() Boolean</span></span><br><span class="line"><span class="code">        +archive() Boolean</span></span><br><span class="line"><span class="code">        +addTag(String tag) void</span></span><br><span class="line"><span class="code">    }</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code">    class Category {</span></span><br><span class="line"><span class="code">        +String id</span></span><br><span class="line"><span class="code">        +String name</span></span><br><span class="line"><span class="code">        +String description</span></span><br><span class="line"><span class="code">        +String slug</span></span><br><span class="line"><span class="code">        +Array~Post~ posts</span></span><br><span class="line"><span class="code">        +addPost(Post post) void</span></span><br><span class="line"><span class="code">        +removePost(Post post) void</span></span><br><span class="line"><span class="code">        +getPostCount() Number</span></span><br><span class="line"><span class="code">    }</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code">    class User {</span></span><br><span class="line"><span class="code">        +String id</span></span><br><span class="line"><span class="code">        +String username</span></span><br><span class="line"><span class="code">        +String email</span></span><br><span class="line"><span class="code">        +Array~Post~ posts</span></span><br><span class="line"><span class="code">        +Date lastLoginAt</span></span><br><span class="line"><span class="code">        +createPost(PostData data) Post</span></span><br><span class="line"><span class="code">        +editPost(String postId, PostData data) Post</span></span><br><span class="line"><span class="code">        +deletePost(String postId) Boolean</span></span><br><span class="line"><span class="code">    }</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code">    User "1" -- "*" Post : creates &gt;</span></span><br><span class="line"><span class="code">    Post "*" -- "1" Category : belongs to &gt;</span></span><br><span class="line"><span class="code">{% endmermaid %}</span></span><br></pre></td></tr></tbody></table></figure><p><strong>效果展示</strong>：</p><div class="mermaid">  classDiagram    class Post {        +String id        +String title        +String content        +Date createdAt        +Date updatedAt        +Array~String~ tags        +String status        +save() Boolean        +publish() Boolean        +archive() Boolean        +addTag(String tag) void    }    class Category {        +String id        +String name        +String description        +String slug        +Array~Post~ posts        +addPost(Post post) void        +removePost(Post post) void        +getPostCount() Number    }    class User {        +String id        +String username        +String email        +Array~Post~ posts        +Date lastLoginAt        +createPost(PostData data) Post        +editPost(String postId, PostData data) Post        +deletePost(String postId) Boolean    }    User "1" -- "*" Post : creates &gt;    Post "*" -- "1" Category : belongs to &gt;</div><h2 id="🎯-特殊元素">🎯 特殊元素</h2><h3 id="分隔线">分隔线</h3><figure class="highlight markdown"><table><tbody><tr><td class="code"><pre><span class="line">---</span><br><span class="line"><span class="strong">***</span></span><br><span class="line"><span class="strong">__<span class="emphasis">_</span></span></span><br></pre></td></tr></tbody></table></figure><p><strong>效果展示</strong>：</p><hr><hr><hr><h3 id="脚注">脚注</h3><figure class="highlight markdown"><table><tbody><tr><td class="code"><pre><span class="line">这是一个脚注测试[^1]。</span><br><span class="line"></span><br><span class="line">[<span class="symbol">^1</span>]: <span class="link">这是脚注的详细说明内容</span></span><br></pre></td></tr></tbody></table></figure><p><strong>效果展示</strong>：<br>这是一个脚注测试<a href="%E8%BF%99%E6%98%AF%E8%84%9A%E6%B3%A8%E7%9A%84%E8%AF%A6%E7%BB%86%E8%AF%B4%E6%98%8E%E5%86%85%E5%AE%B9">^1</a>。</p><h3 id="键盘快捷键">键盘快捷键</h3><figure class="highlight markdown"><table><tbody><tr><td class="code"><pre><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">kbd</span>&gt;</span></span>Ctrl<span class="language-xml"><span class="tag">&lt;/<span class="name">kbd</span>&gt;</span></span> + <span class="language-xml"><span class="tag">&lt;<span class="name">kbd</span>&gt;</span></span>C<span class="language-xml"><span class="tag">&lt;/<span class="name">kbd</span>&gt;</span></span> 复制</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">kbd</span>&gt;</span></span>Ctrl<span class="language-xml"><span class="tag">&lt;/<span class="name">kbd</span>&gt;</span></span> + <span class="language-xml"><span class="tag">&lt;<span class="name">kbd</span>&gt;</span></span>V<span class="language-xml"><span class="tag">&lt;/<span class="name">kbd</span>&gt;</span></span> 粘贴</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">kbd</span>&gt;</span></span>Alt<span class="language-xml"><span class="tag">&lt;/<span class="name">kbd</span>&gt;</span></span> + <span class="language-xml"><span class="tag">&lt;<span class="name">kbd</span>&gt;</span></span>F4<span class="language-xml"><span class="tag">&lt;/<span class="name">kbd</span>&gt;</span></span> 关闭窗口</span><br></pre></td></tr></tbody></table></figure><p><strong>效果展示</strong>：<br><kbd>Ctrl</kbd> + <kbd>C</kbd> 复制<br><kbd>Ctrl</kbd> + <kbd>V</kbd> 粘贴<br><kbd>Alt</kbd> + <kbd>F4</kbd> 关闭窗口</p><h3 id="Emoji表情">Emoji表情</h3><figure class="highlight markdown"><table><tbody><tr><td class="code"><pre><span class="line">🎉 庆祝</span><br><span class="line">🚀 启动</span><br><span class="line">💻 编程</span><br><span class="line">📱 移动端</span><br><span class="line">🌟 星星</span><br><span class="line">🎨 创意</span><br><span class="line">📚 文档</span><br></pre></td></tr></tbody></table></figure><p><strong>效果展示</strong>：<br>🎉 庆祝<br>🚀 启动<br>💻 编程<br>📱 移动端<br>🌟 星星<br>🎨 创意<br>📚 文档</p><h2 id="🔧-高级功能">🔧 高级功能</h2><h3 id="内联HTML">内联HTML</h3><figure class="highlight markdown"><table><tbody><tr><td class="code"><pre><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">"background: #f0f8ff; padding: 15px; border-radius: 5px; border-left: 4px solid #007bff;"</span>&gt;</span></span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">strong</span>&gt;</span></span>提示：<span class="language-xml"><span class="tag">&lt;/<span class="name">strong</span>&gt;</span></span> 这是一个使用HTML创建的信息框</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">details</span>&gt;</span></span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">summary</span>&gt;</span></span>点击展开详细内容<span class="language-xml"><span class="tag">&lt;/<span class="name">summary</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line">  这里是折叠起来的详细内容，可以包含任何Markdown元素：</span><br><span class="line"></span><br><span class="line"><span class="bullet">  -</span> 列表项1</span><br><span class="line"><span class="bullet">  -</span> 列表项2</span><br><span class="line"><span class="bullet">  -</span> <span class="code">`代码示例`</span></span><br><span class="line"></span><br><span class="line">  &gt; 引用内容</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">details</span>&gt;</span></span></span><br></pre></td></tr></tbody></table></figure><p><strong>效果展示</strong>：</p><div style="background: #f0f8ff; padding: 15px; border-radius: 5px; border-left: 4px solid #007bff;">  <strong>提示：</strong> 这是一个使用HTML创建的信息框</div><details>  <summary>点击展开详细内容</summary><p>这里是折叠起来的详细内容，可以包含任何Markdown元素：</p><ul><li>列表项1</li><li>列表项2</li><li><code>代码示例</code></li></ul><blockquote><p>引用内容</p></blockquote></details><h3 id="数学公式（需要额外配置）">数学公式（需要额外配置）</h3><p>如果启用了数学公式渲染插件，可以使用以下语法：</p><figure class="highlight markdown"><table><tbody><tr><td class="code"><pre><span class="line">行内公式：$E = mc^2$</span><br><span class="line"></span><br><span class="line">块级公式：</span><br><span class="line">$$</span><br><span class="line">\int<span class="emphasis">_{-\infty}^{\infty} e^{-x^2} dx = \sqrt{\pi}</span></span><br><span class="line"><span class="emphasis">$$</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis">矩阵公式：</span></span><br><span class="line"><span class="emphasis">$$</span></span><br><span class="line"><span class="emphasis">\begin{pmatrix}</span></span><br><span class="line"><span class="emphasis">a &amp; b &amp; c \\</span></span><br><span class="line"><span class="emphasis">d &amp; e &amp; f \\</span></span><br><span class="line"><span class="emphasis">g &amp; h &amp; i</span></span><br><span class="line"><span class="emphasis">\end{pmatrix}</span></span><br><span class="line"><span class="emphasis">$$</span></span><br></pre></td></tr></tbody></table></figure><h2 id="📱-响应式表格和代码">📱 响应式表格和代码</h2><p>本博客支持响应式设计，表格和代码块在不同设备上都能良好显示。</p><h3 id="移动端优化">移动端优化</h3><ul><li>表格支持横向滚动</li><li>代码块支持横向滚动</li><li>Mermaid图表自动调整大小</li><li>图片自适应屏幕宽度</li></ul><h2 id="🚀-最佳实践">🚀 最佳实践</h2><h3 id="文章结构建议">文章结构建议</h3><ol><li><strong>使用清晰的标题层级</strong>（H1 → H2 → H3）</li><li><strong>适当使用分隔线</strong>分隔不同章节</li><li><strong>为图片添加alt文本</strong>提升可访问性</li><li><strong>使用任务列表</strong>跟踪待办事项</li><li><strong>合理使用Mermaid图表</strong>展示复杂概念</li></ol><h3 id="代码高亮建议">代码高亮建议</h3><ol><li><strong>始终指定语言类型</strong>以获得正确的语法高亮</li><li><strong>添加有意义的注释</strong>解释代码逻辑</li><li><strong>保持代码片段简短</strong>，专注于关键部分</li><li><strong>使用行号</strong>（在配置中启用）便于引用</li></ol><h3 id="SEO优化建议">SEO优化建议</h3><ol><li><strong>使用语义化的HTML标签</strong></li><li><strong>为图片添加描述性alt文本</strong></li><li><strong>合理使用标题标签</strong>（每个页面一个H1）</li><li><strong>创建有意义的链接文本</strong></li><li><strong>使用结构化数据</strong>（如需要）</li></ol><hr><h2 id="💡-总结">💡 总结</h2><p>这个Markdown指南涵盖了在Hexo博客中可以使用的：</p><ul><li>✅ <strong>基础语法</strong>：文本格式、列表、引用</li><li>✅ <strong>高级元素</strong>：表格、代码、链接、图片</li><li>✅ <strong>扩展功能</strong>：Mermaid图表、脚注、键盘样式</li><li>✅ <strong>响应式设计</strong>：移动端友好</li><li>✅ <strong>代码高亮</strong>：多种编程语言支持</li></ul><p>通过合理使用这些Markdown元素，你可以创建出内容丰富、格式美观的博客文章！</p><blockquote><p><strong>💡 提示</strong>：将此页面加入书签，作为编写博客文章的快速参考指南。</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 技术指南 </category>
          
          <category> 博客教程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Markdown </tag>
            
            <tag> 语法指南 </tag>
            
            <tag> 写作教程 </tag>
            
            <tag> 博客功能 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>sealos问答记录</title>
      <link href="/2025/12/07/0005-sealos-wen-da-ji-lu/"/>
      <url>/2025/12/07/0005-sealos-wen-da-ji-lu/</url>
      
        <content type="html"><![CDATA[<h1>Sealos运维问答记录</h1><h2 id="1-概念理解">1. 概念理解</h2><h3 id="1-1-Kubernetes架构相关">1.1 Kubernetes架构相关</h3><p><strong>问题：一个Pod可以包含一个或多个紧密相关的容器，什么意思？例如我一个docker compose说明了服务依赖postgresql等等服务，这一组服务一个pod？</strong></p><p><strong>回答：</strong> 不是的，您对Pod的理解有些偏差。Pod是Kubernetes中最小的部署单元，它包含一个或多个"紧密相关"的容器。这里的"紧密相关"是指这些容器需要共享存储和网络，共同完成一个任务。</p><p>在Docker Compose中的多个服务（如Java应用+PostgreSQL）在Kubernetes中应该对应多个Pod + Service，而不是一个Pod。Pod中多个容器的"紧密相关"是指它们协同完成一个单一任务，而不是运行不同的服务组件。</p><p><strong>问题：服务和实际的运行的服务我还是搞不清楚</strong></p><p><strong>回答：</strong> Kubernetes中的Service（服务）和实际运行的服务（应用程序）有以下区别：</p><ul><li><strong>Service</strong>：是Kubernetes的一个API对象，是一个网络抽象，为一组Pod提供稳定的网络端点（IP地址和DNS名称）</li><li><strong>实际运行的服务</strong>：是运行在Pod中的实际应用程序</li></ul><p>它们的关系是：用户请求 → Service IP/域名 → Service → 标签选择器 → 实际运行的Pod。Service就像一个门面，为实际运行在Pod中的应用程序提供稳定的访问入口。</p><h3 id="1-2-概念映射">1.2 概念映射</h3><p><strong>问题：假如有一个为java服务，这个服务一个实例就是一个pod，多个pod指向同一个service，service负责做负载均衡，容器是就是一个pod实例，每一个pod都是不是再某一个命名空间下的，集群通过控制pod部署在哪个node去控制资源做容灾</strong></p><p><strong>回答：</strong></p><ul><li>一个Pod通常运行一个服务实例，多个Pod通过Service提供负载均衡</li><li>Pod包含一个或多个紧密相关的容器</li><li>所有Pod都在命名空间下运行（默认为default）</li><li>控制器通过调度策略控制Pod部署在哪个Node上以实现容灾</li></ul><h2 id="2-集群操作">2. 集群操作</h2><h3 id="2-1-查看集群状态">2.1 查看集群状态</h3><p><strong>问题：假如我们有一个三个主机构建的k8s集群，查看集群状态</strong></p><p><strong>回答：</strong></p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 查看所有节点状态</span></span><br><span class="line">kubectl get nodes</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看节点详细信息</span></span><br><span class="line">kubectl describe node &lt;node-name&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看集群整体信息</span></span><br><span class="line">kubectl cluster-info</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看所有命名空间中的资源</span></span><br><span class="line">kubectl get all --all-namespaces</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看系统命名空间中的资源</span></span><br><span class="line">kubectl get pods -n kube-system</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看集群资源使用情况</span></span><br><span class="line">kubectl top nodes</span><br><span class="line">kubectl top pods --all-namespaces</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看集群事件</span></span><br><span class="line">kubectl get events --all-namespaces</span><br></pre></td></tr></tbody></table></figure><p><strong>问题：这个nodes是主机的意思吗</strong></p><p><strong>回答：</strong> 是的，Node是指集群中的主机，可以是物理服务器或虚拟机。每个Node都安装了kubelet和容器运行时，是Kubernetes集群的工作机器。</p><p><strong>问题：查看某命名空间下有多少服务</strong></p><p><strong>回答：</strong></p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 查看指定命名空间下的服务数量</span></span><br><span class="line">kubectl get services -n &lt;命名空间名称&gt; --no-headers | <span class="built_in">wc</span> -l</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看指定命名空间下的所有服务</span></span><br><span class="line">kubectl get services -n &lt;命名空间名称&gt;</span><br></pre></td></tr></tbody></table></figure><h3 id="2-2-日志查看">2.2 日志查看</h3><p><strong>问题：查看某服务的日志</strong></p><p><strong>回答：</strong> Service本身不产生日志。要查看与服务相关的日志，需要查看该服务后端Pod的日志：</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 查看服务后端Pod的日志</span></span><br><span class="line">kubectl logs -l &lt;标签选择器&gt; -n &lt;命名空间&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看特定Pod的日志</span></span><br><span class="line">kubectl logs &lt;Pod名称&gt; -n &lt;命名空间&gt;</span><br></pre></td></tr></tbody></table></figure><p><strong>问题：如果这个pod不是的是多个呢，例如一个java服务，部署了3个实例</strong></p><p><strong>回答：</strong> 如果一个服务有3个Pod实例，可以这样查看日志：</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 查看所有3个Pod的日志</span></span><br><span class="line">kubectl logs -l app=&lt;标签值&gt; -n &lt;命名空间&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 实时查看所有Pod的日志</span></span><br><span class="line"><span class="comment"># 需要使用第三方工具如stern</span></span><br><span class="line">stern -n &lt;命名空间&gt; -l app=&lt;标签值&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 或使用脚本查看所有Pod日志</span></span><br><span class="line">kubectl get pods -l app=&lt;标签值&gt; -n &lt;命名空间&gt; -o name | xargs -I {} kubectl logs {} -n &lt;命名空间&gt;</span><br></pre></td></tr></tbody></table></figure><h2 id="3-运维实践">3. 运维实践</h2><h3 id="3-1-故障排查">3.1 故障排查</h3><p><strong>问题：当您在生产环境中遇到Pod频繁重启时，您会按照什么顺序排查问题？</strong></p><p><strong>回答：</strong></p><ol><li><code>kubectl get pods -l app=xxx -n &lt;命名空间&gt;</code> # 查看Pod状态</li><li><code>kubectl describe pod &lt;pod名称&gt; -n &lt;命名空间&gt;</code> # 查看详细事件</li><li><code>kubectl logs &lt;pod名称&gt; -n &lt;命名空间&gt;</code> # 查看当前容器日志</li><li><code>kubectl logs &lt;pod名称&gt; -n &lt;命名空间&gt; --previous</code> # 查看上一个容器的日志</li></ol><h3 id="3-2-高可用配置">3.2 高可用配置</h3><p><strong>问题：在一个三节点的K8s集群中，如果要实现高可用，您会如何分配Master和Worker节点的角色？</strong></p><p><strong>回答：</strong> 在三节点集群中：</p><ul><li>选项1：三台都同时承担Master和Worker角色（混合节点配置）</li><li>选项2：一台Master，两台Worker（分离角色配置）</li></ul><p>对于etcd高可用，需要在三个节点上都部署etcd实例。</p><p><strong>Clusterfile配置示例：</strong></p><figure class="highlight yaml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps.sealos.io/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Cluster</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">my-cluster</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">image:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">kubernetes:v1.25.0</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">calico:v3.24.1</span></span><br><span class="line">  <span class="attr">hosts:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">ips:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">"192.168.1.100"</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">"192.168.1.101"</span> </span><br><span class="line">        <span class="bullet">-</span> <span class="string">"192.168.1.102"</span></span><br><span class="line">      <span class="attr">roles:</span> [ <span class="string">"master"</span>, <span class="string">"node"</span>, <span class="string">"etcd"</span> ]</span><br></pre></td></tr></tbody></table></figure><h3 id="3-3-配置管理">3.3 配置管理</h3><p><strong>问题：您如何处理应用配置在不同环境（开发、测试、生产）之间的差异？</strong></p><p><strong>回答：</strong></p><ol><li>使用命名空间隔离不同环境</li><li>使用ConfigMap管理非敏感配置</li><li>使用Secret管理敏感配置</li><li>使用Helm或Kustomize进行模板化配置管理</li><li>通过CI/CD管道自动化部署到不同环境</li></ol><h2 id="4-概念解释">4. 概念解释</h2><h3 id="4-1-etcd">4.1 etcd</h3><p><strong>问题：etcd是什么意思</strong></p><p><strong>回答：</strong> etcd是Kubernetes的核心组件，是一个高可用的分布式键值存储系统，是Kubernetes的"大脑"，负责存储集群的所有状态信息，包括节点信息、Pod配置、服务定义、配置数据等。为了实现高可用，etcd通常需要在多个节点上部署实例，形成etcd集群。</p>]]></content>
      
      
      
        <tags>
            
            <tag> k8s </tag>
            
            <tag> sealos </tag>
            
            <tag> 运维 </tag>
            
            <tag> 问答 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>sealos实战</title>
      <link href="/2025/12/07/0004-sealos-shi-zhan/"/>
      <url>/2025/12/07/0004-sealos-shi-zhan/</url>
      
        <content type="html"><![CDATA[<h1>Sealos实战：从零开始部署和管理Kubernetes集群</h1><h2 id="概述">概述</h2><p>本文档详细介绍了如何使用Sealos在多台服务器上部署和管理Kubernetes集群，包括环境准备、集群部署、应用部署、配置管理、扩容、容灾、升级和回滚等完整运维流程。我们将以三台服务器为例，展示从零开始构建到运维整个Kubernetes集群的完整过程。</p><h2 id="1-环境准备">1. 环境准备</h2><h3 id="1-1-服务器规划">1.1 服务器规划</h3><p>我们使用三台服务器作为示例：</p><ul><li>Master节点（控制平面）：192.168.1.100</li><li>Worker节点1：192.168.1.101</li><li>Worker节点2：192.168.1.102</li></ul><h3 id="1-2-前提条件">1.2 前提条件</h3><p>在所有服务器上准备以下环境：</p><ol><li><strong>操作系统</strong>：Ubuntu 20.04 LTS 或 CentOS 8.x</li><li><strong>硬件配置</strong>：<ul><li>CPU：至少2核</li><li>内存：至少4GB</li><li>磁盘：至少40GB</li></ul></li><li><strong>网络配置</strong>：<ul><li>服务器之间网络互通</li><li>关闭防火墙或开放必要端口</li></ul></li><li><strong>SSH访问</strong>：确保可以从任一节点SSH到其他节点</li></ol><h3 id="1-3-系统准备命令">1.3 系统准备命令</h3><p>在所有节点上执行以下命令：</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 关闭防火墙（生产环境建议配置具体规则）</span></span><br><span class="line"><span class="built_in">sudo</span> ufw <span class="built_in">disable</span>  <span class="comment"># Ubuntu</span></span><br><span class="line"><span class="built_in">sudo</span> systemctl stop firewalld  <span class="comment"># CentOS</span></span><br><span class="line"><span class="built_in">sudo</span> systemctl <span class="built_in">disable</span> firewalld</span><br><span class="line"></span><br><span class="line"><span class="comment"># 关闭Swap</span></span><br><span class="line"><span class="built_in">sudo</span> swapoff -a</span><br><span class="line"><span class="built_in">sudo</span> sed -i <span class="string">'/ swap / s/^\(.*\)$/#\1/g'</span> /etc/fstab</span><br><span class="line"></span><br><span class="line"><span class="comment"># 允许iptables转发</span></span><br><span class="line"><span class="built_in">sudo</span> modprobe overlay</span><br><span class="line"><span class="built_in">sudo</span> modprobe br_netfilter</span><br><span class="line"><span class="built_in">cat</span> &lt;&lt;<span class="string">EOF | sudo tee /etc/modules-load.d/k8s.conf</span></span><br><span class="line"><span class="string">overlay</span></span><br><span class="line"><span class="string">br_netfilter</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> &lt;&lt;<span class="string">EOF | sudo tee /etc/sysctl.d/k8s.conf</span></span><br><span class="line"><span class="string">net.bridge.bridge-nf-call-iptables  = 1</span></span><br><span class="line"><span class="string">net.bridge.bridge-nf-call-ip6tables = 1</span></span><br><span class="line"><span class="string">net.ipv4.ip_forward                 = 1</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">sudo</span> sysctl --system</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装Docker</span></span><br><span class="line">curl -fsSL https://get.docker.com | bash -s docker --mirror Aliyun</span><br><span class="line"><span class="built_in">sudo</span> systemctl <span class="built_in">enable</span> docker</span><br><span class="line"><span class="built_in">sudo</span> systemctl start docker</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置国内镜像源（可选，提高拉取速度）</span></span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">mkdir</span> -p /etc/docker</span><br><span class="line"><span class="built_in">cat</span> &lt;&lt;<span class="string">EOF | sudo tee /etc/docker/daemon.json</span></span><br><span class="line"><span class="string">{</span></span><br><span class="line"><span class="string">  "registry-mirrors": [</span></span><br><span class="line"><span class="string">    "https://docker.mirrors.ustc.edu.cn",</span></span><br><span class="line"><span class="string">    "https://hub-mirror.c.163.com"</span></span><br><span class="line"><span class="string">  ],</span></span><br><span class="line"><span class="string">  "exec-opts": ["native.cgroupdriver=systemd"]</span></span><br><span class="line"><span class="string">}</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"><span class="built_in">sudo</span> systemctl restart docker</span><br></pre></td></tr></tbody></table></figure><h2 id="2-安装Sealos">2. 安装Sealos</h2><p>在Master节点（192.168.1.100）上安装Sealos：</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 安装sealos</span></span><br><span class="line">wget -c https://ghproxy.com/github.com/labring/sealos/releases/download/v4.4.0/sealos_4.4.0_linux_amd64.tar.gz \</span><br><span class="line">     -O - | <span class="built_in">sudo</span> tar -zx -C /usr/local/bin</span><br><span class="line"></span><br><span class="line"><span class="comment"># 为sealos添加执行权限</span></span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">chmod</span> +x /usr/local/bin/sealos</span><br><span class="line"></span><br><span class="line"><span class="comment"># 验证安装</span></span><br><span class="line">sealos version</span><br></pre></td></tr></tbody></table></figure><h2 id="3-创建Clusterfile定义集群">3. 创建Clusterfile定义集群</h2><p>创建一个名为<code>Clusterfile</code>的文件来定义集群配置：</p><figure class="highlight yaml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps.sealos.io/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Cluster</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">my-cluster</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">image:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">kubernetes:v1.25.0</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">calico:v3.24.1</span></span><br><span class="line">  <span class="attr">hosts:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">ips:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">"192.168.1.100"</span>  <span class="comment"># Master节点IP</span></span><br><span class="line">      <span class="attr">roles:</span> [ <span class="string">"master"</span>, <span class="string">"control-plane"</span> ]</span><br><span class="line">    <span class="bullet">-</span> <span class="attr">ips:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">"192.168.1.101"</span>  <span class="comment"># Worker节点IP 1</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">"192.168.1.102"</span>  <span class="comment"># Worker节点IP 2</span></span><br><span class="line">      <span class="attr">roles:</span> [ <span class="string">"node"</span> ]</span><br></pre></td></tr></tbody></table></figure><p>这个配置文件定义了：</p><ul><li>使用Kubernetes v1.25.0版本</li><li>使用Calico作为CNI网络插件</li><li>一台Master节点和两台Worker节点</li></ul><h2 id="4-部署Kubernetes集群">4. 部署Kubernetes集群</h2><p>在Master节点上运行以下命令部署集群：</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 使用Clusterfile部署集群</span></span><br><span class="line">sealos run -f Clusterfile</span><br><span class="line"></span><br><span class="line"><span class="comment"># 或者直接使用命令行参数部署</span></span><br><span class="line">sealos run kubernetes:v1.25.0 calico:v3.24.1 \</span><br><span class="line">  --masters 192.168.1.100 \</span><br><span class="line">  --nodes 192.168.1.101,192.168.1.102</span><br></pre></td></tr></tbody></table></figure><p>部署完成后，Sealos会：</p><ul><li>安装Kubernetes组件</li><li>配置etcd集群</li><li>初始化Master节点</li><li>加入Worker节点</li><li>配置网络插件Calico</li></ul><p>验证集群状态：</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 如果sealos自动配置了kubectl</span></span><br><span class="line">kubectl get nodes</span><br><span class="line"></span><br><span class="line"><span class="comment"># 或者使用以下命令获取集群访问信息</span></span><br><span class="line">sealos kubeconfig -f Clusterfile --host 192.168.1.100</span><br></pre></td></tr></tbody></table></figure><p>预期输出：</p><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">NAME              STATUS   ROLES                  AGE   VERSION</span><br><span class="line">192.168.1.100     Ready    control-plane,master   5m    v1.25.0</span><br><span class="line">192.168.1.101     Ready    &lt;none&gt;                 4m    v1.25.0</span><br><span class="line">192.168.1.102     Ready    &lt;none&gt;                 4m    v1.25.0</span><br></pre></td></tr></tbody></table></figure><h2 id="5-理解Pod和Node的分配机制">5. 理解Pod和Node的分配机制</h2><h3 id="5-1-Node（节点）">5.1 Node（节点）</h3><p>Node是集群中的工作机器（物理机或虚拟机），负责运行Pod。在我们的例子中：</p><ul><li>192.168.1.100：Master节点，具有控制平面角色</li><li>192.168.1.101和192.168.1.102：Worker节点，用于运行工作负载</li></ul><h3 id="5-2-Pod（容器组）">5.2 Pod（容器组）</h3><p>Pod是Kubernetes中最小的部署单元，通常包含一个或多个紧密相关的容器。</p><h3 id="5-3-调度机制">5.3 调度机制</h3><p>Kubernetes调度器（kube-scheduler）负责决定Pod在哪个Node上运行。它考虑以下因素：</p><ul><li>资源需求：CPU、内存等</li><li>节点标签（Labels）和节点选择器（Node Selector）</li><li>污点（Taints）和容忍度（Tolerations）</li><li>亲和性（Affinity）和反亲和性（Anti-Affinity）</li></ul><h2 id="6-部署应用到集群">6. 部署应用到集群</h2><h3 id="6-1-准备Docker镜像">6.1 准备Docker镜像</h3><p>假设我们有一个名为<code>my-web-app:latest</code>的Docker镜像，包含一个简单的Web应用。</p><p>首先，确保镜像在所有节点上都可用：</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 在所有节点上拉取镜像</span></span><br><span class="line"><span class="built_in">sudo</span> docker pull my-registry/my-web-app:latest</span><br><span class="line"></span><br><span class="line"><span class="comment"># 或者在一台机器上保存镜像为tar文件，然后分发到其他节点</span></span><br><span class="line">docker save -o my-web-app.tar my-registry/my-web-app:latest</span><br><span class="line">scp my-web-app.tar user@192.168.1.101:~/</span><br><span class="line">scp my-web-app.tar user@192.168.1.102:~/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在其他节点上加载镜像</span></span><br><span class="line">docker load -i my-web-app.tar</span><br></pre></td></tr></tbody></table></figure><h3 id="6-2-创建应用部署配置">6.2 创建应用部署配置</h3><p>创建一个名为<code>web-app-deployment.yaml</code>的文件：</p><figure class="highlight yaml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">my-web-app</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">2</span>  <span class="comment"># 初始副本数</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">my-web-app</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">my-web-app</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">web-container</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">my-registry/my-web-app:latest</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">80</span></span><br><span class="line">        <span class="attr">env:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">ENV</span></span><br><span class="line">          <span class="attr">value:</span> <span class="string">"production"</span></span><br><span class="line">        <span class="attr">resources:</span></span><br><span class="line">          <span class="attr">requests:</span></span><br><span class="line">            <span class="attr">memory:</span> <span class="string">"64Mi"</span></span><br><span class="line">            <span class="attr">cpu:</span> <span class="string">"250m"</span></span><br><span class="line">          <span class="attr">limits:</span></span><br><span class="line">            <span class="attr">memory:</span> <span class="string">"128Mi"</span></span><br><span class="line">            <span class="attr">cpu:</span> <span class="string">"500m"</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">my-web-app-service</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">my-web-app</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">      <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="number">80</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">LoadBalancer</span>  <span class="comment"># 或者使用NodePort或ClusterIP</span></span><br></pre></td></tr></tbody></table></figure><h3 id="6-3-通过Sealos部署应用">6.3 通过Sealos部署应用</h3><p>使用Sealos可以创建应用包来部署应用，也可以使用kubectl直接应用YAML配置：</p><h4 id="方法1：使用kubectl">方法1：使用kubectl</h4><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 应用YAML配置</span></span><br><span class="line">kubectl apply -f web-app-deployment.yaml</span><br><span class="line"></span><br><span class="line"><span class="comment"># 验证部署</span></span><br><span class="line">kubectl get deployments</span><br><span class="line">kubectl get pods</span><br><span class="line">kubectl get services</span><br></pre></td></tr></tbody></table></figure><h4 id="方法2：使用Sealos应用包">方法2：使用Sealos应用包</h4><p>首先创建应用包（Application Package）：</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 创建应用包目录结构</span></span><br><span class="line"><span class="built_in">mkdir</span> my-web-app-pkg</span><br><span class="line"><span class="built_in">cd</span> my-web-app-pkg</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建Kubefile定义应用包</span></span><br><span class="line"><span class="built_in">cat</span> &gt; Kubefile &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">FROM scratch</span></span><br><span class="line"><span class="string">COPY web-app-deployment.yaml .</span></span><br><span class="line"><span class="string">CMD ["kubectl apply -f web-app-deployment.yaml"]</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 构建应用包镜像</span></span><br><span class="line">sealos build -t my-registry/my-web-app-pkg:latest .</span><br><span class="line"></span><br><span class="line"><span class="comment"># 推送镜像到仓库（如果需要）</span></span><br><span class="line">sealos push my-registry/my-web-app-pkg:latest</span><br><span class="line"></span><br><span class="line"><span class="comment"># 运行应用包</span></span><br><span class="line">sealos run my-registry/my-web-app-pkg:latest</span><br></pre></td></tr></tbody></table></figure><h2 id="7-配置参数注入">7. 配置参数注入</h2><h3 id="7-1-通过ConfigMap注入配置">7.1 通过ConfigMap注入配置</h3><p>创建一个ConfigMap来存储配置参数：</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 创建ConfigMap</span></span><br><span class="line">kubectl create configmap app-config \</span><br><span class="line">  --from-literal=database.host=192.168.1.200 \</span><br><span class="line">  --from-literal=database.port=3306 \</span><br><span class="line">  --from-literal=app.mode=production</span><br></pre></td></tr></tbody></table></figure><p>更新Deployment以使用ConfigMap：</p><figure class="highlight yaml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">my-web-app</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">2</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">my-web-app</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">my-web-app</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">web-container</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">my-registry/my-web-app:latest</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">80</span></span><br><span class="line">        <span class="attr">env:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">DATABASE_HOST</span></span><br><span class="line">          <span class="attr">valueFrom:</span></span><br><span class="line">            <span class="attr">configMapKeyRef:</span></span><br><span class="line">              <span class="attr">name:</span> <span class="string">app-config</span></span><br><span class="line">              <span class="attr">key:</span> <span class="string">database.host</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">DATABASE_PORT</span></span><br><span class="line">          <span class="attr">valueFrom:</span></span><br><span class="line">            <span class="attr">configMapKeyRef:</span></span><br><span class="line">              <span class="attr">name:</span> <span class="string">app-config</span></span><br><span class="line">              <span class="attr">key:</span> <span class="string">database.port</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">APP_MODE</span></span><br><span class="line">          <span class="attr">valueFrom:</span></span><br><span class="line">            <span class="attr">configMapKeyRef:</span></span><br><span class="line">              <span class="attr">name:</span> <span class="string">app-config</span></span><br><span class="line">              <span class="attr">key:</span> <span class="string">app.mode</span></span><br><span class="line">        <span class="attr">volumeMounts:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">config-volume</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/etc/config</span></span><br><span class="line">      <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">config-volume</span></span><br><span class="line">        <span class="attr">configMap:</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">app-config</span></span><br></pre></td></tr></tbody></table></figure><h3 id="7-2-通过Secret注入敏感配置">7.2 通过Secret注入敏感配置</h3><p>创建一个Secret来存储敏感信息（如密码、密钥）：</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 创建Secret</span></span><br><span class="line">kubectl create secret generic app-secret \</span><br><span class="line">  --from-literal=db-password=supersecretpassword \</span><br><span class="line">  --from-literal=api-key=your-api-key</span><br></pre></td></tr></tbody></table></figure><p>更新Deployment以使用Secret：</p><figure class="highlight yaml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">my-web-app</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">2</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">my-web-app</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">my-web-app</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">web-container</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">my-registry/my-web-app:latest</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">80</span></span><br><span class="line">        <span class="attr">env:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">DATABASE_HOST</span></span><br><span class="line">          <span class="attr">valueFrom:</span></span><br><span class="line">            <span class="attr">configMapKeyRef:</span></span><br><span class="line">              <span class="attr">name:</span> <span class="string">app-config</span></span><br><span class="line">              <span class="attr">key:</span> <span class="string">database.host</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">DB_PASSWORD</span></span><br><span class="line">          <span class="attr">valueFrom:</span></span><br><span class="line">            <span class="attr">secretKeyRef:</span></span><br><span class="line">              <span class="attr">name:</span> <span class="string">app-secret</span></span><br><span class="line">              <span class="attr">key:</span> <span class="string">db-password</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">API_KEY</span></span><br><span class="line">          <span class="attr">valueFrom:</span></span><br><span class="line">            <span class="attr">secretKeyRef:</span></span><br><span class="line">              <span class="attr">name:</span> <span class="string">app-secret</span></span><br><span class="line">              <span class="attr">key:</span> <span class="string">api-key</span></span><br></pre></td></tr></tbody></table></figure><h2 id="8-节点扩容">8. 节点扩容</h2><h3 id="8-1-扩容Worker节点">8.1 扩容Worker节点</h3><p>当需要增加Worker节点来提供更多的计算资源时：</p><ol><li>在新的服务器上准备环境（按照1.3节的系统准备命令）</li><li>使用Sealos添加节点：</li></ol><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 添加新的Worker节点</span></span><br><span class="line">sealos add --nodes 192.168.1.103</span><br><span class="line"></span><br><span class="line"><span class="comment"># 验证节点是否加入集群</span></span><br><span class="line">kubectl get nodes</span><br></pre></td></tr></tbody></table></figure><h3 id="8-2-扩容应用Pod">8.2 扩容应用Pod</h3><p>增加应用的副本数：</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 扩容到5个副本</span></span><br><span class="line">kubectl scale deployment my-web-app --replicas=5</span><br><span class="line"></span><br><span class="line"><span class="comment"># 或者直接编辑Deployment</span></span><br><span class="line">kubectl edit deployment my-web-app</span><br></pre></td></tr></tbody></table></figure><h2 id="9-容灾策略">9. 容灾策略</h2><h3 id="9-1-高可用Master节点">9.1 高可用Master节点</h3><p>为避免Master节点单点故障，我们可以部署高可用集群：</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 使用三个Master节点部署高可用集群</span></span><br><span class="line">sealos run kubernetes:v1.25.0 calico:v3.24.1 \</span><br><span class="line">  --masters 192.168.1.100,192.168.1.103,192.168.1.104 \</span><br><span class="line">  --nodes 192.168.1.101,192.168.1.102</span><br></pre></td></tr></tbody></table></figure><h3 id="9-2-备份和恢复">9.2 备份和恢复</h3><p>定期备份etcd数据和Kubernetes清单：</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 备份etcd</span></span><br><span class="line">ETCDCTL_API=3 etcdctl snapshot save /tmp/etcd-snapshot-$(<span class="built_in">date</span> +%Y%m%d).db \</span><br><span class="line">  --endpoints=https://127.0.0.1:2379 \</span><br><span class="line">  --cacert=/etc/kubernetes/pki/etcd/ca.crt \</span><br><span class="line">  --cert=/etc/kubernetes/pki/etcd/server.crt \</span><br><span class="line">  --key=/etc/kubernetes/pki/etcd/server.key</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用Velero备份和恢复</span></span><br><span class="line"><span class="comment"># 安装Velero</span></span><br><span class="line">kubectl apply -f https://github.com/vmware-tanzu/velero/releases/latest/download/velero-install.yaml</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建备份</span></span><br><span class="line">velero backup create my-backup --selector app=my-web-app</span><br></pre></td></tr></tbody></table></figure><h3 id="9-3-健康检查和监控">9.3 健康检查和监控</h3><p>配置Liveness和Readiness探针：</p><figure class="highlight yaml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">my-web-app</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">2</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">my-web-app</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">my-web-app</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">web-container</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">my-registry/my-web-app:latest</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">80</span></span><br><span class="line">        <span class="attr">livenessProbe:</span></span><br><span class="line">          <span class="attr">httpGet:</span></span><br><span class="line">            <span class="attr">path:</span> <span class="string">/health</span></span><br><span class="line">            <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line">          <span class="attr">initialDelaySeconds:</span> <span class="number">30</span></span><br><span class="line">          <span class="attr">periodSeconds:</span> <span class="number">10</span></span><br><span class="line">        <span class="attr">readinessProbe:</span></span><br><span class="line">          <span class="attr">httpGet:</span></span><br><span class="line">            <span class="attr">path:</span> <span class="string">/ready</span></span><br><span class="line">            <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line">          <span class="attr">initialDelaySeconds:</span> <span class="number">5</span></span><br><span class="line">          <span class="attr">periodSeconds:</span> <span class="number">5</span></span><br></pre></td></tr></tbody></table></figure><h2 id="10-应用升级和回滚">10. 应用升级和回滚</h2><h3 id="10-1-应用升级">10.1 应用升级</h3><h4 id="滚动更新">滚动更新</h4><p>使用滚动更新策略进行应用升级：</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 更新部署的镜像</span></span><br><span class="line">kubectl <span class="built_in">set</span> image deployment/my-web-app web-container=my-registry/my-web-app:v2.0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看升级进度</span></span><br><span class="line">kubectl rollout status deployment/my-web-app</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看升级历史</span></span><br><span class="line">kubectl rollout <span class="built_in">history</span> deployment/my-web-app</span><br></pre></td></tr></tbody></table></figure><h4 id="使用Helm进行升级（可选）">使用Helm进行升级（可选）</h4><p>如果使用Helm管理应用：</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 更新Helm Chart</span></span><br><span class="line">helm upgrade my-release my-chart --<span class="built_in">set</span> image.tag=v2.0</span><br></pre></td></tr></tbody></table></figure><h3 id="10-2-升级失败回滚">10.2 升级失败回滚</h3><p>如果新版本出现问题，可以快速回滚：</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 查看升级历史</span></span><br><span class="line">kubectl rollout <span class="built_in">history</span> deployment/my-web-app</span><br><span class="line"></span><br><span class="line"><span class="comment"># 回滚到上一个版本</span></span><br><span class="line">kubectl rollout undo deployment/my-web-app</span><br><span class="line"></span><br><span class="line"><span class="comment"># 回滚到指定版本</span></span><br><span class="line">kubectl rollout undo deployment/my-web-app --to-revision=2</span><br></pre></td></tr></tbody></table></figure><h3 id="10-3-集群升级">10.3 集群升级</h3><p>升级整个Kubernetes集群：</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 使用Sealos升级集群</span></span><br><span class="line">sealos run kubernetes:v1.26.0 calico:v3.25.0 \</span><br><span class="line">  --masters 192.168.1.100 \</span><br><span class="line">  --nodes 192.168.1.101,192.168.1.102</span><br></pre></td></tr></tbody></table></figure><h2 id="11-实战案例总结">11. 实战案例总结</h2><p>通过以上步骤，我们完成了一个完整的Sealos实战流程：</p><ol><li><strong>环境准备</strong>：在三台服务器上配置系统环境</li><li><strong>集群部署</strong>：使用Sealos快速部署Kubernetes集群</li><li><strong>应用部署</strong>：将Docker镜像部署到集群中</li><li><strong>配置管理</strong>：通过ConfigMap和Secret注入配置参数</li><li><strong>节点扩容</strong>：添加新的Worker节点和应用Pod</li><li><strong>容灾策略</strong>：配置高可用、备份和健康检查</li><li><strong>升级回滚</strong>：实现应用和集群的升级与回滚</li></ol><p>这种基于Sealos的部署方式大大简化了Kubernetes集群的部署和管理复杂度，使得运维团队可以更专注于应用本身，而不是基础设施的复杂性。</p><h2 id="12-Kubernetes核心概念和术语">12. Kubernetes核心概念和术语</h2><p>在深入了解问题排查之前，让我们先梳理Kubernetes的层级结构和核心概念，从大到小排列：</p><h3 id="12-1-集群（Cluster）">12.1 集群（Cluster）</h3><ul><li><strong>定义</strong>：由一个或多个节点组成的容器化应用平台</li><li><strong>实际例子</strong>：我们前面创建的名为<code>my-cluster</code>的Kubernetes集群</li><li><strong>映射</strong>：一个完整的Kubernetes环境，包含控制平面和工作节点</li><li><strong>对应命令</strong>：<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 查看集群信息</span></span><br><span class="line">kubectl cluster-info</span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查集群组件状态</span></span><br><span class="line">kubectl get componentstatuses</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看集群节点</span></span><br><span class="line">kubectl get nodes</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看集群版本信息</span></span><br><span class="line">kubectl version</span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查集群健康状况</span></span><br><span class="line">kubectl top nodes</span><br></pre></td></tr></tbody></table></figure></li></ul><h3 id="12-2-命名空间（Namespace）">12.2 命名空间（Namespace）</h3><ul><li><strong>定义</strong>：集群中的虚拟子分区，用于隔离资源</li><li><strong>实际例子</strong>：default、kube-system、kube-public等</li><li><strong>映射</strong>：类似于操作系统的文件夹，用于组织和隔离不同环境的资源</li><li><strong>对应命令</strong>：<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 查看所有命名空间</span></span><br><span class="line">kubectl get namespaces</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建命名空间</span></span><br><span class="line">kubectl create namespace my-namespace</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在指定命名空间中操作资源</span></span><br><span class="line">kubectl get pods -n my-namespace</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看命名空间详细信息</span></span><br><span class="line">kubectl describe namespace my-namespace</span><br></pre></td></tr></tbody></table></figure></li></ul><h3 id="12-3-节点（Node）">12.3 节点（Node）</h3><ul><li><strong>定义</strong>：集群中的工作机器，可以是物理机或虚拟机</li><li><strong>实际例子</strong>：我们使用的三台服务器（192.168.1.100、192.168.1.101、192.168.1.102）</li><li><strong>映射</strong>：192.168.1.100（Master节点）、192.168.1.101和192.168.1.102（Worker节点）</li><li><strong>对应命令</strong>：<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 查看所有节点</span></span><br><span class="line">kubectl get nodes</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看节点详细信息</span></span><br><span class="line">kubectl describe node &lt;node-name&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看节点资源使用情况</span></span><br><span class="line">kubectl top nodes</span><br><span class="line"></span><br><span class="line"><span class="comment"># 标记节点不可调度</span></span><br><span class="line">kubectl cordon &lt;node-name&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 标记节点可调度</span></span><br><span class="line">kubectl uncordon &lt;node-name&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安全驱逐节点上的Pod（用于维护）</span></span><br><span class="line">kubectl drain &lt;node-name&gt; --ignore-daemonsets</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看节点事件</span></span><br><span class="line">kubectl get events --field-selector involvedObject.kind=Node</span><br></pre></td></tr></tbody></table></figure></li></ul><h3 id="12-4-Pod">12.4 Pod</h3><ul><li><strong>定义</strong>：Kubernetes中最小的部署单元，可包含一个或多个紧密相关的容器</li><li><strong>实际例子</strong>：my-web-app-7d5b9c8f4c-xyz12 这个Pod</li><li><strong>映射</strong>：一个逻辑主机，包含一个或多个共享存储、网络和规格定义的容器</li><li><strong>深入理解</strong>：<ul><li><strong>Pod不是Docker Compose服务组</strong>：一个Pod通常对应一个应用实例，而不是多个相关服务</li><li><strong>紧密相关容器</strong>：Pod中的多个容器需要共享存储和网络，协同完成一个任务<ul><li>例如：主应用容器 + 日志收集容器（如Filebeat）</li><li>例如：主应用容器 + 代理容器（如Envoy）</li><li>例如：主应用容器 + Sidecar容器（如Istio Proxy）</li></ul></li><li><strong>共享资源</strong>：<ul><li>网络：Pod内所有容器共享IP地址和端口空间</li><li>存储：Pod内所有容器可以共享存储卷</li></ul></li><li><strong>生命周期</strong>：Pod中的容器一起启动、停止和重启</li><li><strong>Docker Compose到Kubernetes的映射</strong>：<ul><li>Docker Compose中的一个服务 → Kubernetes中的一个Pod</li><li>Docker Compose中的多个服务 → Kubernetes中的多个Pod + Service</li></ul></li></ul></li><li><strong>对应命令</strong>：<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 查看Pod</span></span><br><span class="line">kubectl get pods -n &lt;namespace&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看Pod详细信息</span></span><br><span class="line">kubectl describe pod &lt;pod-name&gt; -n &lt;namespace&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看Pod日志</span></span><br><span class="line">kubectl logs &lt;pod-name&gt; -n &lt;namespace&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 实时查看Pod日志</span></span><br><span class="line">kubectl logs -f &lt;pod-name&gt; -n &lt;namespace&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 进入Pod容器</span></span><br><span class="line">kubectl <span class="built_in">exec</span> -it &lt;pod-name&gt; -n &lt;namespace&gt; -- bash</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看Pod YAML配置</span></span><br><span class="line">kubectl get pod &lt;pod-name&gt; -n &lt;namespace&gt; -o yaml</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除Pod（Deployment会自动重建）</span></span><br><span class="line">kubectl delete pod &lt;pod-name&gt; -n &lt;namespace&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看Pod资源使用情况</span></span><br><span class="line">kubectl top pods -n &lt;namespace&gt;</span><br></pre></td></tr></tbody></table></figure></li></ul><h3 id="12-5-容器（Container）">12.5 容器（Container）</h3><ul><li><strong>定义</strong>：运行应用的轻量级虚拟化环境</li><li><strong>实际例子</strong>：my-web-app Pod中的web-container</li><li><strong>映射</strong>：Docker容器，运行具体的应用程序</li><li><strong>对应命令</strong>：<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 查看Pod中的容器</span></span><br><span class="line">kubectl get pods -n &lt;namespace&gt; -o jsonpath=<span class="string">'{.items[*].spec.containers[*].name}'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看特定容器的日志</span></span><br><span class="line">kubectl logs &lt;pod-name&gt; -c &lt;container-name&gt; -n &lt;namespace&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 进入特定容器</span></span><br><span class="line">kubectl <span class="built_in">exec</span> -it &lt;pod-name&gt; -c &lt;container-name&gt; -n &lt;namespace&gt; -- bash</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看容器镜像</span></span><br><span class="line">kubectl get pods -n &lt;namespace&gt; -o jsonpath=<span class="string">'{.items[*].spec.containers[*].image}'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看容器资源限制</span></span><br><span class="line">kubectl describe pod &lt;pod-name&gt; -n &lt;namespace&gt;</span><br></pre></td></tr></tbody></table></figure></li></ul><h3 id="12-6-服务（Service）">12.6 服务（Service）</h3><ul><li><strong>定义</strong>：定义一组Pod的逻辑集合和访问策略，提供稳定的网络端点</li><li><strong>实际例子</strong>：my-web-app-service，为my-web-app的Pod提供稳定的访问地址</li><li><strong>映射</strong>：类似负载均衡器或代理，为一组Pod提供稳定的IP和DNS名称</li><li><strong>深入理解</strong>：<ul><li><strong>服务发现</strong>：通过标签选择器（label selector）发现后端Pod</li><li><strong>负载均衡</strong>：在后端Pod间分发流量，但不使用传统负载均衡算法</li><li><strong>稳定端点</strong>：即使Pod被重新调度，Service的IP和DNS名称保持不变</li><li><strong>服务类型</strong>：<ul><li>ClusterIP：仅在集群内部访问</li><li>NodePort：在集群节点上开放端口</li><li>LoadBalancer：创建外部负载均衡器</li><li>ExternalName：将服务映射到外部DNS名称</li></ul></li><li><strong>与Docker Compose的映射</strong>：<ul><li>Docker Compose服务间的连接 → Kubernetes中使用Service</li><li>Docker Compose的links功能 → Kubernetes中使用Service DNS名称</li></ul></li></ul></li><li><strong>对应命令</strong>：<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 查看服务</span></span><br><span class="line">kubectl get services -n &lt;namespace&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看服务详细信息</span></span><br><span class="line">kubectl describe service &lt;service-name&gt; -n &lt;namespace&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看服务端点（后端Pod IP）</span></span><br><span class="line">kubectl get endpoints &lt;service-name&gt; -n &lt;namespace&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看服务YAML配置</span></span><br><span class="line">kubectl get service &lt;service-name&gt; -n &lt;namespace&gt; -o yaml</span><br><span class="line"></span><br><span class="line"><span class="comment"># 测试服务连通性</span></span><br><span class="line">kubectl run test-pod --image=busybox --<span class="built_in">rm</span> -it --restart=Never -- nslookup &lt;service-name&gt;.&lt;namespace&gt;.svc.cluster.local</span><br><span class="line"></span><br><span class="line"><span class="comment"># 端口转发到服务</span></span><br><span class="line">kubectl port-forward service/&lt;service-name&gt; 8080:80 -n &lt;namespace&gt;</span><br></pre></td></tr></tbody></table></figure></li></ul><h3 id="12-7-控制器（Controller）">12.7 控制器（Controller）</h3><ul><li><strong>定义</strong>：确保Pod按照预期状态运行的资源对象</li><li><strong>实际例子</strong>：Deployment、StatefulSet、DaemonSet等</li><li><strong>映射</strong>：Deployment控制器确保my-web-app始终有2个副本运行</li><li><strong>深入理解</strong>：<ul><li><strong>控制器类型</strong>：<ul><li>Deployment：管理无状态应用，支持滚动更新和回滚</li><li>StatefulSet：管理有状态应用，提供稳定的网络标识和持久存储</li><li>DaemonSet：确保所有节点运行一个Pod副本</li><li>Job/CronJob：管理一次性任务和定时任务</li></ul></li><li><strong>Pod调度与容灾</strong>：<ul><li>通过污点（Taints）和容忍度（Tolerations）控制Pod调度到特定节点</li><li>通过节点亲和性（Node Affinity）和反亲和性（Node Anti-Affinity）控制Pod部署位置</li><li>通过Pod反亲和性避免相同应用的Pod运行在同一节点上，实现容灾</li></ul></li><li><strong>与Docker Compose的映射</strong>：<ul><li>Docker Compose的replicas → Kubernetes中的Deployment replicas</li><li>Docker Compose的restart policy → Kubernetes的Pod重启策略</li></ul></li></ul></li><li><strong>对应命令</strong>：<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 查看Deployment</span></span><br><span class="line">kubectl get deployments -n &lt;namespace&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看Deployment详细信息</span></span><br><span class="line">kubectl describe deployment &lt;deployment-name&gt; -n &lt;namespace&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 扩容Deployment</span></span><br><span class="line">kubectl scale deployment &lt;deployment-name&gt; --replicas=5 -n &lt;namespace&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 更新Deployment镜像</span></span><br><span class="line">kubectl <span class="built_in">set</span> image deployment/&lt;deployment-name&gt; &lt;container-name&gt;=&lt;new-image&gt; -n &lt;namespace&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看Deployment升级历史</span></span><br><span class="line">kubectl rollout <span class="built_in">history</span> deployment &lt;deployment-name&gt; -n &lt;namespace&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 回滚Deployment</span></span><br><span class="line">kubectl rollout undo deployment &lt;deployment-name&gt; -n &lt;namespace&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 暂停/恢复Deployment rollout</span></span><br><span class="line">kubectl rollout pause deployment &lt;deployment-name&gt; -n &lt;namespace&gt;</span><br><span class="line">kubectl rollout resume deployment &lt;deployment-name&gt; -n &lt;namespace&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看控制器管理的Pod</span></span><br><span class="line">kubectl get pods -l &lt;label-key&gt;=&lt;label-value&gt; -n &lt;namespace&gt;</span><br></pre></td></tr></tbody></table></figure></li></ul><h3 id="12-8-配置和存储资源">12.8 配置和存储资源</h3><ul><li><strong>ConfigMap</strong>：存储非敏感配置数据</li><li><strong>Secret</strong>：存储敏感数据如密码、密钥</li><li><strong>PersistentVolume/PersistentVolumeClaim</strong>：提供持久化存储</li><li><strong>对应命令</strong>：<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># ConfigMap命令</span></span><br><span class="line"><span class="comment"># 查看ConfigMap</span></span><br><span class="line">kubectl get configmaps -n &lt;namespace&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看ConfigMap详细信息</span></span><br><span class="line">kubectl describe configmap &lt;configmap-name&gt; -n &lt;namespace&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建ConfigMap</span></span><br><span class="line">kubectl create configmap &lt;configmap-name&gt; --from-literal=key1=value1 --from-literal=key2=value2 -n &lt;namespace&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 从文件创建ConfigMap</span></span><br><span class="line">kubectl create configmap &lt;configmap-name&gt; --from-file=config.properties -n &lt;namespace&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Secret命令</span></span><br><span class="line"><span class="comment"># 查看Secret</span></span><br><span class="line">kubectl get secrets -n &lt;namespace&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看Secret详细信息</span></span><br><span class="line">kubectl describe secret &lt;secret-name&gt; -n &lt;namespace&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建Secret</span></span><br><span class="line">kubectl create secret generic &lt;secret-name&gt; --from-literal=key1=value1 -n &lt;namespace&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 从文件创建Secret</span></span><br><span class="line">kubectl create secret generic &lt;secret-name&gt; --from-file=ssh-privatekey=/path/to/key -n &lt;namespace&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看Secret内容（编码后的）</span></span><br><span class="line">kubectl get secret &lt;secret-name&gt; -n &lt;namespace&gt; -o yaml</span><br><span class="line"></span><br><span class="line"><span class="comment"># PersistentVolume/PersistentVolumeClaim命令</span></span><br><span class="line"><span class="comment"># 查看PersistentVolume</span></span><br><span class="line">kubectl get pv</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看PersistentVolumeClaim</span></span><br><span class="line">kubectl get pvc -n &lt;namespace&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看PersistentVolume详细信息</span></span><br><span class="line">kubectl describe pv &lt;pv-name&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看PersistentVolumeClaim详细信息</span></span><br><span class="line">kubectl describe pvc &lt;pvc-name&gt; -n &lt;namespace&gt;</span><br></pre></td></tr></tbody></table></figure></li></ul><h2 id="13-常见问题排查">13. 常见问题排查</h2><p>在运维Kubernetes集群和应用时，掌握常见问题排查方法非常重要。以下是几个关键的排查入口和技巧：</p><h3 id="13-1-从集群状态开始排查">13.1 从集群状态开始排查</h3><p>首先检查集群整体状态：</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 检查节点状态</span></span><br><span class="line">kubectl get nodes</span><br><span class="line"><span class="comment"># 确保所有节点处于Ready状态</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查核心组件状态</span></span><br><span class="line">kubectl get cs  <span class="comment"># (已弃用，使用下面的命令)</span></span><br><span class="line">kubectl get componentstatuses</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看所有命名空间</span></span><br><span class="line">kubectl get namespaces</span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查命名空间中的资源</span></span><br><span class="line">kubectl get all --all-namespaces</span><br></pre></td></tr></tbody></table></figure><h3 id="12-2-检查Pod状态和事件">12.2 检查Pod状态和事件</h3><p>Pod是最基本的部署单元，是排查问题的起点：</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 查看Pod状态</span></span><br><span class="line">kubectl get pods -n &lt;namespace&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看Pod详细信息和事件</span></span><br><span class="line">kubectl describe pod &lt;pod-name&gt; -n &lt;namespace&gt;</span><br><span class="line"><span class="comment"># 关注Events部分，通常包含错误信息</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查Pod的YAML定义</span></span><br><span class="line">kubectl get pod &lt;pod-name&gt; -n &lt;namespace&gt; -o yaml</span><br></pre></td></tr></tbody></table></figure><h3 id="12-3-查看应用日志">12.3 查看应用日志</h3><p>查看应用容器的日志是排查问题的重要手段：</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 查看Pod中主容器的日志</span></span><br><span class="line">kubectl logs &lt;pod-name&gt; -n &lt;namespace&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看Pod中指定容器的日志（多容器Pod）</span></span><br><span class="line">kubectl logs &lt;pod-name&gt; -c &lt;container-name&gt; -n &lt;namespace&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看最近的日志（例如最后100行）</span></span><br><span class="line">kubectl logs &lt;pod-name&gt; --<span class="built_in">tail</span>=100 -n &lt;namespace&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 实时查看日志流</span></span><br><span class="line">kubectl logs -f &lt;pod-name&gt; -n &lt;namespace&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看过去一小时的日志</span></span><br><span class="line">kubectl logs &lt;pod-name&gt; --since=1h -n &lt;namespace&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看重启前的容器日志</span></span><br><span class="line">kubectl logs &lt;pod-name&gt; --previous -n &lt;namespace&gt;</span><br></pre></td></tr></tbody></table></figure><h3 id="12-4-进入容器调试">12.4 进入容器调试</h3><p>当需要直接进入容器内部进行调试时：</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 进入容器执行交互式命令</span></span><br><span class="line">kubectl <span class="built_in">exec</span> -it &lt;pod-name&gt; -n &lt;namespace&gt; -- bash</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在容器中执行单个命令</span></span><br><span class="line">kubectl <span class="built_in">exec</span> &lt;pod-name&gt; -n &lt;namespace&gt; -- <span class="built_in">ls</span> -la /</span><br><span class="line"></span><br><span class="line"><span class="comment"># 进入多容器Pod中的指定容器</span></span><br><span class="line">kubectl <span class="built_in">exec</span> -it &lt;pod-name&gt; -c &lt;container-name&gt; -n &lt;namespace&gt; -- sh</span><br></pre></td></tr></tbody></table></figure><h3 id="12-5-检查资源使用情况">12.5 检查资源使用情况</h3><p>查看Pod和节点的资源使用情况：</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 查看Pod的资源使用情况</span></span><br><span class="line">kubectl top pods -n &lt;namespace&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看节点的资源使用情况</span></span><br><span class="line">kubectl top nodes</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取Pod的详细资源配额</span></span><br><span class="line">kubectl describe pod &lt;pod-name&gt; -n &lt;namespace&gt;</span><br><span class="line"><span class="comment"># 在"Conditions"和"QoS"部分查看资源相关信息</span></span><br></pre></td></tr></tbody></table></figure><h3 id="12-6-检查服务和网络">12.6 检查服务和网络</h3><p>排查服务访问和网络连接问题：</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 查看服务状态</span></span><br><span class="line">kubectl get svc -n &lt;namespace&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看服务详细信息</span></span><br><span class="line">kubectl describe svc &lt;service-name&gt; -n &lt;namespace&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 测试服务连通性（在集群内部）</span></span><br><span class="line">kubectl run test-pod --image=busybox --<span class="built_in">rm</span> -it --restart=Never -- nslookup &lt;service-name&gt;.&lt;namespace&gt;.svc.cluster.local</span><br><span class="line"></span><br><span class="line"><span class="comment"># 端口转发进行本地测试</span></span><br><span class="line">kubectl port-forward &lt;pod-name&gt; 8080:80 -n &lt;namespace&gt;</span><br></pre></td></tr></tbody></table></figure><h3 id="12-7-检查配置和密钥">12.7 检查配置和密钥</h3><p>验证配置和密钥是否正确挂载到Pod中：</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 查看ConfigMap内容</span></span><br><span class="line">kubectl get configmap &lt;configmap-name&gt; -n &lt;namespace&gt; -o yaml</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看Secret内容（注意敏感信息）</span></span><br><span class="line">kubectl get secret &lt;secret-name&gt; -n &lt;namespace&gt; -o yaml</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在Pod中检查挂载的配置</span></span><br><span class="line">kubectl <span class="built_in">exec</span> -it &lt;pod-name&gt; -n &lt;namespace&gt; -- <span class="built_in">ls</span> /etc/config</span><br></pre></td></tr></tbody></table></figure><h3 id="12-8-排查常见问题">12.8 排查常见问题</h3><h4 id="Pod处于Pending状态">Pod处于Pending状态</h4><ul><li>检查是否有足够的资源</li><li>检查节点选择器和污点容忍度配置</li></ul><h4 id="Pod处于CrashLoopBackOff状态">Pod处于CrashLoopBackOff状态</h4><ul><li>查看容器日志</li><li>检查启动脚本和配置</li><li>检查资源限制是否过小</li></ul><h4 id="Pod处于ImagePullBackOff状态">Pod处于ImagePullBackOff状态</h4><ul><li>检查镜像名称和标签是否正确</li><li>检查镜像仓库访问权限</li></ul><h4 id="服务无法访问">服务无法访问</h4><ul><li>检查Service和Pod的标签选择器是否匹配</li><li>检查端口配置是否正确</li><li>验证网络策略是否有误</li></ul><h3 id="12-9-使用Sealos排查集群问题">12.9 使用Sealos排查集群问题</h3><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 检查Sealos集群状态</span></span><br><span class="line">sealos status</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在节点上执行命令</span></span><br><span class="line">sealos <span class="built_in">exec</span> --hosts 192.168.1.100 <span class="string">"systemctl status kubelet"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看集群证书信息</span></span><br><span class="line">sealos cert</span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查节点是否正常</span></span><br><span class="line">kubectl get nodes -o wide</span><br></pre></td></tr></tbody></table></figure><h2 id="13-最佳实践">13. 最佳实践</h2><ol><li><strong>安全</strong>：始终使用RBAC控制访问权限，定期更新证书和密钥</li><li><strong>监控</strong>：部署Prometheus和Grafana等监控工具</li><li><strong>日志</strong>：使用EFK（Elasticsearch, Fluentd, Kibana）收集和分析日志</li><li><strong>备份</strong>：定期备份重要数据和配置</li><li><strong>网络策略</strong>：配置网络策略以限制Pod间通信</li><li><strong>资源管理</strong>：使用ResourceQuota和LimitRange控制资源使用</li></ol><p>通过遵循这些最佳实践，可以构建一个安全、可靠、高效且易于维护的Kubernetes集群。</p>]]></content>
      
      
      
        <tags>
            
            <tag> k8s </tag>
            
            <tag> sealos </tag>
            
            <tag> 运维 </tag>
            
            <tag> 部署 </tag>
            
            <tag> 容器化 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>k8s命令集合</title>
      <link href="/2025/12/07/0003-k8s-ming-ling-ji-he/"/>
      <url>/2025/12/07/0003-k8s-ming-ling-ji-he/</url>
      
        <content type="html"><![CDATA[<h1>Docker 命令集合</h1><h2 id="1-系统信息查看命令">1. 系统信息查看命令</h2><p><strong>命令格式：</strong></p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">docker version</span><br><span class="line">docker info</span><br></pre></td></tr></tbody></table></figure><p><strong>功能说明：</strong></p><ul><li><code>docker version</code>: 查看Docker客户端和服务器的版本信息</li><li><code>docker info</code>: 显示Docker系统详细信息，包括容器、镜像数量，存储驱动，网络配置等</li></ul><p><strong>使用场景：</strong></p><ul><li>检查Docker安装是否成功</li><li>查看Docker版本及系统配置</li><li>排查Docker相关问题时获取系统信息</li></ul><h2 id="2-镜像管理命令">2. 镜像管理命令</h2><p><strong>命令格式：</strong></p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">docker images           <span class="comment"># 列出本地镜像</span></span><br><span class="line">docker pull &lt;镜像名&gt;    <span class="comment"># 下载镜像</span></span><br><span class="line">docker search &lt;镜像名&gt;  <span class="comment"># 搜索镜像</span></span><br><span class="line">docker rmi &lt;镜像ID或名称&gt; <span class="comment"># 删除镜像</span></span><br><span class="line">docker commit &lt;容器ID&gt; &lt;新镜像名&gt; <span class="comment"># 从容器创建新镜像</span></span><br><span class="line">docker save -o &lt;文件名&gt; &lt;镜像名&gt; <span class="comment"># 保存镜像为tar文件</span></span><br><span class="line">docker load -i &lt;文件名&gt; <span class="comment"># 从tar文件加载镜像</span></span><br><span class="line">docker build -t &lt;镜像名&gt; . <span class="comment"># 从Dockerfile构建镜像</span></span><br></pre></td></tr></tbody></table></figure><p><strong>功能说明：</strong></p><ul><li><code>docker images</code>: 列出本地所有镜像</li><li><code>docker pull</code>: 从仓库下载镜像</li><li><code>docker search</code>: 在Docker Hub搜索镜像</li><li><code>docker rmi</code>: 删除本地镜像</li><li><code>docker commit</code>: 从容器创建新镜像</li><li><code>docker save/load</code>: 镜像的导入导出</li><li><code>docker build</code>: 从Dockerfile构建镜像</li></ul><p><strong>使用场景：</strong></p><ul><li>下载和管理Docker镜像</li><li>构建和分享自定义镜像</li><li>镜像的备份和迁移</li></ul><h2 id="3-容器管理命令">3. 容器管理命令</h2><p><strong>命令格式：</strong></p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">docker run [OPTIONS] &lt;镜像名&gt; [命令] <span class="comment"># 运行容器</span></span><br><span class="line">docker ps [-a] <span class="comment"># 列出容器</span></span><br><span class="line">docker start &lt;容器ID或名称&gt; <span class="comment"># 启动容器</span></span><br><span class="line">docker stop &lt;容器ID或名称&gt; <span class="comment"># 停止容器</span></span><br><span class="line">docker restart &lt;容器ID或名称&gt; <span class="comment"># 重启容器</span></span><br><span class="line">docker <span class="built_in">kill</span> &lt;容器ID或名称&gt; <span class="comment"># 强制停止容器</span></span><br><span class="line">docker <span class="built_in">rm</span> &lt;容器ID或名称&gt; <span class="comment"># 删除容器</span></span><br><span class="line">docker pause &lt;容器ID&gt; <span class="comment"># 暂停容器</span></span><br><span class="line">docker unpause &lt;容器ID&gt; <span class="comment"># 恢复容器</span></span><br></pre></td></tr></tbody></table></figure><p><strong>功能说明：</strong></p><ul><li><code>docker run</code>: 创建并运行容器</li><li><code>docker ps</code>: 列出正在运行的容器，-a显示所有容器</li><li><code>docker start/stop/restart</code>: 容器的基本操作</li><li><code>docker kill</code>: 立即终止容器</li><li><code>docker rm</code>: 删除已停止的容器</li><li><code>docker pause/unpause</code>: 暂停/恢复容器</li></ul><p><strong>使用场景：</strong></p><ul><li>启动、停止和管理容器</li><li>部署和运行应用程序</li><li>容器生命周期管理</li></ul><h2 id="4-容器交互命令">4. 容器交互命令</h2><p><strong>命令格式：</strong></p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> [OPTIONS] &lt;容器ID或名称&gt; &lt;命令&gt;</span><br><span class="line">docker attach &lt;容器ID或名称&gt;</span><br><span class="line">docker logs &lt;容器ID或名称&gt;</span><br><span class="line">docker top &lt;容器ID或名称&gt;</span><br><span class="line">docker stats &lt;容器ID或名称&gt; <span class="comment"># 查看容器资源使用情况</span></span><br></pre></td></tr></tbody></table></figure><p><strong>功能说明：</strong></p><ul><li><code>docker exec</code>: 在运行的容器中执行命令</li><li><code>docker attach</code>: 连接到正在运行的容器</li><li><code>docker logs</code>: 查看容器日志</li><li><code>docker top</code>: 显示容器内的进程</li><li><code>docker stats</code>: 实时监控容器资源使用</li></ul><p><strong>使用场景：</strong></p><ul><li>进入容器内部进行调试</li><li>查看容器运行状态和日志</li><li>监控容器内进程和资源使用</li></ul><h2 id="5-网络和存储命令">5. 网络和存储命令</h2><p><strong>命令格式：</strong></p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">docker network <span class="built_in">ls</span></span><br><span class="line">docker network create &lt;网络名&gt;</span><br><span class="line">docker network <span class="built_in">rm</span> &lt;网络名&gt;</span><br><span class="line">docker volume <span class="built_in">ls</span></span><br><span class="line">docker volume create &lt;卷名&gt;</span><br><span class="line">docker volume <span class="built_in">rm</span> &lt;卷名&gt;</span><br><span class="line">docker volume prune <span class="comment"># 清理未使用的卷</span></span><br></pre></td></tr></tbody></table></figure><p><strong>功能说明：</strong></p><ul><li><code>docker network</code>: 管理Docker网络</li><li><code>docker volume</code>: 管理Docker数据卷</li><li><code>docker volume prune</code>: 清理未使用的卷</li></ul><p><strong>使用场景：</strong></p><ul><li>创建和管理容器网络</li><li>数据持久化存储</li><li>容器间通信配置</li></ul><h2 id="6-其他重要运维命令">6. 其他重要运维命令</h2><p><strong>命令格式：</strong></p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">docker inspect &lt;容器ID或镜像ID&gt; <span class="comment"># 查看详细配置信息</span></span><br><span class="line">docker <span class="built_in">cp</span> &lt;源&gt; &lt;目标&gt; <span class="comment"># 在容器和主机间复制文件</span></span><br><span class="line">docker tag &lt;源镜像&gt; &lt;目标镜像&gt; <span class="comment"># 为镜像打标签</span></span><br><span class="line">docker system <span class="built_in">df</span> <span class="comment"># 查看Docker磁盘使用情况</span></span><br><span class="line">docker system prune <span class="comment"># 清理未使用的资源</span></span><br></pre></td></tr></tbody></table></figure><p><strong>功能说明：</strong></p><ul><li><code>docker inspect</code>: 查看对象（容器、镜像、网络等）的详细配置</li><li><code>docker cp</code>: 文件在容器和主机间复制</li><li><code>docker tag</code>: 为镜像添加标签</li><li><code>docker system df</code>: 查看Docker磁盘使用情况</li><li><code>docker system prune</code>: 清理未使用的资源</li></ul><p><strong>使用场景：</strong></p><ul><li>监控容器性能</li><li>查看和调试容器、镜像配置</li><li>数据备份和迁移</li><li>系统资源管理和清理</li></ul><h2 id="7-安全和登录命令">7. 安全和登录命令</h2><p><strong>命令格式：</strong></p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">docker login [SERVER]</span><br><span class="line">docker <span class="built_in">logout</span> [SERVER]</span><br><span class="line">docker events</span><br><span class="line">docker run --<span class="built_in">rm</span> -it alpine:latest <span class="comment"># 临时运行容器</span></span><br></pre></td></tr></tbody></table></figure><p><strong>功能说明：</strong></p><ul><li><code>docker login</code>: 登录Docker仓库</li><li><code>docker logout</code>: 退出Docker仓库</li><li><code>docker events</code>: 获取实时事件</li><li>在运行命令中使用<code>--rm</code>选项自动删除容器</li></ul><p><strong>使用场景：</strong></p><ul><li>推送镜像到私有仓库</li><li>安全认证</li><li>监控Docker活动</li><li>临时任务执行</li></ul><h1>Sealos 命令集合</h1><h2 id="1-集群管理命令">1. 集群管理命令</h2><p><strong>命令格式：</strong></p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">sealos run &lt;镜像名&gt; [可选参数] <span class="comment"># 运行集群镜像，快速部署应用</span></span><br><span class="line">sealos apply -f Clusterfile <span class="comment"># 使用Clusterfile运行集群镜像</span></span><br><span class="line">sealos reset <span class="comment"># 重置集群中的所有内容</span></span><br><span class="line">sealos status <span class="comment"># 查看Sealos集群的状态</span></span><br><span class="line">sealos cert <span class="comment"># 更新Kubernetes API服务器的证书</span></span><br><span class="line">sealos gen <span class="comment"># 生成具有所有默认设置的Clusterfile</span></span><br></pre></td></tr></tbody></table></figure><p><strong>功能说明：</strong></p><ul><li><code>sealos run</code>: 轻松运行云原生应用，是部署集群的常用方式</li><li><code>sealos apply</code>: 使用Clusterfile在Kubernetes集群内运行集群镜像</li><li><code>sealos reset</code>: 完全清理集群，重置到初始状态</li><li><code>sealos status</code>: 检查当前集群的状态</li><li><code>sealos cert</code>: 更新集群API服务器的证书</li><li><code>sealos gen</code>: 生成集群配置文件模板</li></ul><p><strong>使用场景：</strong></p><ul><li>部署和初始化Kubernetes集群</li><li>集群状态检查和维护</li><li>证书更新和管理</li><li>集群配置文件创建</li></ul><h2 id="2-节点管理命令">2. 节点管理命令</h2><p><strong>命令格式：</strong></p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">sealos add --masters &lt;IP列表&gt; <span class="comment"># 添加master节点到集群</span></span><br><span class="line">sealos add --nodes &lt;IP列表&gt; <span class="comment"># 添加node节点到集群</span></span><br><span class="line">sealos delete --masters &lt;IP列表&gt; <span class="comment"># 从集群中删除master节点</span></span><br><span class="line">sealos delete --nodes &lt;IP列表&gt; <span class="comment"># 从集群中删除node节点</span></span><br><span class="line">sealos <span class="built_in">exec</span> -m <span class="string">"command"</span> <span class="comment"># 在所有master节点上执行命令</span></span><br><span class="line">sealos <span class="built_in">exec</span> -n <span class="string">"command"</span> <span class="comment"># 在所有node节点上执行命令</span></span><br></pre></td></tr></tbody></table></figure><p><strong>功能说明：</strong></p><ul><li><code>sealos add</code>: 向集群中添加master或node节点</li><li><code>sealos delete</code>: 从集群中删除master或node节点</li><li><code>sealos exec</code>: 在特定类型的节点上执行命令</li></ul><p><strong>使用场景：</strong></p><ul><li>集群水平扩展，增加节点</li><li>节点维护或故障后移除节点</li><li>在集群节点上执行维护任务</li></ul><h2 id="3-远程操作命令">3. 远程操作命令</h2><p><strong>命令格式：</strong></p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">sealos <span class="built_in">exec</span> --hosts &lt;IP地址&gt; <span class="string">"command"</span> <span class="comment"># 在指定节点上执行命令</span></span><br><span class="line">sealos scp &lt;本地文件&gt; &lt;节点IP:远程路径&gt; <span class="comment"># 将文件复制到指定节点</span></span><br><span class="line">sealos scp &lt;节点IP:远程文件&gt; &lt;本地路径&gt; <span class="comment"># 从指定节点复制文件</span></span><br></pre></td></tr></tbody></table></figure><p><strong>功能说明：</strong></p><ul><li><code>sealos exec</code>: 在远程节点上执行shell命令或脚本</li><li><code>sealos scp</code>: 在本地与节点之间复制文件</li></ul><p><strong>使用场景：</strong></p><ul><li>在远程节点上执行诊断或管理任务</li><li>向节点传输配置文件或脚本</li><li>远程收集日志或配置文件</li></ul><h2 id="4-容器和镜像命令">4. 容器和镜像命令</h2><p><strong>命令格式：</strong></p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">sealos images <span class="comment"># 列出本地存储中的镜像</span></span><br><span class="line">sealos pull &lt;镜像名&gt; <span class="comment"># 从指定位置拉取镜像</span></span><br><span class="line">sealos push &lt;镜像名&gt; &lt;目标地址&gt; <span class="comment"># 将镜像推送到指定的目标</span></span><br><span class="line">sealos rmi &lt;镜像名或ID&gt; <span class="comment"># 从本地存储中删除一个或多个镜像</span></span><br><span class="line">sealos save -o &lt;文件名&gt; &lt;镜像名&gt; <span class="comment"># 将镜像保存到存档文件中</span></span><br><span class="line">sealos load -i &lt;文件名&gt; <span class="comment"># 从文件中加载镜像</span></span><br><span class="line">sealos tag &lt;源镜像&gt; &lt;目标镜像&gt; <span class="comment"># 为本地镜像添加一个附加名称</span></span><br><span class="line">sealos build -t &lt;镜像名&gt; . <span class="comment"># 构建自定义集群镜像</span></span><br></pre></td></tr></tbody></table></figure><p><strong>功能说明：</strong></p><ul><li><code>sealos images/pull/push/rmi/save/load/tag</code>: 镜像的基本操作</li><li><code>sealos build</code>: 使用Sealfile或Kubefile构建集群镜像</li></ul><p><strong>使用场景：</strong></p><ul><li>集群镜像管理</li><li>构建和推送自定义集群镜像</li><li>镜像的备份和迁移</li></ul><h2 id="5-其他辅助命令">5. 其他辅助命令</h2><p><strong>命令格式：</strong></p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">sealos completion &lt;shell&gt; <span class="comment"># 为指定的shell生成自动补全脚本</span></span><br><span class="line">sealos version <span class="comment"># 打印版本信息</span></span><br><span class="line">sealos <span class="built_in">env</span> <span class="comment"># 打印Sealos使用的所有环境信息</span></span><br><span class="line">sealos login &lt;仓库地址&gt; <span class="comment"># 登录到容器仓库</span></span><br><span class="line">sealos <span class="built_in">logout</span> <span class="comment"># 登出容器仓库</span></span><br><span class="line">sealos inspect &lt;镜像名&gt; <span class="comment"># 检查容器或镜像的配置</span></span><br></pre></td></tr></tbody></table></figure><p><strong>功能说明：</strong></p><ul><li><code>sealos completion</code>: 配置命令行自动补全功能</li><li><code>sealos version/env</code>: 检查版本和环境信息</li><li><code>sealos login/logout</code>: 容器仓库认证</li><li><code>sealos inspect</code>: 查看镜像或容器的详细配置</li></ul><p><strong>使用场景：</strong></p><ul><li>提高命令行操作效率</li><li>检查Sealos安装和配置</li><li>仓库访问认证</li><li>镜像详细信息查看</li></ul><h1>Kubectl 命令集合</h1><h2 id="1-基础语法">1. 基础语法</h2><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">kubectl [command] [TYPE] [NAME] [flags]</span><br></pre></td></tr></tbody></table></figure><ul><li><strong>command</strong>：指定要对一个或多个资源执行的操作，如create、get、describe和delete</li><li><strong>TYPE</strong>：指定资源类型，不区分大小写，可以为单数、复数或缩写形式</li><li><strong>NAME</strong>：指定资源的名称，区分大小写，若省略则显示所有资源</li><li><strong>flags</strong>：指定可选参数，如-s或–server参数指定Kubernetes API服务器的地址和端口</li></ul><h2 id="2-资源查看与查询命令">2. 资源查看与查询命令</h2><p><strong>命令格式：</strong></p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">kubectl get pods -A                    <span class="comment"># 列出所有命名空间中的Pod</span></span><br><span class="line">kubectl get nodes                      <span class="comment"># 获取所有节点信息</span></span><br><span class="line">kubectl get deployments -n namespace   <span class="comment"># 获取指定命名空间下的部署信息</span></span><br><span class="line">kubectl get services                   <span class="comment"># 获取服务信息</span></span><br><span class="line">kubectl get pv,pvc                     <span class="comment"># 获取持久卷和持久卷申领信息</span></span><br><span class="line">kubectl get all -n namespace           <span class="comment"># 获取指定命名空间下所有资源</span></span><br><span class="line">kubectl get pods --watch               <span class="comment"># 实时监控Pod状态变化</span></span><br><span class="line">kubectl get events                     <span class="comment"># 查看集群事件</span></span><br></pre></td></tr></tbody></table></figure><p><strong>功能说明：</strong></p><ul><li><code>kubectl get</code>: 获取资源对象的基本信息</li><li>支持各种资源类型（pods, services, deployments等）</li></ul><p><strong>使用场景：</strong></p><ul><li>检查集群整体运行状况</li><li>查看节点健康状态</li><li>检查应用部署状态</li><li>查看服务暴露情况</li></ul><h2 id="3-资源创建与管理命令">3. 资源创建与管理命令</h2><p><strong>命令格式：</strong></p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">kubectl create -f resource.yaml                    <span class="comment"># 从配置文件创建资源</span></span><br><span class="line">kubectl apply -f resource.yaml                    <span class="comment"># 应用资源配置(创建或更新)</span></span><br><span class="line">kubectl apply -f &lt;directory&gt;                      <span class="comment"># 应用目录下所有配置文件</span></span><br><span class="line">kubectl delete pod pod_name                       <span class="comment"># 删除指定Pod</span></span><br><span class="line">kubectl delete -f resource.yaml                   <span class="comment"># 从配置文件删除资源</span></span><br><span class="line">kubectl scale deployment deployment_name --replicas=N  <span class="comment"># 扩缩容部署副本数</span></span><br><span class="line">kubectl expose deployment deployment_name --port=port   <span class="comment"># 暴露服务</span></span><br><span class="line">kubectl label pods pod_name key=value             <span class="comment"># 为Pod添加标签</span></span><br><span class="line">kubectl annotate pods pod_name key=value          <span class="comment"># 为Pod添加注解</span></span><br></pre></td></tr></tbody></table></figure><p><strong>功能说明：</strong></p><ul><li><code>kubectl create/apply</code>: 创建或更新资源对象</li><li><code>kubectl delete</code>: 删除资源对象</li><li><code>kubectl scale</code>: 调整应用副本数量</li><li><code>kubectl expose</code>: 创建Service关联Deployment</li></ul><p><strong>使用场景：</strong></p><ul><li>从配置文件创建资源</li><li>生产环境推荐使用apply进行更新</li><li>动态调整应用负载能力</li><li>删除异常或不需要的资源</li></ul><h2 id="4-资源描述与调试命令">4. 资源描述与调试命令</h2><p><strong>命令格式：</strong></p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">kubectl describe pod pod_name                       <span class="comment"># 显示Pod详细信息和事件</span></span><br><span class="line">kubectl describe node node_name                   <span class="comment"># 显示节点详细信息</span></span><br><span class="line">kubectl describe deployment deployment_name       <span class="comment"># 显示部署详细信息</span></span><br><span class="line">kubectl logs pod_name                             <span class="comment"># 查看Pod日志</span></span><br><span class="line">kubectl logs pod_name -f                          <span class="comment"># 实时查看Pod日志流</span></span><br><span class="line">kubectl logs pod_name --<span class="built_in">tail</span>=100                  <span class="comment"># 查看Pod最后100行日志</span></span><br><span class="line">kubectl <span class="built_in">exec</span> -it pod_name -- bash                 <span class="comment"># 进入Pod执行交互命令</span></span><br><span class="line">kubectl <span class="built_in">exec</span> -it pod_name -- sh                   <span class="comment"># 进入Pod执行sh命令</span></span><br><span class="line">kubectl port-forward pod_name local_port:pod_port <span class="comment"># 端口转发到本地</span></span><br><span class="line">kubectl <span class="built_in">cp</span> /path/to/file &lt;pod&gt;:/path/to/file      <span class="comment"># 在Pod和本地间复制文件</span></span><br><span class="line">kubectl top nodes                                 <span class="comment"># 显示节点资源使用情况</span></span><br><span class="line">kubectl top pods -n namespace                     <span class="comment"># 显示Pod资源使用情况</span></span><br></pre></td></tr></tbody></table></figure><p><strong>功能说明：</strong></p><ul><li><code>kubectl describe</code>: 显示资源的详细配置和状态信息</li><li><code>kubectl logs</code>: 查看容器日志</li><li><code>kubectl exec</code>: 在Pod中执行命令</li><li><code>kubectl port-forward</code>: 端口转发用于调试</li><li><code>kubectl top</code>: 显示资源使用情况</li></ul><p><strong>使用场景：</strong></p><ul><li>排查Pod启动失败问题</li><li>查看应用运行状态和资源使用</li><li>调试容器内部环境</li><li>实时监控应用输出</li><li>本地调试集群内服务</li></ul><h2 id="5-配置与更新命令">5. 配置与更新命令</h2><p><strong>命令格式：</strong></p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">kubectl <span class="built_in">set</span> image deployment/deployment_name container_name=image:newtag  <span class="comment"># 更新部署的镜像</span></span><br><span class="line">kubectl patch deployment deployment_name -p <span class="string">'{"spec":{"replicas":3}}'</span>    <span class="comment"># 部分更新资源</span></span><br><span class="line">kubectl rollout <span class="built_in">history</span> deployment deployment_name                        <span class="comment"># 查看部署历史</span></span><br><span class="line">kubectl rollout undo deployment deployment_name                           <span class="comment"># 回滚到上一个版本</span></span><br><span class="line">kubectl rollout undo deployment deployment_name --to-revision=N           <span class="comment"># 回滚到指定版本</span></span><br><span class="line">kubectl rollout status deployment deployment_name                         <span class="comment"># 查看滚动更新状态</span></span><br><span class="line">kubectl <span class="built_in">set</span> <span class="built_in">env</span> deployment/deployment_name ENV_NAME=ENV_VALUE            <span class="comment"># 设置环境变量</span></span><br><span class="line">kubectl <span class="built_in">set</span> resources deployment/deployment_name --limits=cpu=200m      <span class="comment"># 设置资源限制</span></span><br><span class="line">kubectl patch pod pod_name -p <span class="string">'{"spec":{"activeDeadlineSeconds":100}}'</span>   <span class="comment"># 部分更新Pod</span></span><br></pre></td></tr></tbody></table></figure><p><strong>功能说明：</strong></p><ul><li><code>kubectl set image</code>: 更新部署的镜像</li><li><code>kubectl patch</code>: 部分更新资源配置</li><li><code>kubectl rollout</code>: 管理部署的滚动更新和回滚</li><li><code>kubectl set env/resources</code>: 设置环境变量和资源限制</li></ul><p><strong>使用场景：</strong></p><ul><li>灰度发布新版本</li><li>回滚故障更新</li><li>监控更新进度</li><li>修改资源配置</li></ul><h2 id="6-节点与集群管理命令">6. 节点与集群管理命令</h2><p><strong>命令格式：</strong></p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">kubectl cordon node_name                    <span class="comment"># 标记节点不可调度</span></span><br><span class="line">kubectl uncordon node_name                  <span class="comment"># 标记节点可调度</span></span><br><span class="line">kubectl drain node_name                     <span class="comment"># 安全排空节点</span></span><br><span class="line">kubectl taint nodes node_name key=value:NoSchedule  <span class="comment"># 给节点添加污点</span></span><br><span class="line">kubectl cluster-info                        <span class="comment"># 显示主控节点和服务信息</span></span><br><span class="line">kubectl config view                         <span class="comment"># 查看kubeconfig配置</span></span><br><span class="line">kubectl config get-contexts                 <span class="comment"># 列出kubeconfig中的上下文</span></span><br><span class="line">kubectl config use-context context-name     <span class="comment"># 切换当前上下文</span></span><br><span class="line">kubectl version                             <span class="comment"># 显示客户端和服务端版本</span></span><br></pre></td></tr></tbody></table></figure><p><strong>功能说明：</strong></p><ul><li><code>kubectl cordon/uncordon</code>: 标记节点可调度或不可调度</li><li><code>kubectl drain</code>: 安全驱逐节点上的Pod</li><li><code>kubectl taint</code>: 给节点添加污点</li><li><code>kubectl cluster-info/config</code>: 查看集群和配置信息</li></ul><p><strong>使用场景：</strong></p><ul><li>维护前排空节点</li><li>恢复节点调度</li><li>节点维护前安全驱逐Pod</li><li>集群配置管理</li></ul><h2 id="7-配置管理与网络命令">7. 配置管理与网络命令</h2><p><strong>命令格式：</strong></p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">kubectl create configmap name --from-file=file         <span class="comment"># 创建ConfigMap</span></span><br><span class="line">kubectl create configmap name --from-literal=key=val   <span class="comment"># 创建键值对ConfigMap</span></span><br><span class="line">kubectl create secret generic name --from-literal=key=val <span class="comment"># 创建Secret</span></span><br><span class="line">kubectl create secret generic name --from-file=file    <span class="comment"># 从文件创建Secret</span></span><br><span class="line">kubectl get configmaps -n namespace                   <span class="comment"># 获取ConfigMap</span></span><br><span class="line">kubectl get secrets -n namespace                      <span class="comment"># 获取Secret</span></span><br><span class="line">kubectl get ingress                                   <span class="comment"># 获取入口资源</span></span><br><span class="line">kubectl get networkpolicy                             <span class="comment"># 获取网络策略</span></span><br><span class="line">kubectl create -f service-account.yaml                <span class="comment"># 创建服务账户</span></span><br><span class="line">kubectl get serviceaccount -n namespace               <span class="comment"># 获取服务账户</span></span><br></pre></td></tr></tbody></table></figure><p><strong>功能说明：</strong></p><ul><li><code>kubectl create configmap/secret</code>: 创建配置和密钥</li><li><code>kubectl get ingress/networkpolicy</code>: 获取网络相关资源</li><li><code>kubectl create/get serviceaccount</code>: 管理服务账户</li></ul><p><strong>使用场景：</strong></p><ul><li>管理配置文件和敏感信息</li><li>控制应用网络访问</li><li>权限管理</li></ul><h2 id="8-调试和排错命令">8. 调试和排错命令</h2><p><strong>命令格式：</strong></p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">kubectl debug node/node_name -it --image=busybox    <span class="comment"># 调试节点</span></span><br><span class="line">kubectl debug pod_name -it --image=busybox          <span class="comment"># 调试Pod</span></span><br><span class="line">kubectl get componentstatuses                     <span class="comment"># 查看集群组件状态</span></span><br><span class="line">kubectl get pods --field-selector status.phase!=Running <span class="comment"># 查找非运行状态Pod</span></span><br><span class="line">kubectl get pods --field-selector spec.nodeName=&lt;node-name&gt; <span class="comment"># 查找节点上Pod</span></span><br><span class="line">kubectl events --<span class="keyword">for</span> pod/pod_name                 <span class="comment"># 查看Pod事件</span></span><br></pre></td></tr></tbody></table></figure><p><strong>功能说明：</strong></p><ul><li><code>kubectl debug</code>: 创建调试Pod用于排错</li><li><code>kubectl get componentstatuses</code>: 检查集群组件状态</li><li>字段选择器: 通过字段筛选资源</li></ul><p><strong>使用场景：</strong></p><ul><li>调试集群节点和Pod</li><li>排查集群组件问题</li><li>查找特定状态的资源</li></ul><h1>结论</h1><p>本文档全面总结了Docker、Sealos和Kubectl三个重要工具的运维命令，涵盖了从基础操作到高级管理的各个方面。这些命令是云原生运维工程师必须掌握的核心技能，熟练使用这些命令可以有效提高日常运维效率，保障应用的稳定运行。</p><h2 id="常用运维流程示例">常用运维流程示例</h2><h3 id="1-应用部署流程">1. 应用部署流程</h3><ol><li>使用Docker构建应用镜像</li><li>使用Sealos部署Kubernetes集群</li><li>使用Kubectl部署应用到集群</li></ol><h3 id="2-问题排查流程">2. 问题排查流程</h3><ol><li>使用kubectl get pods检查Pod状态</li><li>使用kubectl describe pod查看详情</li><li>使用kubectl logs查看日志</li><li>使用kubectl exec进入Pod调试</li></ol><h3 id="3-集群维护流程">3. 集群维护流程</h3><ol><li>使用kubectl cordon标记节点不可调度</li><li>使用kubectl drain安全排空节点</li><li>维护完成后使用kubectl uncordon恢复节点调度</li><li>使用sealos exec在节点上执行维护命令</li></ol><p>掌握这些命令和流程，可以有效提升Kubernetes集群和应用的管理效率。</p>]]></content>
      
      
      
        <tags>
            
            <tag> k8s </tag>
            
            <tag> docker </tag>
            
            <tag> sealos </tag>
            
            <tag> kubectl </tag>
            
            <tag> 运维 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>本地安装sealos记录</title>
      <link href="/2025/12/07/0002-ben-di-an-zhuang-sealos-ji-lu/"/>
      <url>/2025/12/07/0002-ben-di-an-zhuang-sealos-ji-lu/</url>
      
        <content type="html"><![CDATA[<h1>Sealos和Kubernetes本地安装记录</h1><h2 id="目的">目的</h2><p>本记录详细说明了如何在本地环境中安装Sealos和Kubernetes。我们将提供一个简洁实用的安装流程，以确保成功搭建Kubernetes环境。</p><h2 id="环境要求">环境要求</h2><ul><li>Ubuntu 22.04 LTS 或更高版本</li><li>至少4GB RAM和2个CPU核心</li><li>至少40GB可用磁盘空间</li><li>能够访问网络以下载组件</li><li>root权限或sudo权限</li></ul><h2 id="系统准备">系统准备</h2><h3 id="1-更新系统包">1. 更新系统包</h3><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt update &amp;&amp; <span class="built_in">sudo</span> apt upgrade -y</span><br></pre></td></tr></tbody></table></figure><h3 id="2-安装必要工具">2. 安装必要工具</h3><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt install -y curl wget apt-transport-https ca-certificates</span><br></pre></td></tr></tbody></table></figure><h2 id="安装Sealos">安装Sealos</h2><h3 id="1-安装依赖">1. 安装依赖</h3><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt install -y uidmap fuse-overlayfs</span><br></pre></td></tr></tbody></table></figure><h3 id="2-下载并安装Sealos">2. 下载并安装Sealos</h3><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 方式1: 从官方源下载</span></span><br><span class="line">wget https://github.com/labring/sealos/releases/download/v5.0.0/sealos_5.0.0_linux_amd64.deb</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装deb包</span></span><br><span class="line"><span class="built_in">sudo</span> dpkg -i sealos_5.0.0_linux_amd64.deb</span><br></pre></td></tr></tbody></table></figure><h3 id="3-验证安装">3. 验证安装</h3><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">sealos version</span><br></pre></td></tr></tbody></table></figure><p>如果成功，应该能看到Sealos的版本信息。</p><h2 id="安装Kubernetes">安装Kubernetes</h2><h3 id="1-配置系统参数">1. 配置系统参数</h3><p>由于Sealos运行Kubernetes需要纯净环境，我们需要确保系统配置正确：</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 关闭交换分区（Kubernetes要求）</span></span><br><span class="line"><span class="built_in">sudo</span> swapoff -a</span><br><span class="line"></span><br><span class="line"><span class="comment"># 永久禁用交换分区（添加到fstab注释）</span></span><br><span class="line"><span class="built_in">sudo</span> sed -i <span class="string">'/ swap / s/^\(.*\)$/#\1/g'</span> /etc/fstab</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启用内核模块</span></span><br><span class="line"><span class="built_in">sudo</span> modprobe overlay</span><br><span class="line"><span class="built_in">sudo</span> modprobe br_netfilter</span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置内核参数</span></span><br><span class="line"><span class="built_in">cat</span> &lt;&lt;<span class="string">EOF | sudo tee /etc/modules-load.d/k8s.conf</span></span><br><span class="line"><span class="string">overlay</span></span><br><span class="line"><span class="string">br_netfilter</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置系统参数</span></span><br><span class="line"><span class="built_in">cat</span> &lt;&lt;<span class="string">EOF | sudo tee /etc/sysctl.d/k8s.conf</span></span><br><span class="line"><span class="string">net.bridge.bridge-nf-call-iptables  = 1</span></span><br><span class="line"><span class="string">net.bridge.bridge-nf-call-ip6tables = 1</span></span><br><span class="line"><span class="string">net.ipv4.ip_forward                 = 1</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 应用系统参数</span></span><br><span class="line"><span class="built_in">sudo</span> sysctl --system</span><br></pre></td></tr></tbody></table></figure><h3 id="2-安装Containerd（如果系统没有默认安装）">2. 安装Containerd（如果系统没有默认安装）</h3><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 安装containerd</span></span><br><span class="line"><span class="built_in">sudo</span> apt install -y containerd</span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置containerd</span></span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">mkdir</span> -p /etc/containerd</span><br><span class="line">containerd config default | <span class="built_in">sudo</span> <span class="built_in">tee</span> /etc/containerd/config.toml</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改设置以使用systemd作为cgroup驱动</span></span><br><span class="line"><span class="built_in">sudo</span> sed -i <span class="string">'s/SystemdCgroup = false/SystemdCgroup = true/'</span> /etc/containerd/config.toml</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重启containerd</span></span><br><span class="line"><span class="built_in">sudo</span> systemctl restart containerd</span><br><span class="line"><span class="built_in">sudo</span> systemctl <span class="built_in">enable</span> containerd</span><br></pre></td></tr></tbody></table></figure><h3 id="3-使用Sealos部署单节点Kubernetes集群">3. 使用Sealos部署单节点Kubernetes集群</h3><p>获取本机IP地址（这将是控制节点的IP）：</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">MASTER_IP=$(hostname -I | awk <span class="string">'{print $1}'</span>)</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"Master IP: <span class="variable">$MASTER_IP</span>"</span></span><br></pre></td></tr></tbody></table></figure><p>使用Sealos创建单节点集群：</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 运行Kubernetes集群</span></span><br><span class="line"><span class="built_in">sudo</span> sealos run labring/kubernetes:v1.28.15 labring/calico:v3.26.2 --masters <span class="variable">$MASTER_IP</span></span><br></pre></td></tr></tbody></table></figure><p>这将：</p><ul><li>拉取并安装Kubernetes v1.28.15</li><li>安装Calico网络插件</li><li>创建单节点集群</li></ul><h2 id="配置kubectl">配置kubectl</h2><h3 id="1-配置访问凭证">1. 配置访问凭证</h3><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p <span class="variable">$HOME</span>/.kube</span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">cp</span> /etc/kubernetes/admin.conf <span class="variable">$HOME</span>/.kube/config</span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">chown</span> $(<span class="built_in">id</span> -u):$(<span class="built_in">id</span> -g) <span class="variable">$HOME</span>/.kube/config</span><br></pre></td></tr></tbody></table></figure><h3 id="2-验证集群状态">2. 验证集群状态</h3><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">kubectl get nodes</span><br></pre></td></tr></tbody></table></figure><p>如果一切正常，您应该看到类似以下输出：</p><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">NAME     STATUS   ROLES           AGE   VERSION</span><br><span class="line">&lt;hostname&gt;   Ready    control-plane   2m    v1.28.15</span><br></pre></td></tr></tbody></table></figure><h3 id="3-验证所有系统Pod运行状态">3. 验证所有系统Pod运行状态</h3><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">kubectl get pods -A</span><br></pre></td></tr></tbody></table></figure><h2 id="配置单节点集群">配置单节点集群</h2><p>在单节点集群中，我们需要允许Pod在控制平面上运行：</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">kubectl taint nodes --all node-role.kubernetes.io/control-plane-</span><br></pre></td></tr></tbody></table></figure><h2 id="故障排除">故障排除</h2><h3 id="如果Sealos安装失败">如果Sealos安装失败</h3><p>如果Sealos无法正常部署Kubernetes，您可以使用kubeadm手动部署：</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 1. 安装kubeadm、kubelet和kubectl</span></span><br><span class="line">curl -fsSL https://pkgs.k8s.io/core:/stable:/v1.28/deb/Release.key | <span class="built_in">sudo</span> gpg --dearmor -o /etc/apt/keyrings/kubernetes-apt-keyring.gpg</span><br><span class="line"><span class="built_in">echo</span> <span class="string">'deb [signed-by=/etc/apt/keyrings/kubernetes-apt-keyring.gpg] https://pkgs.k8s.io/core:/stable:/v1.28/deb/ /'</span> | <span class="built_in">sudo</span> <span class="built_in">tee</span> /etc/apt/sources.list.d/kubernetes.list</span><br><span class="line"><span class="built_in">sudo</span> apt update</span><br><span class="line"><span class="built_in">sudo</span> apt install -y kubelet kubeadm kubectl</span><br><span class="line"><span class="built_in">sudo</span> apt-mark hold kubelet kubeadm kubectl</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 初始化集群</span></span><br><span class="line"><span class="built_in">sudo</span> kubeadm init --pod-network-cidr=10.244.0.0/16 --apiserver-advertise-address=<span class="variable">$MASTER_IP</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 配置kubectl</span></span><br><span class="line"><span class="built_in">mkdir</span> -p <span class="variable">$HOME</span>/.kube</span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">cp</span> -i /etc/kubernetes/admin.conf <span class="variable">$HOME</span>/.kube/config</span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">chown</span> $(<span class="built_in">id</span> -u):$(<span class="built_in">id</span> -g) <span class="variable">$HOME</span>/.kube/config</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. 安装网络插件（Flannel作为示例）</span></span><br><span class="line">kubectl apply -f https://github.com/flannel-io/flannel/releases/latest/download/kube-flannel.yml</span><br></pre></td></tr></tbody></table></figure><h3 id="如果遇到容器运行时错误">如果遇到容器运行时错误</h3><p>如果出现与containerd相关的错误，尝试重新启动服务：</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="built_in">sudo</span> systemctl restart containerd</span><br><span class="line"><span class="built_in">sudo</span> systemctl restart kubelet</span><br></pre></td></tr></tbody></table></figure><h2 id="验证安装">验证安装</h2><h3 id="1-检查集群信息">1. 检查集群信息</h3><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">kubectl cluster-info</span><br></pre></td></tr></tbody></table></figure><h3 id="2-创建测试Pod">2. 创建测试Pod</h3><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">kubectl create deployment nginx --image=nginx</span><br><span class="line">kubectl get pods</span><br></pre></td></tr></tbody></table></figure><h3 id="3-检查集群组件状态">3. 检查集群组件状态</h3><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">kubectl get componentstatuses</span><br></pre></td></tr></tbody></table></figure><h2 id="清理和重置">清理和重置</h2><p>如果需要重新开始，可以使用以下命令清理环境：</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 使用Sealos重置集群</span></span><br><span class="line"><span class="built_in">sudo</span> sealos reset</span><br><span class="line"></span><br><span class="line"><span class="comment"># 或者使用kubeadm重置</span></span><br><span class="line"><span class="built_in">sudo</span> kubeadm reset</span><br><span class="line"></span><br><span class="line"><span class="comment"># 清理iptables规则</span></span><br><span class="line"><span class="built_in">sudo</span> iptables -F &amp;&amp; <span class="built_in">sudo</span> iptables -t nat -F &amp;&amp; <span class="built_in">sudo</span> iptables -t mangle -F &amp;&amp; <span class="built_in">sudo</span> iptables -X</span><br></pre></td></tr></tbody></table></figure><h2 id="过程中的问题与解决">过程中的问题与解决</h2><p>在实际安装过程中，我遇到了以下几个关键问题，记录如下：</p><h3 id="1-Sealos环境冲突问题">1. Sealos环境冲突问题</h3><p>在使用<code>sudo sealos run labring/kubernetes:v1.28.15 labring/calico:v3.26.2 --masters 192.168.1.18</code>命令时，遇到错误：</p><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">Error: failed to run checker: containerd is installed on 192.168.1.18:22 please uninstall it first</span><br></pre></td></tr></tbody></table></figure><p><strong>解决方案</strong>：Sealos要求纯净环境，不允许存在预安装的containerd。我执行了以下命令：</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="built_in">sudo</span> systemctl stop containerd &amp;&amp; <span class="built_in">sudo</span> systemctl <span class="built_in">disable</span> containerd</span><br><span class="line"><span class="built_in">sudo</span> apt remove containerd.io containerd -y</span><br></pre></td></tr></tbody></table></figure><h3 id="2-镜像仓库访问问题">2. 镜像仓库访问问题</h3><p>在尝试使用Sealos安装时，遇到了网络插件镜像无法拉取的问题：</p><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">Error: error parsing image name "//labring/calico:v3.26.2": reading manifest v3.26.2 in docker.io/labring/calico: manifest unknown</span><br></pre></td></tr></tbody></table></figure><p><strong>解决方案</strong>：切换到使用kubeadm手动安装，这是备选方案。</p><h3 id="3-GPG密钥问题">3. GPG密钥问题</h3><p>在使用kubeadm安装过程中，执行添加Kubernetes GPG密钥的命令时遇到问题：</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">curl -fsSL https://pkgs.k8s.io/core:/stable:/v1.28/deb/Release.key | <span class="built_in">sudo</span> gpg --dearmor -o /etc/apt/keyrings/kubernetes-apt-keyring.gpg</span><br></pre></td></tr></tbody></table></figure><p>出现 <code>gpg: cannot open '/dev/tty': 没有那个设备或地址</code> 错误。</p><p><strong>解决方案</strong>：改用apt-key命令：</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">curl -fsSL https://pkgs.k8s.io/core:/stable:/v1.28/deb/Release.key | <span class="built_in">sudo</span> apt-key add -</span><br></pre></td></tr></tbody></table></figure><h3 id="4-容器运行时重新配置">4. 容器运行时重新配置</h3><p>由于之前移除了containerd，Kubernetes无法启动，因为CRI（容器运行时接口）不可用。</p><p><strong>解决方案</strong>：下载并安装containerd二进制文件：</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">wget https://github.com/containerd/containerd/releases/download/v1.7.20/containerd-1.7.20-linux-amd64.tar.gz</span><br><span class="line"><span class="built_in">sudo</span> tar Cxzf /usr/local containerd-1.7.20-linux-amd64.tar.gz</span><br></pre></td></tr></tbody></table></figure><p>然后创建systemd服务文件并启动containerd。</p><h3 id="5-节点状态问题">5. 节点状态问题</h3><p>在kubeadm初始化集群后，节点显示为<code>NotReady</code>状态，而不是预期的<code>Ready</code>。</p><p><strong>解决方案</strong>：</p><ul><li>安装Flannel网络插件解决CNI问题</li><li>移除节点的污点以允许Pod在单节点集群上调度：</li></ul><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">kubectl taint nodes --all node-role.kubernetes.io/control-plane-</span><br></pre></td></tr></tbody></table></figure><ul><li>等待一段时间使所有组件就绪</li></ul><h2 id="总结">总结</h2><p>通过这次安装实践，我成功搭建了本地的Kubernetes环境，主要收获如下：</p><ol><li><strong>Sealos和Kubernetes环境</strong>：成功安装了Sealos CLI工具和单节点Kubernetes集群</li><li><strong>kubectl配置</strong>：正确配置了kubectl命令行工具，可以正常管理集群</li><li><strong>网络插件</strong>：成功部署了Flannel网络插件，使Pod间可以正常通信</li><li><strong>问题解决经验</strong>：在过程中解决了多个典型问题，包括环境冲突、容器运行时配置和节点状态问题</li></ol><h3 id="经验教训">经验教训</h3><ol><li><strong>环境准备的重要性</strong>：在部署Kubernetes前，确保系统环境符合要求至关重要</li><li><strong>备选方案的准备</strong>：当首选方案（Sealos）遇到问题时，kubeadm是一个可靠的备选方案</li><li><strong>网络插件必不可少</strong>：集群初始化后必须安装CNI网络插件，否则Pod无法正常通信</li><li><strong>单节点集群的特殊配置</strong>：需要移除master节点的污点才能在单节点上调度Pod</li></ol><p>这次安装过程虽然遇到了一些挑战，但也提供了宝贵的实践经验，对理解和部署Kubernetes环境有很大帮助。</p><h2 id="Docker与Containerd的共存关系">Docker与Containerd的共存关系</h2><p>在安装过程中，我发现了一个有趣的现象：系统上同时存在Docker容器和服务以及Kubernetes集群。</p><h3 id="共存机制">共存机制</h3><p>实际上，Docker和Kubernetes可以共存，因为它们都使用了containerd作为容器运行时：</p><ol><li><strong>双重命名空间</strong>：containerd支持多客户端，Docker使用’moby’命名空间，而Kubernetes使用’<a href="http://k8s.io">k8s.io</a>’命名空间</li><li><strong>共享容器运行时</strong>：Docker和Kubernetes共享同一个containerd实例，但通过不同的命名空间隔离</li><li><strong>进程结构</strong>：Docker daemon通过<code>--containerd=/run/containerd/containerd.sock</code>连接到containerd，而Kubernetes的kubelet也连接到同一个containerd</li></ol><h3 id="注意事项">注意事项</h3><p>虽然技术上可行，但这种配置在生产环境中不推荐，因为：</p><ul><li>容器资源竞争</li><li>网络和存储配置可能冲突</li><li>安全性和隔离性可能受到影响</li></ul><h2 id="运维命令">运维命令</h2><h3 id="kubectl运维命令">kubectl运维命令</h3><p>kubectl的配置文件通常存储在<code>$HOME/.kube/config</code>，这是访问Kubernetes集群的凭证文件。</p><p>常用运维命令：</p><ul><li><code>kubectl get nodes</code> - 查看集群节点状态</li><li><code>kubectl get pods -A</code> - 查看所有命名空间中的Pod</li><li><code>kubectl get services -A</code> - 查看所有服务</li><li><code>kubectl get deployments -A</code> - 查看所有部署</li><li><code>kubectl describe pod &lt;pod-name&gt; -n &lt;namespace&gt;</code> - 查看Pod详细信息</li><li><code>kubectl logs &lt;pod-name&gt; -n &lt;namespace&gt;</code> - 查看Pod日志</li><li><code>kubectl apply -f &lt;file.yaml&gt;</code> - 部署资源</li><li><code>kubectl delete -f &lt;file.yaml&gt;</code> - 删除资源</li><li><code>kubectl scale deployment &lt;name&gt; --replicas=&lt;number&gt;</code> - 扩缩容部署</li><li><code>kubectl cluster-info</code> - 查看集群信息</li><li><code>kubectl top nodes/pods</code> - 查看资源使用情况</li></ul><h3 id="Sealos运维命令">Sealos运维命令</h3><p>虽然我们最终没有使用Sealos完成安装，但其基本运维命令包括：</p><ul><li><code>sealos run &lt;image&gt;</code> - 部署集群</li><li><code>sealos destroy</code> - 销毁集群</li><li><code>sealos reset</code> - 重置集群</li><li><code>sealos version</code> - 查看版本</li><li><code>sealos status</code> - 查看集群状态</li><li><code>sealos exec &lt;command&gt;</code> - 在集群上执行命令</li></ul><p>这些命令提供了管理Kubernetes集群的便捷方式，通过容器镜像封装了Kubernetes组件。</p>]]></content>
      
      
      
        <tags>
            
            <tag> 运维 </tag>
            
            <tag> 容器化 </tag>
            
            <tag> Kubernetes </tag>
            
            <tag> Sealos </tag>
            
            <tag> 本地部署 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>个人博客搭建</title>
      <link href="/2025/11/30/0001-ge-ren-bo-ke-da-jian/"/>
      <url>/2025/11/30/0001-ge-ren-bo-ke-da-jian/</url>
      
        <content type="html"><![CDATA[<h1>基于Qwen Code + hexo-theme-matery + GitHub Pages的个人技术博客搭建指南</h1><h2 id="概述">概述</h2><p>随着技术知识的快速发展和信息爆炸式增长，建立个人技术博客成为知识沉淀和分享的重要途径。本指南详细阐述如何利用Qwen Code的AI能力、hexo-theme-matery主题和GitHub Pages服务，构建一个高效、美观且功能完善的技术博客平台。</p><h2 id="1-搭建环境与工具准备">1. 搭建环境与工具准备</h2><h3 id="1-1-基础环境依赖">1.1 基础环境依赖</h3><ul><li><strong>Node.js</strong>（版本 ≥ 14.0.0）</li><li><strong>Git</strong>（版本控制）</li><li><strong>Hexo CLI</strong>（博客框架命令行工具）</li></ul><h3 id="1-2-Qwen-Code-介绍">1.2 Qwen Code 介绍</h3><p>Qwen Code是集成于开发环境的AI助手，具备以下核心功能：</p><ul><li><strong>代码生成</strong>：根据自然语言描述生成代码</li><li><strong>文档编写</strong>：辅助技术文档创作</li><li><strong>问题诊断</strong>：快速定位和修复问题</li><li><strong>运维优化</strong>：自动化重复性任务处理</li></ul><h2 id="2-Hexo-博客框架搭建">2. Hexo 博客框架搭建</h2><h3 id="2-1-Hexo-安装与初始化">2.1 Hexo 安装与初始化</h3><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">npm install -g hexo-cli</span><br><span class="line">hexo init your-blog-name</span><br><span class="line"><span class="built_in">cd</span> your-blog-name</span><br><span class="line">npm install</span><br></pre></td></tr></tbody></table></figure><h3 id="2-2-验证安装">2.2 验证安装</h3><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">hexo server</span><br><span class="line"><span class="comment"># 访问 http://localhost:4000 确认环境正常</span></span><br></pre></td></tr></tbody></table></figure><h2 id="3-hexo-theme-matery-主题配置">3. hexo-theme-matery 主题配置</h2><h3 id="3-1-主题安装">3.1 主题安装</h3><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/blinkfox/hexo-theme-matery.git themes/hexo-theme-matery</span><br></pre></td></tr></tbody></table></figure><h3 id="3-2-主题启用">3.2 主题启用</h3><p>修改根目录 <code>_config.yml</code>：</p><figure class="highlight yaml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attr">theme:</span> <span class="string">hexo-theme-matery</span></span><br></pre></td></tr></tbody></table></figure><h3 id="3-3-主题特性概述">3.3 主题特性概述</h3><p>hexo-theme-matery主题主要特性：</p><ul><li><strong>Material Design</strong>：遵循Google Material Design设计规范</li><li><strong>响应式布局</strong>：适配桌面端、平板、移动端</li><li><strong>瀑布流展示</strong>：博客文章列表的动态布局</li><li><strong>时间轴归档</strong>：按时间维度的文章归档展示</li><li><strong>多评论系统</strong>：支持Gitalk、Valine、Disqus等</li><li><strong>数据可视化</strong>：技能雷达图、项目展示等功能</li></ul><h2 id="4-博客页面结构构建">4. 博客页面结构构建</h2><h3 id="4-1-必要页面创建">4.1 必要页面创建</h3><p>创建分类、标签、关于等基础页面：</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">hexo new page <span class="string">"categories"</span></span><br><span class="line">hexo new page <span class="string">"tags"</span></span><br><span class="line">hexo new page <span class="string">"about"</span></span><br><span class="line">hexo new page <span class="string">"contact"</span></span><br><span class="line">hexo new page <span class="string">"friends"</span></span><br></pre></td></tr></tbody></table></figure><p>然后配置页面Front-matter：</p><figure class="highlight yaml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># categories/index.md</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">title:</span> <span class="string">categories</span></span><br><span class="line"><span class="attr">date:</span> <span class="number">2025-11-30</span></span><br><span class="line"><span class="attr">type:</span> <span class="string">"categories"</span></span><br><span class="line"><span class="attr">layout:</span> <span class="string">"categories"</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="comment"># tags/index.md</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">title:</span> <span class="string">tags</span></span><br><span class="line"><span class="attr">date:</span> <span class="number">2025-11-30</span></span><br><span class="line"><span class="attr">type:</span> <span class="string">"tags"</span></span><br><span class="line"><span class="attr">layout:</span> <span class="string">"tags"</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="comment"># about/index.md</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">title:</span> <span class="string">about</span></span><br><span class="line"><span class="attr">date:</span> <span class="number">2025-11-30</span></span><br><span class="line"><span class="attr">type:</span> <span class="string">"about"</span></span><br><span class="line"><span class="attr">layout:</span> <span class="string">"about"</span></span><br><span class="line"><span class="meta">---</span></span><br></pre></td></tr></tbody></table></figure><h3 id="4-2-菜单导航配置">4.2 菜单导航配置</h3><p>在主题配置文件中配置导航菜单：</p><figure class="highlight yaml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attr">menu:</span></span><br><span class="line">  <span class="attr">Index:</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">/</span></span><br><span class="line">    <span class="attr">icon:</span> <span class="string">fas</span> <span class="string">fa-home</span></span><br><span class="line">  <span class="attr">Tags:</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">/tags</span></span><br><span class="line">    <span class="attr">icon:</span> <span class="string">fas</span> <span class="string">fa-tags</span></span><br><span class="line">  <span class="attr">Categories:</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">/categories</span></span><br><span class="line">    <span class="attr">icon:</span> <span class="string">fas</span> <span class="string">fa-bookmark</span></span><br><span class="line">  <span class="attr">Archives:</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">/archives</span></span><br><span class="line">    <span class="attr">icon:</span> <span class="string">fas</span> <span class="string">fa-archive</span></span><br><span class="line">  <span class="attr">About:</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">/about</span></span><br><span class="line">    <span class="attr">icon:</span> <span class="string">fas</span> <span class="string">fa-user-circle</span></span><br></pre></td></tr></tbody></table></figure><h2 id="5-AI辅助开发与运维">5. AI辅助开发与运维</h2><h3 id="5-1-Qwen-Code在博客搭建中的应用">5.1 Qwen Code在博客搭建中的应用</h3><p><strong>配置生成</strong>：通过自然语言描述快速生成复杂配置文件</p><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">指令：生成包含AI、ETL、大数据标签的hexo配置文件</span><br></pre></td></tr></tbody></table></figure><p><strong>内容创作</strong>：辅助技术文章编写和优化</p><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">指令：为大数据处理技术文章生成大纲和内容要点</span><br></pre></td></tr></tbody></table></figure><p><strong>代码优化</strong>：改进代码质量和性能</p><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">指令：优化hexo主题的JavaScript性能</span><br></pre></td></tr></tbody></table></figure><h3 id="5-2-自动化运维脚本">5.2 自动化运维脚本</h3><p>创建部署脚本，实现一键发布：</p><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># deploy.sh</span></span><br><span class="line">hexo clean</span><br><span class="line">hexo generate</span><br><span class="line">hexo deploy</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"博客已成功部署！"</span></span><br></pre></td></tr></tbody></table></figure><h2 id="6-个性化配置与优化">6. 个性化配置与优化</h2><h3 id="6-1-站点信息配置">6.1 站点信息配置</h3><p>在根配置文件中设置站点信息：</p><figure class="highlight yaml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 站点基本信息</span></span><br><span class="line"><span class="attr">title:</span> <span class="string">huhuhuhr</span></span><br><span class="line"><span class="attr">subtitle:</span> <span class="string">'学习记录与技术分享'</span></span><br><span class="line"><span class="attr">description:</span> <span class="string">'这里是huhuhuhr的技术博客，记录学习历程和技术心得'</span></span><br><span class="line"><span class="attr">keywords:</span> <span class="string">'AI, ETL, 大数据, 技术, 学习, 编程'</span></span><br><span class="line"><span class="attr">author:</span> <span class="string">huhuhuhr</span></span><br><span class="line"><span class="attr">language:</span> <span class="string">zh-CN</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># URL配置</span></span><br><span class="line"><span class="attr">url:</span> <span class="string">https://your-domain.com</span></span><br></pre></td></tr></tbody></table></figure><h3 id="6-2-主题个性化">6.2 主题个性化</h3><p>配置主题的个人信息：</p><figure class="highlight yaml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 主题配置文件</span></span><br><span class="line"><span class="attr">profile:</span></span><br><span class="line">  <span class="attr">avatar:</span> <span class="string">/medias/avatar.jpg</span></span><br><span class="line">  <span class="attr">career:</span> <span class="string">'系统架构师'</span></span><br><span class="line">  <span class="attr">introduction:</span> <span class="string">'热爱技术，专注AI、ETL和大数据领域，通过博客记录学习历程和技术心得。'</span></span><br><span class="line"></span><br><span class="line"><span class="attr">socialLink:</span></span><br><span class="line">  <span class="attr">github:</span> <span class="string">https://github.com/your-username</span></span><br><span class="line">  <span class="attr">email:</span> <span class="string">your-email@example.com</span></span><br></pre></td></tr></tbody></table></figure><h2 id="7-GitHub-Pages-部署">7. GitHub Pages 部署</h2><h3 id="7-1-部署插件安装">7.1 部署插件安装</h3><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">npm install hexo-deployer-git --save</span><br></pre></td></tr></tbody></table></figure><h3 id="7-2-部署配置">7.2 部署配置</h3><figure class="highlight yaml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attr">deploy:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">git</span></span><br><span class="line">  <span class="attr">repo:</span> <span class="string">git@github.com:username/username.github.io.git</span></span><br><span class="line">  <span class="attr">branch:</span> <span class="string">main</span></span><br></pre></td></tr></tbody></table></figure><h3 id="7-3-部署执行">7.3 部署执行</h3><figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">hexo deploy -g  <span class="comment"># 生成并部署</span></span><br></pre></td></tr></tbody></table></figure><h2 id="8-自定义域名配置">8. 自定义域名配置</h2><h3 id="8-1-CNAME文件创建">8.1 CNAME文件创建</h3><p>在 <code>source</code> 目录下创建 <code>CNAME</code> 文件：</p><figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">your-domain.com</span><br></pre></td></tr></tbody></table></figure><h3 id="8-2-DNS记录配置">8.2 DNS记录配置</h3><p>在域名提供商处添加DNS记录：</p><ul><li>A记录：指向GitHub Pages IP地址</li><li>CNAME记录：子域名指向 GitHub 仓库</li></ul><h3 id="8-3-GitHub仓库设置">8.3 GitHub仓库设置</h3><p>在仓库的 “Settings” -&gt; “Pages” 中配置自定义域名。</p><h2 id="9-性能优化与SEO配置">9. 性能优化与SEO配置</h2><h3 id="9-1-搜索插件配置">9.1 搜索插件配置</h3><figure class="highlight yaml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attr">search:</span></span><br><span class="line">  <span class="attr">path:</span> <span class="string">search.xml</span></span><br><span class="line">  <span class="attr">field:</span> <span class="string">post</span></span><br></pre></td></tr></tbody></table></figure><h3 id="9-2-SEO优化配置">9.2 SEO优化配置</h3><p>启用sitemap、keywords等SEO相关配置：</p><figure class="highlight yaml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># 文章字数统计</span></span><br><span class="line"><span class="attr">postInfo:</span></span><br><span class="line">  <span class="attr">date:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">update:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">wordCount:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">min2read:</span> <span class="literal">true</span></span><br></pre></td></tr></tbody></table></figure><h2 id="10-内容创作最佳实践">10. 内容创作最佳实践</h2><h3 id="10-1-文章Front-matter规范">10.1 文章Front-matter规范</h3><figure class="highlight yaml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">title:</span> <span class="string">文章标题</span></span><br><span class="line"><span class="attr">date:</span> <span class="number">2025-11-30 12:00:00</span></span><br><span class="line"><span class="attr">author:</span> <span class="string">huhuhuhr</span></span><br><span class="line"><span class="attr">tags:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">技术标签1</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">技术标签2</span></span><br><span class="line"><span class="attr">categories:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">技术分类</span></span><br><span class="line"><span class="attr">summary:</span> <span class="string">文章摘要</span></span><br><span class="line"><span class="meta">---</span></span><br></pre></td></tr></tbody></table></figure><h3 id="10-2-内容结构化">10.2 内容结构化</h3><ul><li><strong>问题引入</strong>：阐述文章要解决的问题</li><li><strong>解决方案</strong>：详细描述解决过程和方法</li><li><strong>技术总结</strong>：提炼关键知识点和经验</li><li><strong>后续思考</strong>：提出进一步的研究方向</li></ul><h2 id="11-维护与更新策略">11. 维护与更新策略</h2><h3 id="11-1-定期维护任务">11.1 定期维护任务</h3><ul><li><strong>内容审核</strong>：定期检查内容的准确性和时效性</li><li><strong>技术更新</strong>：跟进技术发展，更新过时内容</li><li><strong>性能监控</strong>：检查网站加载速度和可用性</li></ul><h3 id="11-2-AI辅助维护">11.2 AI辅助维护</h3><p>利用Qwen Code进行：</p><ul><li>语法和逻辑检查</li><li>内容改写和优化</li><li>SEO友好的标题和描述生成</li></ul><h2 id="总结">总结</h2><p>通过本指南的实施，我们成功构建了一个基于现代技术栈的个人技术博客：利用Hexo框架的高效静态生成能力、hexo-theme-matery主题的精美设计、GitHub Pages的稳定托管服务，以及Qwen Code的AI辅助能力，实现了技术博客的快速搭建和高效运维。</p><p>这种技术选型的优势在于：</p><ol><li><strong>成本效益</strong>：利用免费服务降低运营成本</li><li><strong>技术先进</strong>：采用现代前端技术和设计理念</li><li><strong>易于维护</strong>：简单配置和自动化部署</li><li><strong>可扩展性</strong>：支持功能模块的灵活扩展</li></ol><p>在知识经济时代，个人技术博客不仅是知识沉淀的工具，更是技术影响力的载体。通过系统化的搭建和精细化的运营，将为个人技术品牌建设奠定坚实基础。</p>]]></content>
      
      
      <categories>
          
          <category> 技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Qwen Code </tag>
            
            <tag> Hexo </tag>
            
            <tag> 博客搭建 </tag>
            
            <tag> AI工具 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
